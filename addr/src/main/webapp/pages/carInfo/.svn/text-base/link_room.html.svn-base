<div class="col-xs-12">
	<form id="roomForm">
		<div class="row">
			<div class="col-xs-12 form-xs form-group row">
				<#if flag=="1">
					<div class="col-xs-3">
						<label for="addClass" class="col-xs-5 control-label">栋座分组：</label>
						<div class="col-xs-7">
						 	<select id="groupId" class="groupId input-xs form-control">
									<option value="">请选择</option>
								<#list groupList as item>
									<option value="${item.id!}">${item.groupName!}</option>
								</#list>
							</select>
						</div>
					</div>
				</#if>
				<#if flag=="0">
					<div class="col-xs-3">
						<label for="addClass" class="col-xs-5 control-label">栋座：</label>
						<div class="col-xs-7">
						 	<select id="buildingId" class="buildingId input-xs form-control">
								<option value="">请选择</option>
								<#list buildingList as item>
									<option value="${item.id!}">${item.buildingName!}</option>
								</#list>
							</select>
						</div>
					</div>
					<input id="groupId"  value="" type="hidden"/>
				<#else>
					<div class="col-xs-3">
						<label for="addClass" class="col-xs-4 control-label">栋座：</label>
						<div class="col-xs-8">
						 	<select id="buildingId" class="buildingId input-xs form-control">
						 		<option value="">请选择</option>
							</select>
						</div>
					</div>
				</#if>
				<div class="col-xs-2">
					<label for="addClass" class="col-xs-5 control-label">单元：</label>
					<div class="col-xs-7">
						<select id="unitId" class="unitId input-xs form-control" style="width: 66px;">
							<option value="">请选择</option>
						</select>
					</div>
				</div>
				<div class="col-xs-3">
					<label for="addClass" class="col-xs-5 control-label">门牌号：</label>
					<div class="col-xs-6">
						<input class="form-control input-xs" id="roomNum" value="" name="roomNum"  maxLength="20" ></input>
					</div>
				</div>
				<div class="col-xs-1">
					<button class="room_search">查询</button>
				</div>
			</div>
			
			<div class="col-xs-12">
				<table id="room_jqGrid" >
						
				</table>
				 <input type="hidden" id="premisesId" value="${id!''}" />
			</div>
		</div>
	</form>
</div>

<script>

$(function (){
	//选择栋座分组
	$("#groupId").change(function (){
		var groupId = $("#groupId option:selected").val();
		$("#buildingId").empty();
		if(groupId==""){
			$("#buildingId").append("<option value=''>请选择</option>");
		}else{
			$.ajax({
			       type: "post",
			       url: "${CTX}/carInfo/buildingList.do", 
			       dataType:'json',
			       data: {"groupId":groupId},
			       success: function(data){
			    	   var html = "<option value=''>请选择</option>";
			    	   if(data.length>0){
			    		   for(var i = 0;i<data.length;i++){
				    		   html+="<option value='"+data[i].id+"'>"+data[i].buildingName+"</option>";
				    	   }
			    	   }
			    	   $("#buildingId").append(html);
			       },
			 });
		}
    });
	//选择栋座
	$("#buildingId").change(function (){
		var buildingId = $("#buildingId option:selected").val();
		$("#unitId").empty();
		if(buildingId==""){
			$("#unitId").append("<option value=''>请选择</option>");
		}else{
			$.ajax({
			       type: "post",
			       url: "${CTX}/carInfo/getUnitList.do", 
			       dataType:'json',
			       data: {"buildingId":buildingId},
			       success: function(data){
			    	   var html = "<option value=''>请选择</option>";
			    	   if(data.length>0){
			    		   for(var i = 0;i<data.length;i++){
				    		   html+="<option value='"+data[i].id+"'>"+data[i].code+"</option>";
				    	   }
			    	   }
			    	   $("#unitId").append(html);
			       },
			 });
		}
    });
	init_jqGrid();
});

/*关联房间列表*/
function init_jqGrid(){
	$("#room_jqGrid").jqGrid({
		 url: '${CTX}/carInfo/getCarList.do',
		 postData: {
			 	premisesId:$("#premisesId").val(), //楼盘id需要后续处理暂时写死
			 	buildingId: $("#buildingId").val(),//栋座id
			 	unitId: $("#unitId").val(),//单元id
			 	roomNum: $("#roomNum").val(),//门牌号
			 	groupId: $("#groupId").val(),//栋座分组id
			},
         datatype: "json",
         colModel: [
			 { label: 'id', name: 'roomId',index:'roomId',hidden:true},
             { label: '栋座', name: 'buildingName',index:'buildingName',sortable : true,width: 30 },
			 { label: '单元', name: 'unitName',index:'unitName',sortable : true,width: 30 },
			 { label: '门牌号', name: 'roomNum',index:'roomNum',sortable : true,width: 30 }
         ],
         multiselect: true,
         multiboxonly: true,
         onSelectRow: function (rowId, status, e) {
         	 rowDataNames = [];
             var rowIds = $("#room_jqGrid").jqGrid('getGridParam', 'selarrrow');
             $(rowIds).each(function(i,rowId){
                 rowDataNames.push($("#room_jqGrid").jqGrid('getRowData',rowId));
             });
         },
         viewrecords: true, 
         autowidth:true,
         height: $(window).height()-300
    });
}
/* 查询 */
$(".room_search").click(function(){
	var groupId = $("#groupId").val();
	var buildingId=$("#buildingId").val();
	var unitId=$("#unitId").val();
	var roomNum=$("#roomNum").val();
	
	var param="groupId="+groupId+"&buildingId="+buildingId+"&unitId="+unitId+"&roomNum="+roomNum;
	var url = "${CTX}/carInfo/getCarList.do?"+param;
 	
 	$("#room_jqGrid").setGridParam({url:url,page:1}).trigger('reloadGrid');

});
</script>
