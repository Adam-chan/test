<!-- 页面描述:租赁房源(车位) -->
<div class="panel">
	<form id="turn_Form">
		<div class="panel-heading" style="background-color: #A8C9F4;">
			<h4 class="panel-title">
				<a class="accordion-toggle">基本信息</a>
			</h4>
		</div>
		<div class="panel-collapse">
			<div class="panel-body">
				<div class="modal-body form-horizontal row" >
					<div class="col-sm-12 form-xs form-group row" style="left:-4.7%">
						<div class="col-sm-12 form-xs form-group row">
						   <label class="col-xs-2 control-label">具体地址：</label>
						   <div class="col-xs-10">
						      <input id="addressDetail" class="form-control input-xs" name="addressDetail" disabled="true" value="${(leaseCarPort.addressDetail)!''}">
						   </div>
						</div>
						<div class="col-sm-12 form-xs form-group row">
						    <label class="col-xs-2 control-label">证载地址：</label>
						    <div class="col-xs-10">
						       <input class="form-control input-xs" maxlength="80" name="zzdz">
						    </div>
						</div>
					</div>
					<div class="col-sm-12 form-xs form-group row" style="width:90%;left:3.5%">
						<label class="col-xs-1 control-label">楼盘名称：</label>
				        <div class="col-xs-2">
				        	<input class="form-control input-xs" disabled="true" value="${(leaseCarPort.premisesName)!''}">
				        </div>
						<label class="col-xs-1 control-label">临近栋座：</label>
				        <div class="col-xs-2">
							<select id="closeBuilding" class="input-xs form-control" name="closeBuilding">
								<option value="">请选择</option>
							</select>
						</div>
						<label class="col-xs-1 control-label">车位类型：</label>
				        <div class="col-xs-2">
							<select id="type_rent" class="input-xs form-control" disabled="true">
								<option value="1">车位</option>
								<option value="2">车库</option>
							</select>
						</div> 
						<label class="col-xs-1 control-label">楼层：</label>
				      	<div class="col-xs-2">
				        	<select id="floor_rent" class="input-xs form-control" disabled="true">
				            	<option value="1">地上</option>
				            	<option value="2">地下</option>
				            </select>
				      	</div>
					</div>
					<div class="col-sm-12 form-xs form-group row">
						<div class="col-sm-4">
							<label class="col-xs-4 control-label">车位号：</label>
					        <div class="col-xs-6">
					        	<input type="text" class="form-control input-xs" style="width:93%" disabled="true" value="${(leaseCarPort.parkNum)!''}">
					        </div>
						</div>
					</div>
					<div class="col-sm-12 form-xs form-group row" style="left:10.8%">
						<div class="col-xs-9">
							<table class="col-xs-12 table-input">
								<tr>
									<th style="width:5%">序号</th>
									<th style="width:30%">联系人类别</th>
									<th style="width:30%">联系人</th>
									<th style="width:30%">联系方式</th>
								</tr>
								<tbody id="lm_tbody">
									<tr id="lm_tr0" class="hasDelete">
										<td class="cloneList">
											1
										</td>
										<td>
											<select id="type" class='form-control input-xs' name="type" disabled="true">
												<option value="1">产权人</option>
												<option value="2">父母</option>
												<option value="3">丈夫</option>
												<option value="4">妻子</option>
												<option value="5">子女</option>
												<option value="6">亲戚</option>
												<option value="7">其他</option>
											</select>
										</td>
										<td><input id="name" class="form-control input-xs" type="text" name="name" maxlength="10"></td>
										<td><input id="contactType" class="form-control input-xs" type="text" name="contactType" onblur="validateTel(this);"></td>
									</tr>
								</tbody>
							</table>
						</div>
						<div class="col-xs-1">
							<input type="button" id="addBut" value="+" class="btn btn-blue btn-white"/>
						</div>
					</div>
					<div class="col-sm-12 form-xs form-group row">
						<div class="col-sm-4">
							<label class="col-xs-4 control-label">使用类别：</label>
					      	<div class="col-xs-7">
					        	<select id="useType" class="input-xs form-control" name="useType" disabled="true">
					          		<option value="4" selected="selected">车位</option>
					          	</select>
					      	</div>
						</div>
						<div class="col-sm-4">
							<label class="col-xs-4 control-label">产权性质：</label>
						      <div class="col-xs-7">
						        <select class="input-xs form-control" name="carPortPropertyRight">
						          <option value="">请选择</option>
						          <option value="1">有产权</option>
						          <option value="2">无产权</option>
						         </select>
						      </div>
						</div>
						<div class="col-sm-4">
							<label class="col-xs-3 control-label">车位售价：</label>
						    <div class="col-xs-7">
						        <input id="leasePrice" class="form-control input-xs checkNum" format="10.2" name="leasePrice">
						    </div>
						    <div class="col-xs-2">万元</div>
						</div>
					</div>
					<div class="col-sm-12 form-xs form-group row">
						<div class="col-sm-4">
							<label class="col-xs-4 control-label">底价：</label>
						    <div class="col-xs-6">
						        <input class="form-control input-xs checkNum" format="10.2" style="width:118%" name="entrustPrice">
						    </div>
						    <div class="col-xs-2" style="left:6%">万元</div>
						</div>
						<div class="col-sm-4">
							<label class="col-xs-4 control-label">物业费：</label>
						    <div class="col-xs-6">
						        <input class="form-control input-xs checkNum" format="10.2" style="width:118%" name="propertyFee">
						    </div>
						    <div class="col-xs-2" style="left:6%">元/㎡/月</div>
						</div>
						<div class="col-sm-4">
							<label class="col-xs-3 control-label">使用现状：</label>
						    <div class="col-xs-7">
						        <select id="useStatus" class="input-xs form-control" name="useStatus">
						          <option value="">请选择</option>
						          <option value="1">空置</option>
						          <option value="2">出租</option>
						          <option value="3">自用</option>
						        </select>
						    </div>
						</div>
					</div>
					<div class="col-sm-12 form-xs form-group row">
						<div class="col-sm-4">
							<label for="addGrade" class="col-xs-4 control-label">房产证号：</label>
					        <div class="col-xs-7">
								<input id="fckCode" type="text" class="form-control input-xs" name="fckCode"> 
							</div>
						</div>
						<div class="col-sm-4">
							<label class="col-xs-4 control-label">房产证签发日期：</label>
							<div class="col-xs-7">
								<input type="text" class="5i5jdate form-control input-xs" id="fckDate" name="fckDate">
							</div>
						</div>
					</div>
					
				</div>
			</div>
		</div>
		<div class="panel-heading" style="background-color: #A8C9F4;">
			<h4 class="panel-title">
				<a class="accordion-toggle">
					其他信息
				</a>
			</h4>
		</div>
		<div class="panel-collapse">
			<div class="panel-body">
				<div class="modal-body form-horizontal row" style="left: -70px;">
					<div class="col-sm-12 form-xs form-group row">
						<label class="col-xs-2 control-label">业主来源渠道：</label>
						<div class="col-xs-2">
							<select id="parentSource" class="floor input-xs form-control" onchange="getChildrenSource(this);">
								<option value="">请选择</option>
								<#if parentSourceList?exists>
									<#list parentSourceList as source>
										<option value="${source.id!''}">
											${source.source!''}
										</option>
									</#list>
								</#if>
							</select>
						</div>
						<div class="col-xs-2">
							<select id="childSource" class="floor input-xs form-control" name="ownerSource">
								<option value="">请选择</option>
							</select>
						</div>
					</div>
					<!-- 房源标签 s -->
					<div class="col-sm-12 form-xs form-group row">
						<label class="col-xs-2 control-label">房源标签：</label>
						<#if sysParamMap.ZLFYBQ??>
							<#list sysParamMap.ZLFYBQ as item>  
						        <div class="col-xs-2">
									<label>
										<input type="checkbox" class="tags ace" value="${item.id!''}">
										<span class="lbl"> ${item.sysHouseDescribe!''}</span>
									</label>
								</div>
								<#if (item_index+1)%5==0>
									<label class="col-xs-2 control-label"></label>
								</#if> 
						    </#list>  
						</#if> 
					</div>
					<!-- 房源标签 e -->
					<div class="col-sm-12 form-xs form-group row">
						<label class="col-xs-2 control-label">备注：</label>
						<div class="col-xs-10">
							<textarea id="remark" rows="5" cols="25" class="form-control" maxlength="300"></textarea>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- 隐藏域 S-->
		<input id="preId" type="hidden" value="${(leaseCarPort.premisesId)!''}"/>
		<input id="carPortId" type="hidden" name="carPortId" value="${(leaseCarPort.id)!''}"/>
		<!-- 隐藏域 E-->
	</form>
</div>

<script type="text/javascript">

	$(function(){
		
		//数据初始化
		var type = "${(leaseCarPort.type)!''}";//车位类型
		if(type!=""){
			$("#type_rent").find("[value='"+type+"']").attr("selected", "selected");
		}
		var floor = "${(leaseCarPort.floor)!''}";//楼层
		if(floor!=""){
			$("#floor_rent").find("[value='"+floor+"']").attr("selected", "selected");
		}
		var status = "${(leaseCarPort.status)!''}";//使用现状
		if(status!=""){
			$("#useStatus").find("[value='"+status+"']").attr("selected", "selected");
		}
		var premisesId = "${(leaseCarPort.premisesId)!''}";//临近栋座
		if(premisesId!=""){
			getCloseBuilding();
		}
		var carPortId = "${(leaseCarPort.id)!''}";//车位id
		if(carPortId!=""){
			isContactHouseLease(carPortId);
		}
		
		$('.5i5jdate').datepicker({
		    //todayBtn: "linked",//今天按钮
		    clearBtn: true,//清空按钮
		    language: "zh-CN",//语言
		    autoclose: true,//自动关闭
		    todayHighlight: true,//今天高亮
		    format: "yyyy-mm-dd",//日期格式，可以不写，直接使用默认的
		});
		//联系人克隆
		$("#addBut").click(function(){
			var flag = true;
			//校验联系人和联系方式不为空
			$("#lm_tbody tr").each(function(){
				var name = $(this).find("input[name='name']").val();
				var contactType = $(this).find("input[name='contactType']").val();
				if(name=="" || contactType==""){
					flag = false;
				}
			});
			if(flag){
				cloneDom({
				    dom:$("#lm_tr0"),//克隆对象
				    target:$("#lm_tbody"),//克隆位置
				    loadBefore: null,
				    callBack: function(a){
				    	$("#lm_tbody tr:first td:last").hide();
				    	$("#lm_tbody select").each(function(i){
				    		if(i!=0){
				    			$(this).attr("disabled",false);
				    		}
				    	}); 
				    }
				});
			}else{
				alert("请完善联系人和联系方式！");
			}
		});	
		
		//业主来源change
		$("#parentSource").change(function(){ 
			var parentId = $("#parentSource option:selected").val();
			getChildrenSource(parentId);
		});
		
		$(".checkNum").keyup(function() {
			var value = $(this).val();
			var integerResult = "";
			var decimalResult = "";
			var integerSize = $(this).attr("format").split(".")[0];
			var decimalSize = 0;
			// 小数存在标识
			var decimalExist = 0;
			if($(this).attr("format").split(".").length > 1) {
				decimalSize = $(this).attr("format").split(".")[1];
				integerSize = integerSize - decimalSize;
			}
			if(value.indexOf(".") == -1 || decimalSize == 0) {
				// 未输入小数点
				integerResult = value.replace(/\D/g, "");
				if(integerResult != "") {
					integerResult = parseInt(integerResult).toString();
				}
				if(integerResult.length > integerSize) {
					integerResult = integerResult.substring(0, integerSize);
				}
			} else {
				// 已输入小数点
				var splitValue = value.split(".");
				// 整数部分
				integerResult = splitValue[0].replace(/\D/g, "");
				if(integerResult.length > integerSize) {
					integerResult = integerResult.substring(0, integerSize);
				}
				// 小数部分
				for (var i = 1; i < splitValue.length; i++) {
					decimalResult += splitValue[i].replace(/\D/g, "");
				}
				if(decimalResult.length > decimalSize) {
					decimalResult = decimalResult.substring(0, decimalSize)
				}
				decimalExist = 1;
			}
			if(decimalExist == 0) {
				$(this).val(integerResult);
			} else {
				$(this).val(integerResult + "." + decimalResult);
			}
			// 数字输入标准 End
		});
		
	});
	function isContactHouseLease(carPortId){
		$.ajax({
			url: "${CTX}/carPort/isContactHouseLease.do",
			data:{
				carPortId:carPortId
			},
			type:"post",
			dataType:"json",
			success:function(data){
				if(data.length>0){
					$(".contactHouseLease").html("关联房源："+data[0].code);
				}else{
					$(".contactHouseLease").html("");
				}
			}
		});
	}
	function getCloseBuilding(){
		$("#closeBuilding").empty();
		$("#closeBuilding").append("<option value=''>请选择</option>");
		$.ajax({
			url : "${CTX}/carPort/getBuildingsList.do",
			dataType : "json",
			type : "post",
			async:false,
			data : {
				premisesId : $("#preId").val()
			},
			success : function(data) {
				var html = "";
				if(data.length>0){
					for(var i = 0;i<data.length;i++){
						html+="<option value='"+data[i].id+"'>"+data[i].buildingName+"</option>"
					}
				}
				$("#closeBuilding").append(html);
			}
		});
	}
	
</script>
			
			
			
			
			
			
			
			