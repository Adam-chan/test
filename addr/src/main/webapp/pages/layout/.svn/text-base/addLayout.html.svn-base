<div id="top_tools" class=" btn-group">
	<form id="form" enctype="multipart/form-data">
		<a href="javascript:void(0);" style="position: relative;overflow: hidden;display: block;width: 1px;float: right;height: 24px;color:#0196ff;">
			<a class="btn btn-xs btn-icon btn-blue"> 
				<input onchange="picUpload();" name="pic" type="file" style="position: absolute;top: -6px;left: -2px;opacity: 0;border: 0;width: 100px;height: 50px!important;line-height: 70px!important; cursor: pointer;">
					<span>上传户型图</span>
			</a>
		</a>
	</form>
</div>

<form id="infoForm" >
<div class="col-xs-12 my-group" enterforbtn="confirm-role">
	<input name="premisesId" id="premisesId" value="${premisesId!}"
		type="hidden" />
	<input name="id" id="id" value="${id!}" type="hidden" />
	<!-- 以上 页面传值用  户型Id 楼盘Id -->

	<input id="roomSel" value="${(layout.room)!''}" type="hidden" />
	<input id="officeSel" value="${(layout.office)!''}" type="hidden" />
	<input id="wcSel" value="${(layout.wc)!''}" type="hidden" /> <input
		id="balconySel" value="${(layout.balcony)!''}" type="hidden" />
	<input id="orientationSel" value="${(layout.orientation)!''}"
		type="hidden" />	
	<input id="folder" value="${(layout.folderName)!''}"
		type="hidden" />
	<input id="file" value="${(layout.fileName)!''}"
		type="hidden" name="file"/>		
	<!-- 以上 修改页面赋值用 -->
	<div class="form-horizontal row my-inputs">
		<div class="col-xs-12">
			<div class=" form-xs form-group row">
				<div class="col-xs-4">
					<label for="" class="col-xs-5 control-label">户型名称：</label>
					<div class="col-xs-7">
						<input class="input-xs form-control"
							id="name" name="name" value="${(layout.layoutName)!''}"></input>
					</div>
				</div>
				<div class="col-xs-8">
					<div class="col-xs-6">
						<label for="" class="col-xs-4 control-label">户型：</label>
						<div class="col-xs-3">
							<select id="room" class="input-xs form-control">
								<option value=""></option>
								<option value="1">1</option>
								<option value="2">2</option>
								<option value="3">3</option>
								<option value="4">4</option>
								<option value="5">5</option>
								<option value="6">6</option>
							</select>
						</div>
						<div class="col-xs-1 roomLabel">
							<label>室</label>
						</div>
						<div class="col-xs-3 roomSelect">
							<select id="office" class="input-xs form-control">
								<option value=""></option>
								<option value="1">1</option>
								<option value="2">2</option>
								<option value="3">3</option>
							</select>
						</div>
						<div class="col-xs-1 roomLabel">
							<label>厅</label>
						</div>
					</div>
					<div class="col-xs-6">
						<div class="col-xs-3 roomSelect">
							<select id="wc" class="input-xs form-control">
								<option value=""></option>
								<option value="1">1</option>
								<option value="2">2</option>
								<option value="3">3</option>
							</select>
						</div>
						<div class="col-xs-1 roomLabel">
							<label>卫</label>
						</div>
						<div class="col-xs-3 roomSelect">
							<select id="balcony" class="input-xs form-control">
								<option value=""></option>
								<option value="1">1</option>
								<option value="2">2</option>
								<option value="3">3</option>
							</select>
						</div>
						<div class="col-xs-1 roomLabel">
							<label>厨</label>
						</div>
					</div>
				</div>
			</div>
			<div class=" form-xs form-group row">
				<div class="col-xs-5">
					<label for="" class="col-xs-4 control-label">建筑面积：</label>
					<div class="col-xs-4">
						<input class="input-xs form-control"
							value="${(layout.coveredArea)!''}" id="coveredArea" name="coveredArea"></input>
					</div>
					<div class="col-xs-2 ">
						<label>㎡</label>
					</div>
				</div>
				<div class="col-xs-4">
					<label for="" class="col-xs-5 control-label">使用面积：</label>
					<div class="col-xs-5">
						<input class="input-xs form-control"
							value="${(layout.usedArea)!''}" id="usedArea" name="usedArea"></input>
					</div>
					<div class="col-xs-2 ">
						<label>㎡</label>
					</div>
				</div>
				<div class="col-xs-3">
					<label for="" class="col-xs-4 control-label">朝向：</label>
					<div class="col-xs-5">
						<select id="orientation" class="input-xs form-control">
							<option value=""></option>
							<option value="东">东</option>
							<option value="南">南</option>
							<option value="西">西</option>
							<option value="北">北</option>
						</select>
					</div>
				</div>
			</div>
			
			<div class=" form-xs form-group row">
				<div class="col-xs-5 ">
					<label for="" class="col-xs-4 control-label">单价：</label>
					<div class="col-xs-4">
						<input class="input-xs form-control"
							value="${(layout.unitPrice)!''}" id="unitPrice" name="unitPrice"></input>
					</div>
					<div class="col-xs-2 ">
						<label>元</label>
					</div>
				</div>
				<div class="col-xs-4 ">
					<label for="" class="col-xs-4 control-label">总价：</label>
					<div class="col-xs-6">
						<input class="input-xs form-control"
							value="${(layout.totalPrice)!''}" id="totalPrice" name="totalPrice"></input>
					</div>
					<div class="col-xs-2 ">
						<label>元</label>
					</div>
				</div>
				<div class="col-xs-3 ">
				</div>
			</div>
		</div>
	</div>
	<div class="col-xs-4 "></div>
	<div id="picUploaded" class="col-xs-4 "><img id="img" src=""/></div>
	<div class="col-xs-4 "></div>
</div>
</form>
<script type="text/javascript">

var folderName = $("#folder").val();
var fileName = $("#file").val();
//var folderName = "/2016/10";	//暂时写死
//var fileName = "1a49beed-1d89-47e8-b9fe-db32edd35db5.jpg";

//修改页面select赋值
$("#room").val($("#roomSel").val());
$("#office").val($("#officeSel").val());
$("#wc").val($("#wcSel").val());
$("#balcony").val($("#balconySel").val());
$("#orientation").val($("#orientationSel").val());
if($("#folder").val()){
	$("#img").attr("src","${IMAGE_URL}"+$("#folder").val()+"/"+$("#file").val()+"@180w_180h");
}

function picUpload(){
	var formData = new FormData($("#form")[0]);
	$.ajax({  
//            url :"${CTX}/layoutInfo/upload.do",
        	url :"${UPLOAD_URL}/save.do",
 	        type: "POST",
            data : formData,  
  	        dataType:"JSON",
            async : false,
            processData : false,
            contentType : false,
	        success: function (data) {
	        	folderName = data.folderName;
	        	fileName = data.fileName;
	        	$("#img").attr("src","${IMAGE_URL}"+folderName+"/"+fileName+"@180w_180h");
	        }, 
	        error: function (data) {
	        	alert("上传失败"); 
	        }  
	    }); 
}

//新增,修改户型
function saveLayout(au){
	if(!validateLayoutInfo().form()){
		return type;
	}
	var url = "${CTX}/layoutInfo/addLayout.do";
	if(au == 2) {//修改
		url = "${CTX}/layoutInfo/updateLayout.do?id="+$("#id").val();
	}
   	 $.ajax({
 	       type: "POST",
 	       url: url,
 	       async:false,
 	       dataType:"JSON",
 	       data: {
				"premisesId":$("#premisesId").val(),
				"layoutName":$("#name").val(),
				"room":$("#room").val(),
				"office":$("#office").val(),
				"wc":$("#wc").val(),
				"balcony":$("#balcony").val(),
				"coveredArea":$("#coveredArea").val(),
				"usedArea":$("#usedArea").val(),
				"unitPrice":$("#unitPrice").val(),
				"totalPrice":$("#totalPrice").val(),
				"orientation":$("#orientation").val(),
				"folderName":folderName,
				"fileName":fileName
 	    		   },
 	       success: function(data){
 	    	  if(data == 1){
	    		   alert("操作成功");
	    	   }else{
	    		   alert("操作失败");
	    	   }
 	       }
 	 });
 }
 
//校验
function validateLayoutInfo(){
	 return $("#infoForm").validate({
			onfocusout: function(element) { $(element).valid(); },  
			rules:{
			},
			messages:{
				name:{
					required:"请输入户型名称",
				},coveredArea:{
					required:"请输入建筑面积",
					number:"请输入正确的建筑面积",
				},usedArea:{
					required:"请输入使用面积",
					number:"请输入正确的使用面积",
				},unitPrice:{
					required:"请输入单价",
					number:"请输入正确的单价",
				},totalPrice:{
					required:"请输入总价",
					number:"请输入正确的总价",
				}
			},
	        errorPlacement: function(error, element){
	            error.appendTo(element.parent());
	        }
		}); 
}
$("#name").attr("required","true");
$("#coveredArea").attr("required","true");
$("#coveredArea").attr("number","true");
$("#usedArea").attr("required","true");
$("#usedArea").attr("number","true");
$("#unitPrice").attr("required","true");
$("#unitPrice").attr("number","true");
$("#totalPrice").attr("required","true");
$("#totalPrice").attr("number","true");

</script>