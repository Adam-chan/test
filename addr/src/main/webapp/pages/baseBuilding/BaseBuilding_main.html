
<div class="row">
	<div  class="col-sm-2 col-md-2 col-lg-2" style="border-top: 1px solid #D0D0D0;">
		<!-- 左侧树形菜单 -->
		<div class="st_treeMenu" position: relative; overflow: auto;>
			 <div class="" style="border: 0px;height:800px">
				<ul id="build" style="margin-top: 12px">
					<li id="houseId"  > 
						<i id="icon" class="iconfont">&#xe71e;</i>
						
						<a data-toggle="tab" id="isPan">
						<#if basePremises??>
							${basePremises.name!}
						</#if>
						</a>
						<button class="btn btn-xs btn-icon btn-white btn-blue btn_endit">
							<i class="iconfont">&#xe6dd;</i>
							<span>编辑</span>
						</button>
					</li>	
					<div style="display:block;" >
						<ul  style="margin-left: 25px;" class="dataList">
							<li id="" class="example">
								<input name="groupId" lang="groupId" type="hidden"   />
								<a name="groupName" lang="groupName" align="center" class="showUl"></a>
								<ul id="isflg" style="display:block; margin-left: 10px">
								</ul>	
							</li>
						</ul> 	
					</div>	
				</ul>
			</div>
		</div>
	</div>
	<div id="buildingTable" class="col-sm-10 col-md-10  col-lg-10" style="border-left: 1px solid #D0D0D0; " >
		<div class="row" style="margin:0">
			<table class="table" style="margin-bottom: 0px">
					<tr class="trColor">
						<td  colspan="3" width="100%">
							<button class="btn btn-xs btn-icon btn-white btn-blue btn_group" style="height: 35px">
	   							<i class="iconfont">&#xe6e0;</i><span>添加楼栋分组</span>
	         					</button>
	         					<button class="btn btn-xs btn-icon btn-white btn-blue btn_building" style="height: 35px">
	   							<i class="iconfont">&#xe6e0;</i><span>添加楼栋信息</span>
	         					</button>
	         				</td>
					</tr>
					<tr>
						<td  colspan="3" width="100%"><input id="checkAll" onclick="aihome.check_all(this);" name="checkAll"  type="checkbox"/>
						全选 
						<button style="margin-left: 15px; id="busi_del" class="btn btn-sm btn-white btn-info btn_del">
	   						<i class="iconfont">&#xe6e3;</i>
	   						<span>删除</span>
	 						</button>
	 						</td>
					</tr>
					<tr class="trColor">
						<td  width="14%"></td><td width="50%">分组名称</td><td width="36%">操作</td>
					</tr>
			</table>
			<table  class=" table" >
				<tbody class='groupList'>
			         <tr class="group  prgroup" style="display: none" >
			          	 <td width="10%"><input type="checkbox" class="check" name="checkbox" onclick="aihome.check(this)"></td></td>
				         <td width="50%" align="left">
				         <i id="icons" class="iconfont">&#xe71e;</i>
				         	<input name="groupName" id="groupName" value="" lang="groupName"  type="text" maxlength="10" />
				         	<input name="groupId" id="groupId" value="" lang="groupId" type="hidden" />
				         </td>
				         <td width="36%"  align="left"><a  id="deleteBtn"  onclick="aihome.deleteGroup(this);">删除</a></td>
			         </tr>
		       </tbody>
			</table>
		</div>	
		<div class="container-fuild" style="text-align: center;">
			<button style="margin-top: 8%" id="saveButton" type="button" class="btn btn-sm btn-blue btn_sav">保存更改</button>
		</div>
	</div>
	<!-- 单元房间页面 -->
	<div class="col-md-10" hidden="hidden" id="unitRoom">
		<div id="unitInfo">
			<table class="table table-striped table-bordered" style="width: 1000px">
				<thead style="border: 1px solid;">
					<tr>
						<td colspan="10">单元信息
							<button class="btn btn-xs btn-icon btn-white btn-blue" onclick="aihome.store()">
							<i class="iconfont"></i> 商铺
							</button>
						</td>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>单元数:
							<input type="text" style="width: 80px" id="unitCount" placeholder="必填项"><span style="color:red"> *</span>
							单元编号类型:
							<input type="radio" name="type" id="number" value="number">阿拉伯数字编号
							<input type="radio" name="type" id="char" value="char"> 字母编号
							房屋用途:
							<select id="purpose" style="width: 100px">
								<option id="purposeOption">住宅</option>
								<option id="purposeOption">商铺</option>
								<option id="purposeOption">写字楼</option>
							</select>
						</td>
					</tr>
					<tr>
						<td>
							单元前缀：<input type="text" style="width: 80px" id="unitPre" maxlength="" onkeyup="aihome.checksum(this)">
							单元后缀：<input type="text" style="width: 80px" id="unitSuf" maxlength="" onkeyup="aihome.checksum(this)">
							号段起始：<input id="numStart" type="text" style="width: 80px" placeholder="必填项"><span style="color:red"> *</span>
							号段终止：<input id="numEnd" type="text" style="width: 80px" placeholder="必填项"><span style="color:red"> *</span>
						</td>
					</tr>
					<tr>
						<td>梯户数：
							<input type="text" style="width: 60px" id="num1" placeholder="必填项"><span style="color:red"> *</span>梯
							<input type="text" style="width: 60px" id="num2" placeholder="必填项"><span style="color:red"> *</span>户
							地上楼层起：<input type="text" style="width: 80px" id="num3" placeholder="必填项"><span style="color:red"> *</span>
							地上总层数：<input type="text" style="width: 80px" id="num4" placeholder="必填项"><span style="color:red"> *</span>
							地下楼层：<input type="text" style="width: 80px" id="num5">
						</td>
					</tr>
					<tr>
						<td>忽略楼层数：<input type="text" style="width: 80px" id="num6"></td>
					</tr>
				</tbody>
			</table>
		</div>
		<div id="roomInfo">
			<table class="table table-striped table-bordered" style="width: 1000px " id="roomInformationTable">
				<thead style="border: 1px solid;">
					<tr>
						<td style="width: 90%">房间信息</td>
						<td style="width: 10%" onclick="aihome.showRoomInfo()"><a>展开房间</a>
						</td>
					</tr>
				</thead>
				<tbody id="roomInfomation">
					<tr>
						<td colspan="2">生成规则: 
							<input type="radio" name="rule" id="floor" value="floor" />单层排序
							<input type="radio" name="rule" id="unit" value="unit" />整单元排序 
							<input type="radio" name="floor" id="floorFill" onclick="aihome.setSelectUserNo(this)"/>楼层"0"补位 
							<input type="radio" name="room" id="roomFill" onclick="aihome.setSelectUserNo(this)"/>房间"0"补位 
							<span style="font-size:12px;">&nbsp;&nbsp;&nbsp;</span>
							忽略数字：<input type="text" id="num" />
						</td>
					</tr>
					<tr>
						<td colspan="2">
							前缀：<input type="text" style="width: 80px" id="prefix" maxlength="" onkeyup="aihome.checksum(this)"/> 
							<input type="checkbox" id="connect">+"-"连接 
							<span style="font-size:12px;">&nbsp;&nbsp;&nbsp;</span>
							区间：<input type="text" style="width: 60px" id="start" />——<input type="text" style="width: 60px" id="end" />
							<span style="font-size:12px;">&nbsp;&nbsp;&nbsp;</span>
							+后缀：<input type="text" style="width: 80px" id="suffix" maxlength="" onkeyup="aihome.checksum(this)">
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div id="roomPreview">
			<table class="table table-striped table-bordered" style="width: 1000px;">
				<thead style="border: 1px solid;">
					<tr>
						<td style="width: 90%;">房间预览</td>
						<td style="width: 10%" onclick="aihome.showRoom(1)"><a>生成房间</a></td>
					</tr>
				</thead>
			</table>
		</div>
		<div id="getBuildingId" style="display: none;"></div>
		<div id="creatRoom" style="width: 1000px;">
			<div id="room">
				<div id="roomsBut" hidden="hidden">
					<button class="btn btn-xs btn-icon btn-white btn-blue" onclick="aihome.store()">
						<i class="iconfont">&#xe725;</i> 商铺
					</button>
					<button class="btn btn-xs btn-icon btn-white btn-blue" onclick="aihome.editRoom()">
						<i class="iconfont">&#xe725;</i> 编辑
					</button>
					<button class="btn btn-xs btn-icon btn-white btn-blue" onclick="aihome.restoreRoom()">
						<i class="iconfont">&#xe6e0;</i> 新增房间
					</button>
					<button class="btn btn-xs btn-icon btn-white btn-blue" onclick="aihome.batchUpdateHouse()">
						<i class="iconfont">&#xe6dd;</i> 批量修改
					</button>
					<button class="btn btn-xs btn-icon btn-white btn-blue" onclick="aihome.deleteRoom()">
						<i class="iconfont">&#xe6e3;</i> 删除房间
					</button>
				</div>
				<div style="position: relative; overflow: auto; height: 700px" id="hiddenLayer">
					<div style="position:relative;" id="roomsView"></div>
				</div>
				<button class="btn btn-xs btn-icon btn-blue" id="save"
					onclick="aihome.saveRooms()" style="display:none ;">
					<span><i> </i></span>保存
				</button>
				<button class="btn btn-xs btn-icon btn-blue" id="saveAgain"
					onclick="aihome.saveAgainRooms()" style="display: none;">
					<span><i> </i></span>保存
				</button>
			</div>
		</div>
	</div>
</div>
<!-- 楼盘id、区域id -->
<input type="hidden" id="premisesId"  value="${premisesId!}"/>
<input type="hidden" id="areaId"  value="${areaId!}"/>
<input type="hidden" id="premisesName"  value="${basePremises.name!}"/>
<input type="hidden" id="gName" />
<input type="hidden" id="buildingId"/>
<input type="hidden" id="bName"/>
<input type="hidden" id="groupId"/>
<style type="text/css">
.trColor{background-color: #F5F5F5}
td{border-bottom: #D7D7D7 solid 1px;}
ul,li{list-style: none;margin: 0px;padding: 0px; font-size: 16px #3374B1;}
#houseId{float: inherit;}
.nav nav-tabs{float: inherit;}
.buildingGroupId_4{float: inherit;}
a{margin: 0px;padding: 0px;color: #0196FF}
</style>
<script type="text/javascript">
var aihome={
	charArr : ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K",
				"L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W",
				"X", "Y", "Z"],
	flag : true,//生成房间开关
	dyArr : new Array(),//单元数组
	str : "",//ajax传参字符串
	refresh : 0,
	unitCount : 0,
	btnFlag : true,
	visFlag :"",
	tableMaxHeight : 0,
	tableMaxWidth : 0,
	store:function(){
		//获取楼栋id
		var buildingId=$("#buildingId").val();
		//获取高和宽
		var height = $(window).height()*0.8;
		var width = $(window).width()*0.8;
		//楼盘，分组，楼栋
		var groupName =$("#gName").val();
		var groupId =$("#groupId").val();
		var buildingName = $("#bName").val();
		//地址、	表头
		var url="${CTX}/baseBuilding/storeIndex.do?buildingId="+buildingId +"&premisesName=${basePremises.name}"+
				"&groupName="+groupName+"&groupId="+groupId+"&premisesId=${premisesId!}"+"&buildingName="+buildingName;
		var title ="商铺";
		this.openDialogOa(title,url,height,width);
	},
	//弹出窗口
	 openDialogOa:function(title,url,height,width){
		var but;
		if( title == "楼栋分组维护"){
			but = {
				"确定" : function() {//按钮和执行函数
					var type = aihome.addBatchGrou();
					if(type<1){
						return false;
					}else{
						
						alert("添加分组成功");
						//初始化树形菜单
						aihome.listMenuInit(1);
						//初始化分组和楼栋
						aihome.buildingGroup(1);
						$(this).dialog("close");
					}
				}, 
				"取消" : function() {
					$(this).dialog("close");
				}
			}
		}else if(title =="添加栋座信息"){
			but ={
				"保存" : function(){
					var type = aihome.saveBaseBuilding();
					if(type>0){
						//初始化树形菜单
						aihome.listMenuInit(1);
						//初始化分组和楼栋
						aihome.buildingGroup(1);
						$(this).dialog("close");
					}
				}
			};
		}else if(title=="楼栋信息"){
			but ={
					"保存" : function(){
						var type = aihome.updateBaseBuilding();
						if(type>0){
							//初始化树形菜单
							aihome.listMenuInit(1);
							//初始化分组和楼栋
							aihome.buildingGroup(1);
							$(this).dialog("close");
						}
					}
				};
		}else if(title=="商铺"){
			but ={
					"退出" : function(){
							$(this).dialog("close");
					}
				};
		}else if(title=="修改单元"){
			but = {
					"确定" : function() {//按钮和执行函数
						var type = aihome.updateUnit();
						if(type<1){
							alert("修改失败")
							return false;
						}else{
							alert("修改成功");
							$(this).dialog("close");
						}
					}, 
					"取消" : function() {
						$(this).dialog("close");
					}
				}
		}else if(title=="批量修改房间"){
			but = {
					"保存并提交" : function() {//按钮和执行函数
						var type = aihome.batchUpdateBaseHouse();
						if(type<1 && type!=-2){
							alert("修改失败")
							return false;
						}else if(type == -2){
							alert("请选择要修改的数据！");
							return false;
						}else{
							alert("修改成功");
							$(this).dialog("close");
						}
					}
				}
		}else if(title=="编辑房间"){
			but = {
					"确定" : function() {//按钮和执行函数
						var type = aihome.updateHouseEdit();
						if(type<1){
							alert("修改失败")
							return false;
						}else{
							$(this).dialog("close");
						}
					}, 
					"取消" : function() {
						$(this).dialog("close");
					}
				}
		}
		oaDialogOpen("A",//对话框ID，必填，且不能与当前页面的ID重复
		{url:url,//目标地址
		title:title,//弹框的title
		closeOnEscpe:true,//是否通过escpe关闭弹框
		closeBtn:true,//是否显示关闭按钮
		width:width,//弹框的宽度
		height:height,
		buttons:but
	 })
	},
	//修改楼栋属性
	updateBuilding:function(obj){
		//获取楼栋id
		var buildingId=$(obj).parent().prev().find("[name='buildingId']").val();
		//获取高和宽
		var height = $(window).height()*0.5;
		var width = $(window).width()*0.45;
		//地址、	表头
		var url="${CTX}/baseBuilding/updateBuildingIndex.do?premisesId="+${premisesId!''}+"&baseBuildingId="+buildingId+"&premisesName=${basePremises.name!}";
		var title ="楼栋信息";
		this. openDialogOa(title,url,height,width);
	},
	//单元添加或查看编辑页面
	unit:function(obj){
		var num = 0;
		if($(obj).next().val()!=undefined){
			num=$(obj).next().val();
		}
		var buildingId = $(obj).next().attr("id");//楼栋id
		var groupId = $(obj).parent().parent().parent().find("[name='groupId']").val();//分组id
		var groupName = $(obj).parent().parent().parent().find("[name='groupName']").text();//分组名称
		$("#gName").val(groupName);
		var buildingName = $(obj).text();
		$("#bName").val(buildingName);
		$("#buildingId").attr("value",buildingId);
		$("#groupId").attr("value",groupId);
		if(num>0){
			//跳转到编辑页面
			$("#roomsView").empty();
			aihome.unitCount=0;
			aihome.btnFlag = true; 
			aihome.tableMaxHeight = 0,
			aihome.tableMaxWidth = 0,
			aihome.editUnit(buildingId);
			$("#buildingTable").hide();
			$("#hiddenLayer").show();
			$("#room").show();
			$("#unitRoom").show();
			$("#saveAgain").show();
		}else{
			//跳转到添加页面
			aihome.unitCount=0;
			aihome.btnFlag = true;
			aihome.tableMaxHeight = 0,
			aihome.tableMaxWidth = 0,
			$("#unitRoom input[type='text']").each(function(){
				$(this).val("");
			});
			$("#unitRoom input[type='radio']").each(function(){
				$(this).removeAttr("checked");
			});
			$("#roomsView").empty();
			$("#buildingTable").hide();
			$("#unitRoom").show();
			$("#unitInfo").show();
			$("#roomInfo").show();
			$("#roomPreview").show();
			$("#hiddenLayer").hide();
			$("#room").hide();
			$("#roomsBut").hide();
			$("#saveAgain").hide();
		}
	},
	//单选控制全选按钮
	check:function (obj) {
		if( $('input[name="checkbox"]:checked').length==$(".check").length-1){
			$("[name='checkAll']").prop("checked", "checked");
		}else{
			  $("[name='checkAll']").removeAttr("checked");
		}
	},
	//全选全不选
	check_all:function (obj) {
		if(!$(obj).prop("checked")) {
			$(":checkbox").prop("checked", "");
		} else {
			$(":checkbox").prop("checked", "checked");
		}
	},
	//删除楼栋
	deleteFun:function(groupId){
		//获取楼栋id
		var value = $(groupId).parent().prev().find("[name='buildingId']").val();
		if(confirm("确认删除楼栋？")){
			//ajax成功后刷新页面
			$.ajax({
				type: "POST",
				url: '${CTX}/baseBuilding/delGroupBuild.do',
				data: {
					"buildingId":value
				},
				dataType: "json",
				async:false,
				success: function(data) {
					if(data>0){
						alert("删除成功");	
					}else{
						alert("删除失败,请先删除单元信息！")
					}
				}
			});
			this.buildingGroup(this.refresh);
			this.listMenuInit(this.refresh);
		}
	},
	//删除分组
	deleteGroup:function(groupId){
		//获取分组id
		var groupId = $(groupId).parent().prev().find("[name='groupId']").val();
		if( ($("."+groupId).length)>0 ){
			if(confirm("分组下已有楼栋,还要删除吗？")){
					$.ajax({
						type: "POST",
						url: '${CTX}/baseBuilding/delGroupBuild.do',
						data: {
							"groupId":groupId
						},
						dataType: "json",
						async:false,
						success: function(data) {
							if(data>0){
								alert("删除成功");	
							}else{
								alert("删除失败")
							}
						}
					});
					//ajax成功后刷新页面
					this.buildingGroup(1);
					this.listMenuInit(1);
			}
		}else{
			if(confirm("确认删除？")){
				$.ajax({
					type: "POST",
					url: '${CTX}/baseBuilding/delGroupBuild.do',
					data: {
						"groupId":groupId
					},
					dataType: "json",
					async:false,
					success: function(data) {
						if(data>0){
							alert("删除成功");	
						}else{
							alert("删除失败")
						}
					}
				});
				//ajax成功后刷新页面
				this.buildingGroup(this.refresh);
				this.listMenuInit(this.refresh);
			}
		}
		
	},
	//左侧导航栏
	listMenuInit:function(currentPage) {
		var opts = new PtsObject();
		opts.noData=function(){};
		opts.dataList = ".dataList";
		opts.pagination = ".pagination";
		opts.example = "example";
		opts.showCount = 1000;
		opts.searchForm = ".searchForm";
		if (currentPage) {
			opts.currentPage = currentPage;
		}
		opts.endFunction = function(opts, data) {
			refresh = opts.currentPage;
		}
		opts.formAction = "${CTX}/baseBuilding/getPremisesMenuPage.do?premisesId="+${premisesId!''};
		opts.detailFunction = function(obj, data) {
			var iputGroup = obj.find("input[name=groupId]")
			iputGroup.val(data.groupId);
			var list = data.listMenu;
			for(var i= 0;i< list.length;i++){
				obj.find("ul").append("<li><a onclick='aihome.unit(this)'>"+list[i].buildingName+"</a><input id='"+list[i].buildingId+"' type='hidden' value='"+list[i].statistics+"'/></li>");
			}
			//隐藏显示楼栋
			obj.find("a").click(function(){
				if($(this).next().css("display")=="none"){
					$("#isflg").css("display", "none");
					$(this).next().css("display", "block");
				}else{
					$(this).next().css("display", "none");
				}
				
			});
		}
		GDPaging.initDataList(opts);
	},
	//中间部分分组和楼栋
	buildingGroup:function(currentPage) {
		var opts = new PtsObject();
		opts.noData=function(){};
		opts.dataList = ".groupList";
		opts.pagination = ".pagination";
		opts.example = "group";
		opts.showCount = 1000;
		opts.searchForm = ".searchForm";
		if (currentPage) {
			opts.currentPage = currentPage;
		}

		opts.formAction = "${CTX}/baseBuilding/getPremisesMenuPage.do?premisesId="+${premisesId!''};
		opts.detailFunction = function(obj, data) {
			var iputGroup = obj.find("input[name=groupName]")
			iputGroup.val(data.groupName);
			obj.find("input[name=groupId]").val(data.groupId);
			$(obj).find("i").click(function(){
				if($("."+data.groupId).length){
					if($(this).parent().parent().next().css("display")=="none"){
						$(this).html("&#xe71e;");
					$("."+data.groupId).css("display", "table-row");
					}else if($(this).parent().parent().next().css("display")=="table-row"){
						$(this).html("&#xe71d;"); 
					$("."+data.groupId).css("display", "none");
					}
				}
				
			})
			//限制未分组的分组操作
			if(data.groupName === "未分组"){
				iputGroup.attr("disabled","disabled");
				$(obj).find("a[id='deleteBtn']").remove(); 
				$(obj).find("input[name='groupName']").parent().prev().find("input").attr("type","hidden")
			}
		
			var list = data.listMenu;
			for(var i= 0;i<list.length;i++){
				obj.find("td").parent().parent().append(
						'<tr class="'+data.groupId+' building" > <td width="10%"></td></td><td width="50%" align="left"><i style="margin-left: 60px" class="iconfont">&#xe71c;</i> '+
						'<input name="buildingName" value="'+list[i].buildingName+'" type="text"  maxlength="10"/>'+
						' <input name="buildingId"  value="'+list[i].buildingId+'" type="hidden"  />'+ 
						'</td><td width="36%"  align="left" ><a  id="deleteBtn"  onclick="javascript:aihome.deleteFun(this);">删除</a><a  id="deleteBtn"  onclick="javascript:aihome.updateBuilding(this);"style=" margin-left:20px">修改</a></td> </tr>'
						)
			}
		}
		GDPaging.initDataList(opts);
	},
	//展开房间
	showRoomInfo:function() {
		var obj = $("#roomInfomation");
		obj.toggle();
	},
	//生成房间
	showRoom:function(time,unit,type,unitPre,unitSuf,numStart,numEnd,num2,num3,num4,num6,rule,floor,room,num,prefix,floorNum,connect,start,end,suffix,firstCode) {
		if(time == 1){
			$("#room").show();
			$("#hiddenLayer").show();
			var num2 = $("#num2").val();//户数
			var unit = $("#unitCount").val();//单元数
			var unitPre = $("#unitPre").val();//单元前缀
			var unitSuf = $("#unitSuf").val();//单元后缀
			var num1 = $("#num1").val();//梯数
			var num = $("#num").val(); //忽略房间号
			var num3 = $("#num3").val();//地上楼层起
			var num4 = $("#num4").val();//地上总层数
			var num5 = $("#num5").val();//地下楼层
			var num6 = $("#num6").val();//忽略楼层数
			var numStart = $("#numStart").val().toUpperCase();//号段起始
			var numEnd = $("#numEnd").val().toUpperCase();//号段终止
			var prefix = $("#prefix").val();//前缀
			var suffix = $("#suffix").val();//前缀
			var rule = $("input[name='rule']:checked ").val();//生成规则
			var floor = $("input[id='floorFill']:checked ").val();//楼层0补位
			var room = $("input[id='roomFill']:checked ").val();//房间0补位
			var floorNum = "on";//楼层号checkbox
			var connect = $("input[id='connect']:checked ").val(); //连接checkbox
			var type = $("input[name='type']:checked ").val(); //单元编号类型
			var start = $("#start").val();//区间开始
			var end = $("#end").val();//区间结束
			
			//--------------校验--------------
			if (unit == "" || unit == null) {
				alert("单元数为必填项");
				return;
			} else if (isNaN(unit)) {
				alert("单元数必须为数字类型");
				return;
			}else if(unit == 0){
				alert("单元数不能为0");
				return;
			}
	
			if (num2 == "" || num2 == null) {
				alert("户数为必填项");
				return;
			} else if (isNaN(num2)) {
				alert("户数必须为数字类型");
				return;
			}
	
			if (num3 == "" || num3 == null) {
				alert("地上楼层起为必填项");
				return;
			} else if (isNaN(num3)) {
				alert("地上楼层起必须为数字类型");
				return;
			}
	
			if (num4 == "" || num4 == null) {
				alert("地上总层数为必填项");
				return;
			} else if (isNaN(num4)) {
				alert("地上总层数必须为数字类型");
				return;
			}
			if (type == undefined || type == "" || type == null) {
				alert("请选择单元编号类型");
				return;
			}
	
			//--------------校验结束-----------------
			if (rule == "floor") {
				$("#roomsView").empty();
				aihome.unitCount = 0;
				aihome.btnFlag = true;
				this.showDcRoom(time,unit,type,unitPre,unitSuf,numStart,numEnd,num2,num3,num4,num6,rule,floor,
						room,num,prefix,floorNum,connect,start,end,suffix,1);
				$("#save").show();
			} else if (rule == "unit") {
				$("#roomsView").empty();
				aihome.unitCount = 0;
				aihome.btnFlag = true;
				this.showDyRoom(time,unit,type,unitPre,unitSuf,numStart,numEnd,num2,num3,num4,num6,rule,floor,
						room,num,prefix,floorNum,connect,start,end,suffix,1);
				$("#save").show();
			} else {
				alert("单元排序规则为必选项");
				return;
			}
		}else if(time == 2){
			if (rule == "floor") {
				this.showDcRoom(time,unit,type,unitPre,unitSuf,numStart,numEnd,num2,num3,num4,num6,rule,floor,room,num,prefix,floorNum,connect,start,end,suffix,firstCode);
			} else if (rule == "unit") {
				this.showDyRoom(time,unit,type,unitPre,unitSuf,numStart,numEnd,num2,num3,num4,num6,rule,floor,room,num,prefix,floorNum,connect,start,end,suffix,firstCode);
			}
		}
	},
	//单层排序
	showDcRoom:function(time,unit,type,unitPre,unitSuf,numStart,numEnd,num2,num3,num4,num6,rule,floor,room,num,prefix,floorNum,connect,start,end,suffix,firstCode){
			var neglectRoomsArr = new Array();//忽略房间数组
			var neglectFloorsArr = new Array();//忽略楼层数组
			var unitsList = new Array();//单元信息数组
			var fjArr = new Array();//房间区间数组
			var num7 = parseInt(num4) + parseInt(num3) - 1;//地上楼层止
			var buildingId = $("#buildingId").val();//楼栋id
			var groupId = $("#groupId").val();//楼盘分组id
			var premisesId = $("#premisesId").val();//楼盘id
			var roomsCount = num2 * num4;//单元总房间
			var roomsCount = parseInt(num2) * parseInt(num4);//单元总户数
			var num1 = $("#num1").val();//梯数
			var num5 = $("#num5").val();//地下楼层
			var purpose = "";
			if($("#purpose option:selected").text() == "住宅"){
				purpose　= 1;
			}else if($("#purpose option:selected").text() == "商铺"){
				purpose = 2;
			}else if($("#purpose option:selected").text() == "写字楼"){
				purpose = 3;
			}
			if (num6 !== null && num6 !== ""&& num6!==undefined) {
				var reg = /^[0-9,]+$/;
				if (reg.test(num6)) {
					if (num6.indexOf(",") !== -1) {
						var neglectTrArr = num6.split(",");
						for (var negTr = 0; negTr < neglectTrArr.length; negTr++) {
							if ((neglectTrArr[negTr] > parseInt(num7) || neglectTrArr[negTr] < parseInt(num3)) && neglectTrArr[negTr] != "") {
								alert("忽略楼层必须在区间内");
								return;
							} else {
								neglectFloorsArr = neglectTrArr;
							}
						}
					} else {
						neglectFloorsArr = num6;
					}
				} else {
					alert("忽略楼层号只能输入数字和英文逗号");
					return;
				}
			}
			if (type == "char") {
				var reg = /^[A-Za-z]+$/;
				//判断是否符合正则表达式
				if (numStart == "" || numStart == null) {
					alert("号段起始为必填项");
					return;
				} else if (numEnd == "" || numEnd == null) {
					alert("号段终止为必填项");
					return;
				} else if (!reg.test(numStart)) {
					alert("号段起始为字母类型");
					return;
				} else if (!reg.test(numEnd)) {
					alert("号段终止为字母类型");
					return;
				}
	
				for (var d = 0; d < this.charArr.length; d++) {
					if (this.charArr[d] == numStart) {
						startIndex = d;
					}
					if (this.charArr[d] == numEnd) {
						endIndex = d;
					}
				}
				if ((parseInt(endIndex) - parseInt(startIndex) + 1) !== parseInt(unit)) {
					alert("号段差值必须等于单元数");
					return;
				}
				dyArr = this.charArr.slice(startIndex, endIndex + 1);//返回区间数组
	
			} else if (type == "number") {
				if (numStart == "" || numStart == null) {
					alert("号段起始为必填项");
					return;
				} else if (numEnd == "" || numEnd == null) {
					alert("号段终止为必填项");
					return;
				} else if (isNaN(numStart)) {
					alert("号段起始为数字类型");
					return;
				} else if (isNaN(numEnd)) {
					alert("号段终止为数字类型");
					return;
				} else if ((parseInt(numEnd) - parseInt(numStart) + 1) !== parseInt(unit)) {
					alert("号段差值必须等于单元数");
					return;
				}
				var dyNumArr = [];//阿拉伯数字类型数组
				for (s = numStart; s <= numEnd; s++) {
					dyNumArr.push([ s ]);
				}
				dyArr = dyNumArr;
	
			}
			//当区间值为空
			var kgReg = /^[ ]+$/;
			if ((start == "" || start == null || kgReg.test(start))&& (end == "" || end == null || kgReg.test(end))) {
				start = 1;
				end = num2;
			}

			if (start !== "" || start !== null || !kgReg.test(start)) {
				if (end == "" || end == null || kgReg.test(end)) {
					alert("请填写完整区间");
					return;
				}
			}

			if (end !== "" || end !== null || !kgReg.test(end)) {
				if (start == "" || start == null || kgReg.test(start)) {
					alert("请填写完整区间");
					return;
				}
			}
			if(isNaN(start)){
				alert("区间开始必须为数字");
				return;
			}
			if(isNaN(end)){
				alert("区间结束必须为数字");
				return;
			}

			if (parseInt(end) - parseInt(start) + 1 != parseInt(num2)) {
				alert("区间差值必须等于户数");
				return;
			}
			
			//校验忽略房间
			if (num !== null && num !== "" && num!==undefined) {
				var reg = /^[0-9,]+$/;
				if (reg.test(num)) {
					if (num.indexOf(",") != -1) {
						var neglectTrTdArr = num.split(",");
						for (var negTd = 0; negTd < neglectTrTdArr.length; negTd++) {
							if ((neglectTrTdArr[negTd] > end || neglectTrTdArr[negTd] < start)
									&& neglectTrTdArr[negTd] != "") {
								alert("忽略数字必须在区间内");
								return;
							} else {
								neglectRoomsArr = neglectTrTdArr;//忽略数字为多个时
							}
						}
					} else {
						neglectRoomsArr = num;//忽略数字为单个
					}
				} else {
					alert("忽略数字只能输入数字和英文逗号");
					return;
				}
			}
			
			var fjArr = new Array();//房间区间数组
			for (var f = start; f <= end; f++) {
				fjArr.push([ f ])
			}
				$("#creatRoom").show();
				str = "[";
				var foStart = time == 1?1:numStart;
				var forEnd = time == 1?unit:numEnd;
				var bottomPx = time ==1?"bottom: 0;":"";
				for (var i = foStart; i <= forEnd; i++) {
					str += "{" + "\"" + "roomList" + "\"" + ":[";
					var table = $("<table id=\"table" + i + "\"class=\"table table-bordered\"style=" +"\"margin-bottom: 0;width:" + 120 * parseInt(num2) + "px;height:" + 
							45 * (parseInt(num4) + 1) + "px;"+bottomPx+"float:left;\" \"onclick=\"aihome.getTable(this)\"></table>");
					$("#roomsView").append(table);
					var unitCode = time == 1?dyArr[i - 1]:numStart
					var unitName = unitPre +  unitCode + unitSuf;
					for (var j = num7; j >= num3; j--) {
						var trId = i + "" + j;
						var tr = $("<tr onclick=\"aihome.getTr(this)\"id=\"" + trId + "\"style=\"height:45px;\"></tr>");
						$("#table" + i).append(tr);
						for (var k = 0; k < num2; k++) {
							var fj = fjArr[k];
							var lc = "";
							var status = 0;//房间状态(1.正常 2.删除)

							if (floorNum == "on") {
								lc = j;
							}

							var con = "";
							if (connect == "on") {
								con = "-";
							}

							if (floor == "1") {
								if (floorNum == "on") {
									lc = this.cover(lc, 2);
								} else {
									lc = "";
								}
							}
							if (room == "1") {
								fj = this.cover(fj, 2);
							}
							if (num5 == "" || num5 == null) {
								num5 = 0;
							}
							
							var houseNumber = prefix + lc + con + fj + suffix;
							var roomId = i + "" + j + "" + k;
							var td = $("<td style=\"white-space: nowrap;width:120px;text-align: center;vertical-align: middle;cursor:pointer;\"id=\"room" + 
									roomId + "\"onclick=\"aihome.getTd(this)\"><input style=\"display:none\" value=\""+unitCode+"\"><font>" + houseNumber + "</font><input hidden =\"hidden\"></td>");
							tr.append(td);
							this.neglectFloors(neglectFloorsArr, j, trId);
							this.neglectRooms(neglectRoomsArr, fjArr[k], roomId);
							var status = this.getRoomStatus(roomId);
							var ruleStr = this.getRuleStr(floor, room, floorNum,connect, rule);//房间信息所有规则字符串
							roomsList = [ houseNumber, j, status, unitCode,buildingId, groupId, premisesId,purpose];
							unitList = [ buildingId, unitCode, prefix, suffix,roomsCount, neglectRoomsArr, num1, num2,
							             num4, num3, num5, start, end,ruleStr, groupId, premisesId,purpose];
							str += "{\"houseName\":\""+ roomsList[0] + "\",\"num\":" + roomsList[1] + ",\""
									+ "status\":" + roomsList[2]+ ",\"unitCode\":\""+ roomsList[3] + "\",\"" 
									+ "buildingId\":\"" + roomsList[4] + "\",\"groupId\":\"" + roomsList[5]
									+ "\",\"premisesId\":\""+ roomsList[6] + "\",\"purpose\":\"" + roomsList[7] +"\"},";
						}
					}
					str = str.substring(0, str.length - 1);
					str += "],\"buildingId\":\""+ unitList[0] +"\",\"code\":\""+ unitList[1] + "\",\"prefix\":\""
							+ unitList[2] + "\",\"suffix\":\""+ unitList[3] + "\",\"roomTotal\":" + unitList[4] 
							+ ",\"roomIgnore\":\"" + unitList[5] + "\",\"ladders\":\"" + unitList[6] + "\",\"flats\":" 
							+ unitList[7] + ",\"floors\":" + unitList[8] + ",\"upFloors\":" + unitList[9] 
							+ ",\"underFloors\":" + unitList[10] + ",\"numStart\":" + unitList[11]+ ",\"numEnd\":" 
							+ unitList[12] + ",\"generativeRule\":"+ unitList[13] + ",\"groupId\":\"" + unitList[14]
							+ "\",\"premisesId\":\""+ unitList[15] + "\",\"purpose\":\""+ unitList[16] + "\"},";
					if(time == 2){//回显
						var chooseTr = $("<tr></tr>");
						for (var l = 0; l < num2; l++) {
							var td = $("<td style=\"border-right:1px solid #fff;text-align:center;color:#DEB887;cursor:pointer;\" onclick=\"aihome.checkAll(this)\";>√全选</td>");
							chooseTr.append(td);
						}
						$("#table" + i).append(chooseTr);
					}
					
					var unitTr = $("<tr name=\"unitNameTr\" onclick=\"aihome.getTr(this)\"><td colspan= \""
								+(parseInt(num2))+"\"style=\"text-align: center;vertical-align: middle;background:#66B3FF;border-right:1px solid #66B3FF;\">"
								+ unitName + "<input id='unitId' hidden =\"hidden\">"
								+"<a onclick=aihome.editBaseUnit(this) style=\""+(time==1?"display:none":"dispaly:block")+"\"><i class=\"iconfont\">&#xe6dd;</i></a><a onclick=aihome.delunit(this) style=\""+(time==1?"display:none":"dispaly:block")+"\"><i class=\"iconfont\">&#xe6e3;</i></a></td></tr>");
					$("#table" + i).append(unitTr);
					var h = $("#hiddenLayer").css("height");
					h = h.substring(0, h.length - 2);
					if (parseInt(h) > (((parseInt(num4) + 1) * 45)+17.5)) {
						$("#hiddenLayer").css("height",(((parseInt(num4) + 1) * 45)+17.5) + "px");
					}
					if(aihome.tableMaxHeight < $("#table" + i).height()) {
						aihome.tableMaxHeight = $("#table" + i).height();
					}
					if(aihome.tableMaxWidth < $("#table" + i).width()) {
						aihome.tableMaxWidth = $("#table" + i).width();
					}
					aihome.unitCount++;
				}
				$("#roomsView").css("width", (aihome.tableMaxWidth+5) * forEnd);
				$("#roomsView").css("height", aihome.tableMaxHeight+20);
				str = str.substring(0, str.length - 1);
				str += "]";
				$("#hiddenLayer").scrollTop(aihome.tableMaxHeight);
		},
	//单元排序
	showDyRoom:function(time,unit,type,unitPre,unitSuf,numStart,numEnd,num2,num3,num4,num6,rule,floor,room,num,prefix,floorNum,connect,start,end,suffix,firstCode) {
		var neglectRoomsArr = new Array();//忽略房间数组
		var neglectFloorsArr = new Array();//忽略楼层数组
		var roomsList = new Array();//房间信息数组
		var unitsList = new Array();//单元信息数组
		var fjArr = new Array();//房间区间二维数组
		var num7 = parseInt(num4) + parseInt(num3) - 1;//地上楼层止
		var buildingId = $("#buildingId").val();//楼栋id
		var groupId = $("#groupId").val();//楼盘分组id
		var premisesId = $("#premisesId").val();//楼盘id
		var roomsCount = num2 * num4;//单元总房间
		var num1 = $("#num1").val();//梯数
		var num5 = $("#num5").val();//地下楼层
		var roomsCount = parseInt(num2) * parseInt(num4);//单元总户数
		var purpose = "";
		if($("#purpose option:selected").text() == "住宅"){
			purpose　= 1;
		}else if($("#purpose option:selected").text() == "商铺"){
			purpose = 2;
		}else if($("#purpose option:selected").text() == "商住两用"){
			purpose = 3;
		}
		//------------------------------
			if (num6 !== null && num6 !== "") {
				var reg = /^[0-9,]+$/;
				if (reg.test(num6)) {
					if (num6.indexOf(",") !== -1) {
						var neglectTrArr = num6.split(",");
						for (var negTr = 0; negTr < neglectTrArr.length; negTr++) {
							if ((neglectTrArr[negTr] > parseInt(num7) || neglectTrArr[negTr] < parseInt(num3)) && neglectTrArr[negTr] != "") {
								alert("忽略楼层必须在区间内");
								return;
							} else {
								neglectFloorsArr = neglectTrArr;
							}
						}
					} else {
						neglectFloorsArr = num6;
					}
				} else {
					alert("忽略楼层号只能输入数字和英文逗号");
					return;
				}
			}
			if (type == "char") {
				var reg = /^[A-Za-z]+$/;
				//判断是否符合正则表达式
				if (numStart == "" || numStart == null) {
					alert("号段起始为必填项");
					return;
				} else if (numEnd == "" || numEnd == null) {
					alert("号段终止为必填项");
					return;
				} else if (!reg.test(numStart)) {
					alert("号段起始为字母类型");
					return;
				} else if (!reg.test(numEnd)) {
					alert("号段终止为字母类型");
					return;
				}
	
				for (var d = 0; d < this.charArr.length; d++) {
					if (this.charArr[d] == numStart) {
						startIndex = d;
					}
					if (this.charArr[d] == numEnd) {
						endIndex = d;
					}
				}
				if ((parseInt(endIndex) - parseInt(startIndex) + 1) !== parseInt(unit)) {
					alert("号段差值必须等于单元数");
					return;
				}
				dyArr = this.charArr.slice(startIndex, endIndex + 1);//返回区间数组
	
			} else if (type == "number") {
				if (numStart == "" || numStart == null) {
					alert("号段起始为必填项");
					return;
				} else if (numEnd == "" || numEnd == null) {
					alert("号段终止为必填项");
					return;
				} else if (isNaN(numStart)) {
					alert("号段起始为数字类型");
					return;
				} else if (isNaN(numEnd)) {
					alert("号段终止为数字类型");
					return;
				} else if ((parseInt(numEnd) - parseInt(numStart) + 1) !== parseInt(unit)) {
					alert("号段差值必须等于单元数");
					return;
				}
				var dyNumArr = [];//阿拉伯数字类型数组
				for (s = numStart; s <= numEnd; s++) {
					dyNumArr.push([ s ]);
				}
				dyArr = dyNumArr;
	
			}
		//当区间值为空
		var kgReg = /^[ ]+$/;
		if ((start == "" || start == null || kgReg.test(start))
				&& (end == "" || end == null || kgReg.test(end))) {
			start = 1;
			end = num2 * num4;
		}
		if (start !== "" || start !== null || !kgReg.test(start)) {
			if (end == "" || end == null || kgReg.test(end)) {
				alert("请填写完整区间");
				return;
			}
		}

		if (end !== "" || end !== null || !kgReg.test(end)) {
			if (start == "" || start == null || kgReg.test(start)) {
				alert("请填写完整区间");
				return;
			}
		}
		if(isNaN(start)){
			alert("区间开始必须为数字");
			return;
		}
		if(isNaN(end)){
			alert("区间结束必须为数字");
			return;
		}
		if (parseInt(end) - parseInt(start) + 1 != (parseInt(num2)*parseInt(num4))) {
			alert("区间差值必须等于户数");
			return;
		}

		//校验忽略房间
		if (num !== null && num !== "") {
			var reg = /^[0-9,]+$/;
			if (reg.test(num)) {
				if (num.indexOf(",") !== -1) {
					var neglectTrTdArr = num.split(",");
					for (var negTd = 0; negTd < neglectTrTdArr.length; negTd++) {
						if ((neglectTrTdArr[negTd] > end || neglectTrTdArr[negTd] < start) && neglectTrTdArr[negTd] != "") {
							alert("忽略数字必须在区间内");
							return;
						} else {
							neglectRoomsArr = neglectTrTdArr;//忽略数字为多个时
						}
					}
				} else {
					neglectRoomsArr = num;//忽略数字为单个
				}
			} else {
				alert("忽略数字只能输入数字和英文逗号");
				return;
			}
		}

		//--------------------------------校验结束-----------------------------------			

		var fjArr = new Array();//房间区间二维数组
		//f:楼层
		for (var f = 0; f < parseInt(num4); f++) {
			fjArr[f] = new Array();
			//l：根据楼层生成的房间号
			for (var l = 0; l < parseInt(num2); l++) {
				//每个单元格对应的房间号
				fjArr[f][l] = f * parseInt(num2) + parseInt(start) + l;
			}

		}

			$("#creatRoom").show();
			str = "[";
			var foStart = time == 1?1:numStart;
			var forEnd = time == 1?unit:numEnd;
			var bottomPx = time ==1?"bottom: 0;":"";
			for (var i = foStart; i <= forEnd; i++) {
				str += "{\"roomList\":[";
				var table = $("<table id=\"table" + i + "\"class=\"table table-bordered\"style=" +"\"margin-bottom: 0;width:" + 120 * parseInt(num2) + "px;height:" + 
						45 * (parseInt(num4) + 1) + "px;"+bottomPx+"float:left;\" \"onclick=\"aihome.getTable(this)\"></table>");
				$("#roomsView").append(table);
				var unitCode = time == 1?dyArr[i - 1]:numStart
				var unitName = unitPre +  unitCode + unitSuf;
				for (var j = num7; j >= num3; j--) {
					var trId = i + "" + j;
					var tr = $("<tr onclick=\"aihome.getTr(this)\" id=\"" + trId + "\" style=\"height:45px;\"></tr>");
					$("#table" + i).append(tr);
					for (var k = 0; k < num2; k++) {
						var fj = fjArr[(j - num3)][k];
						var lc = "";
						if (floorNum == "on") {
							lc = j;
						}

						var con = "";
						if (connect == "on") {
							con = "-";
						}

						if (floor == "1") {
							if (floorNum == "on") {
								lc = this.cover(lc, 2);
							} else {
								lc = "";
							}
						}
						if (room == "1") {
							fj = this.cover(fj, 2);
						}
						if (num5 == "" || num5 == null) {
							num5 = 0;
						}
						var houseNumber = prefix + lc + con + fj + suffix;
						var roomId = i + "" + "" + j + "" + k;
						var td = $("<td style=\"white-space: nowrap;width:120px;text-align: center;vertical-align: middle;cursor:pointer;\" id=\"room" + roomId +
								"\"onclick=\"aihome.getTd(this)\"><input style=\"display:none\" value=\""+unitCode+"\"><font>" + houseNumber + "</font><input hidden =\"hidden\"></td>");
						tr.append(td);
						this.neglectFloors(neglectFloorsArr, j, trId);
						this.neglectRooms(neglectRoomsArr, fjArr[(j - num3)][k],roomId);
						var status = this.getRoomStatus(roomId);
						var ruleStr = this.getRuleStr(floor, room, floorNum,connect, rule);//房间信息所有规则字符串
						roomsList = [ houseNumber, j, status, unitCode,  buildingId, groupId, premisesId, purpose];
						unitList = [ buildingId, unitCode, prefix, suffix,roomsCount, neglectRoomsArr, num1, num2,
						             num4, num3, num5, start, end,ruleStr, groupId, premisesId];
						str += "{\"houseName\":\""+ roomsList[0] + "\",\"num\":" + roomsList[1] + ",\"status\":" + 
								roomsList[2] + ",\"unitCode\":\"" + roomsList[3] + "\",\"buildingId\":\"" + 
								roomsList[4] + "\",\"groupId\":\"" + roomsList[5] + "\",\"premisesId\":\"" +
								roomsList[6] + "\",\"purpose\":\"" + roomsList[7] +"\"},";
					}
				}
				str = str.substring(0, str.length - 1);
				str += "],\"buildingId\":\""+ unitList[0] + "\",\"code\":\""+ unitList[1] + "\",\"prefix\":\""+
						unitList[2] + "\",\"suffix\":\""+ unitList[3] + "\",\"roomTotal\":" + unitList[4] + 
						",\"roomIgnore\":\"" + unitList[5] + "\",\"ladders\":\"" + unitList[6] + "\",\"flats\":" + 
						unitList[7] + ",\"floors\":" + unitList[8] + ",\"upFloors\":" + unitList[9] +
						",\"underFloors\":" + unitList[10] + ",\"numStart\":" + unitList[11]+ ",\"numEnd\":" + 
						unitList[12] + ",\"generativeRule\":"+ unitList[13] + ",\"groupId\":\"" + unitList[14]
						+ "\",\"premisesId\":\""+ unitList[15] +"\"},";
				if(time == 2){
					var chooseTr = $("<tr></tr>");
					for (var l = 0; l < num2; l++) {
						var td = $("<td style=\"border-right:1px solid #fff;text-align:center;color:#DEB887;cursor:pointer;\" onclick=\"aihome.checkAll(this)\">√全选</td>")
						chooseTr.append(td);
					}
					$("#table" + i).append(chooseTr);
				}
				var unitTr = $("<tr name=\"unitNameTr\" onclick=\"aihome.getTr(this)\"><td colspan= \""
						+(parseInt(num2))+"\"style=\"text-align: center;vertical-align: middle;background:#66B3FF;border-right:1px solid #66B3FF;\">"
						+ unitName + "<input id='unitId' hidden =\"hidden\">"
						+"<a onclick=aihome.editBaseUnit(this) style=\""+(time==1?"display:none":"dispaly:block")+"\"><i class=\"iconfont\">&#xe6dd;</i></a><a onclick=aihome.delunit(this) style=\""+(time==1?"display:none":"dispaly:block")+"\"><i class=\"iconfont\">&#xe6e3;</i></a></td></tr>");
				$("#table" + i).append(unitTr);
				var h = $("#hiddenLayer").css("height");
				h = h.substring(0, h.length - 2);
				if (parseInt(h) > (((parseInt(num4) + 1) * 45)+17.5)) {
					$("#hiddenLayer").css("height",(((parseInt(num4) + 1) * 45)+17.5) + "px");
				}
				if(aihome.tableMaxHeight < $("#table" + i).height()) {
					aihome.tableMaxHeight = $("#table" + i).height();
				}
				if(aihome.tableMaxWidth < $("#table" + i).width()) {
					aihome.tableMaxWidth = $("#table" + i).width();
				}
				aihome.unitCount++;
			}
			$("#roomsView").css("width", (aihome.tableMaxWidth+5) * forEnd);
			$("#roomsView").css("height", aihome.tableMaxHeight+20);
			str = str.substring(0, str.length - 1);
			str += "]";
			$("#hiddenLayer").scrollTop(aihome.tableMaxHeight);
	},
	//楼层 房间 "0"补位
	cover:function(str, len) {
		var strArr = str.toString().split("");
		while (strArr.length < len) {
			strArr.unshift("0");
		}
		return strArr.join("");
	},
	//获取table的id
	getTable:function(table) {
		$("#getTbId").append($(table).attr("id") + ",");
	},
	//获取tr的id
	getTr:function(tr) {
		$("#getTrId").append($(tr).attr("id") + ",");
	},
	//忽略楼层
	neglectFloors:function(neglectFloorsArr, floor, trId) {
		for (var i = 0; i < neglectFloorsArr.length; i++) {
			if (neglectFloorsArr[i] == floor) {
				$("tr[id$=" + trId + "]").find("td").find("font").attr("style", "visibility:hidden;");
				$("tr[id$=" + trId + "]").find("td").css({"background-color" : "#A9A9A9","white-space": "nowrap","width":"120px","text-align": "center","cursor":"pointer"});
			}

		}

	},
	//单层排序忽略房间
	neglectRooms:function(neglectRoomsArr, fj, tdId) {
		for (var i = 0; i < neglectRoomsArr.length; i++) {
			if (neglectRoomsArr[i] == fj) {
				$("td[id$=" + tdId + "]").find("font").attr("style","visibility:hidden;");
				$("td[id$=" + tdId + "]").css({"background-color" : "#A9A9A9","white-space": "nowrap","width":"120px","text-align": "center","cursor":"pointer"});
			}
		}
	},
	//删除房间
	deleteRoom:function() {
		$("#roomsView").find("td").each(function(){
			if($(this).css("background-color")=="rgb(224, 255, 255)"){
				var roomId = $(this).find("input:last").val();
				$.ajax({
					type : "POST",
					url : "${CTX}/baseHouse/houseSource.do",
					dataType : "json",
					data : {
						"roomId" : roomId
					},
					success:function(data){
						if(data == 0){
							$(this).find("font").attr("style","visibility: hidden");
							$(this).css({"background-color" : "#A9A9A9","white-space": "nowrap","width":"120px","text-align": "center","cursor":"pointer"});
						}else{
							alert($(this).children("font").text()+"已被引用为房源");
						}
					}
				})
			}
		});
	},
	//增加房间
	restoreRoom:function() {
		oaDialogOpen("restoreRoomPage",//对话框ID，必填，且不能与当前页面的ID重复
		    {url:"${CTX}/baseHouse/restoreRoom.do?premisesName="+$("#premisesName").val()+"&gName="+$("#gName").val()+
		    		"&bName="+$("#bName").val()+"&buildingId="+$("#buildingId").val()+"&groupId="+$("#groupId").val()+"&premisesId="+$("#premisesId").val(),//调用页面的url
			title:"新增房间",//弹框的title
			closeOnEscpe:true,//是否通过escpe关闭弹框
			closeBtn:true,//是否显示关闭按钮
			width:800,//弹框的宽度
			height:500,
			buttons:{
				"确定" : function() {
					aihome.confirmHouse();
					$("#roomsView").empty();
					aihome.unitCount = 0;
					aihome.btnFlag = true;
					setTimeout(function(){return aihome.editUnit($("#buildingId").val());},"2000");
					$(this).dialog("close");
				},
				"取消" : function() {
					$(this).dialog("close");
				}
			},
			openCall:function(){
			},//弹框打开后的回调函数
			closeCall:function(){
			}//弹框关闭后的回调函数
		})
	},
	//获取房间状态(1.正常 ,2.删除)
	getRoomStatus:function(roomId) {
		var status = 0;
		var hideStatus = $("#room"+roomId).find("font").css("visibility");
		if(hideStatus == "visible"){
			status = 1;
			return status;
		}else if(hideStatus == "hidden"){
			status = 2;
			return status;
		}
	},
	//获取生成规则字符串
	getRuleStr:function(floor, room, floorNum, connect, rule) {
		var ruleStr = "";//规则字符串
		if (rule == "floor") {
			ruleStr = 1 + "";
		} else if (rule == "unit") {
			ruleStr = 2 + "";
		}
		if (floor == "1") {
			ruleStr += 3 + "";
		}
		if (room == "1") {
			ruleStr += 4 + "";
		}
		if (floorNum == "on") {
			ruleStr += 5 + "";
		}
		if (connect == "on") {
			ruleStr += 6 + "";
		}

		return ruleStr;
	},
	//单元编辑页面
	editUnit:function(buildingId){
		$("#roomsView").empty();
		$("#roomsBut").show();
		$.ajax({
			type : "POST",
			url : "${CTX}/baseBuilding/getEditUnit.do",
			dataType : "json",
			data : {
				"baseBuildingId" : buildingId
			},
			success : function(data) {
				for(var i = 0 ; i < data.length ; i++){
 					var rule = "";
					var floor = "";
					var room = "";
					var floorNum = "";
					var connect = "";
					if(data[i].generativeRule.toString().indexOf("1") > -1){
						rule = "floor";
					}else if(data[i].generativeRule.toString().indexOf("2") > -1){
						rule = "unit";
					}
					if(data[i].generativeRule.toString().indexOf("3") > -1){
						floor = "1";
					}
					if(data[i].generativeRule.toString().indexOf("4") > -1){
						room = "1";
					}
					if(data[i].generativeRule.toString().indexOf("5") > -1){
						floorNum = "on";
					}
					if(data[i].generativeRule.toString().indexOf("6") > -1){
						connect = "on";
					}
					//单元前缀
					var unitPre = data[i].unitPre == undefined ? "":data[i].unitPre;
					//单元后缀
					var unitSuf = data[i].unitSuf == undefined ? "":data[i].unitSuf;
					//前缀
					var prefix = data[i].prefix == undefined ? "":data[i].prefix;
					//后缀
					var suffix = data[i].suffix == undefined ? "":data[i].suffix;
					//区间开始
					var roomNumStart = data[i].roomNumStart == undefined ? "":data[i].roomNumStart;
					//区间结束
					var roomNumEnd = data[i].roomNumEnd == undefined ? "":data[i].roomNumEnd;
					aihome.showRoom(2,1,data[i].unitType,unitPre,unitSuf,data[i].code,data[i].code,
							data[i].flats,data[i].upFloors,data[i].floors,"",rule,floor,room,"",prefix,
							floorNum,connect,roomNumStart,roomNumEnd,suffix,data[0].code);
				}
				$("#unitInfo").hide();
				$("#roomInfo").hide();
				$("#roomPreview").hide();
				$("#save").hide();
				$("#saveAgain").show();
				$("#hiddenLayer").css("width","1400px");
				$("#hiddenLayer").css("height","700px");
				$("#hiddenLayer").scrollTop(aihome.tableMaxHeight);
				$(".table.table-bordered").each(function() {
					$(this).css("top", aihome.tableMaxHeight - $(this).height());
				})
				aihome.getRoomInfo(buildingId);
				aihome.getUnitsInfo(buildingId,unitPre,unitSuf);
			}
		});
	},
	//编辑房间
	editRoom:function(){
		var chooseCount = 0;
		var houseId ="";
		var houseName = "";
		$("#roomsView").find("td").each(function(){
			if($(this).css("background-color")=="rgb(224, 255, 255)"){
				chooseCount++;
				houseId += $(this).children("input:last").val();
				houseName += $(this).children("font").text();
			}
		});
		if(chooseCount == 0){
			alert("请选择房间");
			return;
		}
		if(chooseCount > 1){
			alert("只能编辑单个房间");
			return;
		}
		var title = "编辑房间";
		var height = $(window).height()*0.5;
		var width = $(window).width()*0.5;
		//楼盘，分组，楼栋 获取楼栋id
		var buildingId=$("#buildingId").val();
		var groupName =$("#gName").val();
		var groupId =$("#groupId").val();
		var buildingName = $("#bName").val();
		var url="${CTX}/baseHouse/editHousePage.do?houseId="+houseId+"&houseName="+houseName+"&buildingId="+
				buildingId+"&premisesName=${basePremises.name!}"+"&groupName="+groupName+"&groupId="+groupId+
				"&premisesId=${premisesId!}"+"&buildingName="+buildingName;
		aihome.openDialogOa(title,url,height,width);
	},
	//获取房间绑定信息
	getRoomInfo:function(buildingId){
		$.ajax({
			type : "POST",
			url : "${CTX}/baseHouse/getRoomInfo.do",
			dataType : "json",
			data : {
				"buildingId" : buildingId
			},
			success:function(data){
				var tds = $("#roomsView").find("td").find("font");
				for(var i = 0 ; i < data.length ; i++){
					tds.each(function(){
						if(data[i].unitCode+data[i].houseName == $(this).prev().val()+$(this).text()){
							$(this).next().attr("value",data[i].id);
							if(data[i].status == "2"){
								$(this).attr("style","visibility: hidden");
								$(this).parent().css({"background-color" : "#A9A9A9","white-space": "nowrap","width":"120px","text-align": "center","cursor":"pointer"});
							}
						}
					});
				}
			}
		})
	},
	//获取单元绑定信息	
	getUnitsInfo:function(buildingId,unitPre,unitSuf){
		$.ajax({
			type : "POST",
			url : "${CTX}/baseHouse/getUnitsInfo.do",
			dataType : "json",
			data : {
				"buildingId" : buildingId
			},
			success:function(data){
				var tds = $("#roomsView tr[name = 'unitNameTr']");
				for(var i = 0 ; i < data.length ; i++){
					tds.each(function(){
						var unitName = unitPre+data[i].code+unitSuf;
						if(unitName == $(this).find("td:first").text().toString().substring(0,$(this).find("td:first").text().toString().length-2)){
							$(this).find("td:first").find("input:first").attr("value",data[i].id);
						}
					});
				}
			}
		})
	},
	//保存
	saveRooms:function() {
		if(aihome.btnFlag){
			var unitNum = $("#unitCount").val();//单元数
			var unitPre = $("#unitPre").val();//单元前缀
			var unitSuf = $("#unitSuf").val();//单元后缀
			var unitType = $("input[name='type']:checked ").val();//类型
			var upFloorStart = $("#num3").val();//地上楼层起
			var upFloorTotal = $("#num4").val();//地上总层数
			var underFloors = $("#num5").val();//地下楼层
			var ignoreStairNum = $("#num6").val();//忽略楼层
			var numStart = $("#numStart").val();//号段起始
			var numEnd = $("#numEnd").val();//号段终止
			var buildingId = $("#buildingId").val();//楼栋id
			$.ajax({
				type : "POST",
				url : "${CTX}/baseBuilding/addRoom.do",
				dataType : "json",
				data : {
		 			"list" : str,
		 			"baseBuildingId" : buildingId,
					"unitNum" : unitNum,
					"unitPre" : unitPre,
					"unitSuf" : unitSuf,
					"unitType" : unitType,
					"upFloorStart" : upFloorStart,
					"upFloorTotal" : upFloorTotal,
					"underFloors" : underFloors,
					"ignoreStairNum" : ignoreStairNum,
					"numStart" : numStart,
					"numEnd" : numEnd
				},
				success : function(data) {
					if(data>0){
						alert("保存成功");
						$("#roomsView").empty();
						aihome.listMenuInit(1);
						aihome.flag = true;
						aihome.unitCount = 0;
						aihome.btnFlag = true;
						str="";
						aihome.editUnit(buildingId);
					}else{
						alert("保存失败");
					}
				}
			});
			aihome.btnFlag = false;
		}
	},
	//回显后再次保存
	saveAgainRooms:function(){
		if(aihome.btnFlag){
			var echoedTd = $("#roomsView").find("td").find("font");
			var str = "[";
			echoedTd.each(function(){
				var status = "";
				if($(this).css("visibility") == "hidden"){
					status = 2;
				}else if($(this).css("visibility") == "visible"){
					status = 1;
				}
				str += "{\"baseHouseIds\":"+$(this).next().val()+",\"status\":"+status+"},";
			})
			str = str.substring(0,str.length-1) + "]";
			$.ajax({
				type : "POST",
				url : "${CTX}/baseHouse/saveEchoedRoom.do",
				dataType : "json",
				data : {
					"list" : str
				},
				success : function(data) {
					if(data>0){
						alert("修改成功");
						str="";
					}else{
						alert("修改失败");
					}
				}
			})
			aihome.btnFlag = false;
		}
	},
	//单元删除
	delunit:function(obj){
		//获取单元id和楼栋id
		var unitId= $(obj).parent().prev().prev().find("[id='unitId']").val();
		var unitId= $(obj).parent().find("[id='unitId']").val();
		var buildingId = $("#buildingId").val();
		$.ajax({
		       type : "POST",
		       url : '${CTX}/baseBuilding/deletebuildingUnits.do',
		       dataType : 'json',
		       data : {"unitId":unitId},
		       async:false,
		       success : function(data) {
		    	   if(data>0){
						alert("删除成功");
						aihome.editUnit(buildingId);
						aihome.unitCount = 0;
		    	   }else if(data-1){
						alert("请先删除单元下的房间");
		    	   }else{
						alert("删除失败");
		    	   }
		      }
		   });
	
	},
	//单元编辑按钮
	editBaseUnit:function(obj){
		//获取单元id、分组名称、楼栋id、楼的名称
		var buildingUnitsId= $(obj).parent().find("[id='unitId']").val();
		var groupName =$("#gName").val();
		var buildingId = $("#buildingId").val();
		var buildingName = $("#bName").val();
		
		//获取高和宽
		var height = $(window).height()*0.45;
		var width = $(window).width()*0.35;
		//地址、	表头
		var url="${CTX}/baseBuilding/updateUnitIndex.do?baseBuildingId="+buildingId+"&premisesName=${basePremises.name!}"+
				"&groupName="+groupName+"&buildingName="+buildingName+"&buildingUnitsId="+buildingUnitsId;
		var title ="修改单元";
		aihome.openDialogOa(title,url,height,width);
	},
	batchUpdateHouse:function(){
		//获取房间id
		var houseIdsArray = [];
		$("#roomsView").find("td").each(function(){
			if($(this).css("background-color")=="rgb(224, 255, 255)"){
				houseIdsArray.push($(this).find("input:last").val());
			}
		})
		//判断房间i的存不存在
		if(houseIdsArray.length>0){
			//房间id的字符串
			var houseIds=houseIdsArray.join(",");
			//获取高和宽
			var height = $(window).height()*0.4;
			var width = $(window).width()*0.45;
			//地址、	表头
			var url="${CTX}/baseBuilding/batchUpdateHouseIndex.do?houseIds="+houseIds;
			var title ="批量修改房间";
			this. openDialogOa(title,url,height,width);
		}else{
			alert("请选择批量修改的房间");
			return false;
		}
	},
	//全选
	checkAll:function(allTd){
		var trIndex = parseInt($(allTd).parent().parent().parent().find("tr").length) - 2;
		var chooseCount =0;
		$(allTd).parent().parent().parent().find("tr:lt("+trIndex+")").each(function(){
			var td = $(this).children("td").eq($(allTd).index());
			if(td.css("background-color") == "transparent" || td.css("background-color") == "rgba(0, 0, 0, 0)"){
				chooseCount++;	
			}
		});
		if(chooseCount==0){
			$(allTd).parent().parent().parent().find("tr:lt("+trIndex+")").each(function(){
				var td = $(this).children("td").eq($(allTd).index());
				if(td.css("background-color")!="rgb(169, 169, 169)"){
					td.css("background-color","");
				}
			});
		}else{
			$(allTd).parent().parent().parent().find("tr:lt("+trIndex+")").each(function(){
				var td = $(this).children("td").eq($(allTd).index());
				if(td.css("background-color")!="rgb(169, 169, 169)"){
					td.css("background-color","#E0FFFF");
				}
			});
		}
	},
	//选中td单元格
	getTd:function(td) {
		if($(td).css("background-color") == "transparent" || $(td).css("background-color") == "rgba(0, 0, 0, 0)"){
			$(td).css("background-color","#E0FFFF");
		}else if($(td).css("background-color") == "rgb(224, 255, 255)"){
			$(td).css("background-color","");
		}
	},
	//radio选取
    setSelectUserNo:function(radioObj){
        var radioCheck= $(radioObj).val();  
        if("1"==radioCheck){  
            $(radioObj).attr("checked",false);  
            $(radioObj).val("0");  
        }else{   
            $(radioObj).val("1");  
        }  
    },
    checksum:function(chars){
    	var charVal = $(chars).val();
    	var len = 20;
	    for (var i=0; i<charVal.length; i++){
	        var c = charVal.charCodeAt(i); 
	        if (!(c >= 0x0001 && c <= 0x007e) || (0xff60<=c && c<=0xff9f)) { 
	        	len=len-2; 
	        }
	    }
	    $(chars).attr("maxLength",len);
    }
}

//初始化方法	
$(function(){
	//隐藏显示分组
	$("#isPan").click(function(){
		if($(this).parent().next().css("display")=="none"){
			$("#icon").html("&#xe71e;");
			$(this).parent().next().css("display", "block");
		}else{
			$("#icon").html("&#xe71d;");
			$(this).parent().next().css("display", "none");
		}
		
	});
	//初始化树形菜单
	aihome.listMenuInit(1);
	//初始化分组和楼栋
	aihome.buildingGroup(1);
	//删除所有分组
	$(".btn_del").click(function(){
		var groupIdArray=[];   
		var hasFlag=0;
		var groupId ="";
		$("input[name='checkbox']:checkbox:checked").each(function(){   
			groupId = $(this).parent().next().find("[name='groupId']").val();
			if(groupId!=""){
				if( ($("."+groupId).length)>0 ){
					hasFlag = $("."+groupId).length;
					return false;
				}
				groupIdArray.push(groupId);  	
			}
		})   
		if($("input[name='checkbox']:checkbox:checked").length<1 || groupId==""){
			alert("请先选择要删除的数据！")
			return false;
		}
		if(hasFlag > 0) {
			alert("请先删除分组下的楼栋！");
			return false;
		}
		var groupIds = groupIdArray.join(",");
		$.ajax({
			type: "POST",
			url: '${CTX}/baseBuilding/delGroupBuild.do',
			data: {
				"groupIds":groupIds
			},
			dataType: "json",
			async:false,
			success: function(data) {
				if(data>0){
					alert("删除成功");
					//ajax成功后刷新页面
					aihome.buildingGroup(aihome.refresh);
					aihome.listMenuInit(1);
					$("#checkAll").removeAttr("checked");
				}else{
					alert("删除失败")
				}
			}
		});
		console.log(groupIds)
	})
	//保存更改
	$(".btn_sav").click(function(){
		//获取分组id和分组名称
		var groupArray=[];
		var type = 0;
		$(".prgroup").each(function(i){
			if(i>0){
				if($(this).find("[name='groupName']").val().trim()!=""){
					if($(this).find("[name='groupName']").val()!="未分组"){
						groupArray.push($(this).find("[name='groupId']").val()+","+$(this).find("[name='groupName']").val());
					}
				}else{
					type=-1;
					return type;
				}
			}		
		});
		var group = groupArray.join("#");
		
		//获取楼栋id和楼栋名称
		var buildingArray=[];
		$(".building").each(function(i){
				if($(this).find("[name='buildingId']").val().trim()!=""){
					buildingArray.push($(this).find("[name='buildingId']").val()+","+$(this).find("[name='buildingName']").val());
				}else{
					type=-1;
					return type;
				}
			
		});
		if(type<0){
			alert("名称不能为空！");
			return false;
		}
		var building = buildingArray.join("#");
		var premisesId = ${premisesId};
		if(group!=""&&group!=undefined&&group!=null||building!=""&&building!=undefined&&building!=null){
			$.ajax({
				type: "POST",
				url: '${CTX}/baseBuilding/updateGroupBuilding.do',
				data: {
					"group":group,"building":building,"premisesId":premisesId
				},
				dataType: "json",
				async:false,
				success: function(data) {
					type = data;
					if(data>0){
						alert("修改成功");
						//ajax成功后刷新页面
						aihome.listMenuInit(1);
						//初始化分组和楼栋
						aihome.buildingGroup(1);
					}else if(type != -1){
						alert("修改失败")
					}else if(type == -1){
						alert("名称已存在！")
					}
				}
			});
		}
		
	})
	//切换回分组和楼栋编辑页面
	$(".btn_endit").click(function(){
		if($("#buildingTable").css("display")=="none"){
			$("#buildingTable").css("display", "block");
		}
		if($("#unitRoom").css("display") == "block"){
			$("#unitRoom").hide();
		}
		if($("#hiddenLayer").css("display") == "block" && $("#roomsBut").css("display") == "block" && $("#room").css("display")=="block"){
			$("#hiddenLayer").hide();
			$("#roomsBut").hide();
			$("#room").hide();
		}
	})
	//添加分组
	$(".btn_group").click(function(){
		//获取楼盘id
		var premisesId = $("#premisesId").val();
		//获取高和宽
		var height = $(window).height()*0.45;
		var width = $(window).width()*0.4;
		//地址、	表头
		var url="${CTX}/baseBuilding/addGroupIndex.do?premisesId="+premisesId+"&areaId=${areaId!}";
		var title ="楼栋分组维护";
		aihome.openDialogOa(title,url,height,width);
	})
	//添加栋座信息
	$(".btn_building").click(function(){
		//获取楼盘id、获取行政区id
		var premisesId = $("#premisesId").val();
		var areaId = $("#areaId").val();
		//获取高和宽
		var height = $(window).height()*0.5;
		var width = $(window).width()*0.8;
		//地址、	表头
		var url="${CTX}/baseBuilding/addBuilding.do?premisesId="+premisesId+"&areaId="+areaId;
		var title ="添加栋座信息";
		aihome.openDialogOa(title,url,height,width);
	})
	
  });


	
</script>

