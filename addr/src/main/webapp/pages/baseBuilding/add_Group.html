
<div class="row" style="margin:0">
	<div class="col-xs-12 my-group" enterforbtn="confirm-role">
 		<div id="element_id">
			<div class="form-horizontal row my-inputs">
	           	<div class="col-md-12 col-sm-12">
						<div class=" form-xs form-group row" style="margin:0">
							<label for="roleName" class="col-xs-2 control-label"></label>
							<label for="roleName" class="col-xs-2 control-label">楼栋分组：</label>
							<div class="col-xs-5  " id="groupNames">
								   <input class="form-control input-xs" name="builgroupName" vRequired="true" onblur="aihome.verify(this)"  maxlength="10"/>
							</div> 
							<label  class="col-xs-3 ">
								<i class="glyphicon glyphicon-plus " onclick="aihome.addGroup()"></i>
								<i class="glyphicon glyphicon-minus "onclick="aihome.delGroup()"></i>
							</label>
							<label for="roleName" class="col-xs-2 control-label"></label>
						</div>
		         </div>
			</div>
		</div>
	</div>


    <input type="hidden" id="verify"/>
        
</div>
<script type="text/javascript">
//校验数据库中存不存在

aihome.verify=function(obj){
	var type = 1;
	var groupNames = $(obj).val();
		groupNames = $.trim(groupNames);
	if(groupNames!=""){
		$.ajax({
			type: "POST",
			url: '${CTX}/baseBuilding/getGroupNum.do',
			data: {
				"groupName":groupNames,"premisesId":${premisesId!}
			},
			dataType: "json",
			async:false,
			success: function(data) {
				if(data>0){
					alert("分组名已存在");	
					type= 0;
					$(obj).val("");
				}
			}
		});
	}
	return type;
}
//添加input
aihome.addGroup=function(){
	$("#groupNames").append('<div class="required"><input class="form-control input-xs validate[required]" name="builgroupName" vrequired="true" onblur="aihome.verify(this)" maxlength="10"></div>');
};
//删除input
aihome.delGroup= function(){
	var a =$('input[name="builgroupName"]').length;
	if($('input[name="builgroupName"]').length>1){
		$("#groupNames").children().last().remove();
	}
}
//判断分组名是否重复
aihome.isPan=function(groupArray){
	var type = 1;
	for (var i = 0; i < groupArray.length; i++) {
		// 将数组元素依次与后面的数组元素比较  
		for (var j = i + 1; j < groupArray.length; j++) {
			if ($.trim(groupArray[i]) == $.trim(groupArray[j])) {
				alert("添加分组名重复!");
				type = 0;
				return type;
			}
		}
	}
	return type;
}

//保存分组
aihome.addBatchGrou=function(){
	var type = 1;
	var groupArray =[];
	$("input[name=builgroupName]").each(function(){
		//为空校验
		if($(this).val().trim()==""){
			alert("分组名不能为空!");
			type=0;
			return type;
		}
		groupArray.push($(this).val());
	});
	if(type==0){
		return type;
    }
	type = aihome.isPan(groupArray); 
	if(type==0){
		return type;
	}
	var groupStr = groupArray.join(",");	
	$.ajax({
		type: "POST",
		url: '${CTX}/baseBuilding/addBatchGroup.do',
		data: {
			"groupStr":groupStr,"premisesId":${premisesId!}
		},
		dataType: "json",
		async:false,
		success: function(data) {
			if(data==0){
				alert("添加失败！")
			}
			type = data;
		}
	});

	return type;
}

</script>