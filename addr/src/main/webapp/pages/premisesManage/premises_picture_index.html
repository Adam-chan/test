<div class="tableContent" style="height:100%;">
	<form class="searchForm">
		<input name="premisesId" id="premisesId" value="${premisesId!}" type="hidden" />
		<input name="picType" id="picType" value="" type="hidden" />
	</form>
	<div class="row">
		<div class="tabbable tabbable-lightBlue col-md-12 col-sm-12 col-xs-12">
			<ul class="nav nav-tabs">
			<a onclick="changePicType(0);" id="picId_0">全部图片 (<span>0</span>)|</a>
			<#if sysHouseLPTPFLList ??>
			<#list sysHouseLPTPFLList as item>
			<a onclick="changePicType(${item.sysHouseSort !''});" id="picId_${item.sysHouseSort !''}">${item.sysHouseDescribe !''}(<span>0</span>)|</a>
			</#list>
			</#if>
			</ul>
		</div>
		<div class="col-md-12 col-sm-12 col-xs-12 ">
			<div style="background-color:#e5e9eb;">
				<input id="selectAll" type="checkbox"  onchange="selectAll()"/><strong style="margin-right: 10px;">全选</strong>
				<button class="btn btn-xs btn-icon btn-blue"
					onclick="deletePicture();">
					<span>删除图片</span>
				</button>
				<button class="btn btn-xs btn-icon btn-blue"
					onclick="setRepresentPic();">
					<span>设为代表图</span>
				</button>
				<button class="btn btn-xs btn-icon btn-blue" onclick="uploadPicture();">
					<span>上传图片</span>
				</button>
			</div>
		</div>
		<div class="dataList col-md-12 col-sm-12 col-xs-12">
			<div style="display:none;text-align:center;margin-top: 5px;" class="example col-md-2 col-sm-2 col-xs-2">
				<img id="clickPicture"  class="layoutImg" style="cursor:pointer;"/>
				<b style="display:block;text-align:center;bold" class="picShowName"><input name="checkIds" lang="id" type="checkbox" value="">
				<span lang="fileName"></span>&nbsp;<strong></strong></b>	
			</div>
		</div>
	</div>
	
</div>
<div class="col-md-12 col-sm-12 col-xs-12 ">
	<div class="pagination row" style="display:block;text-align:center;"></div>
	</div>
<style type="text/css">
.layout {
	border: 1px solid #757575;
	margin: 5px;
	padding: 15px;
	width: 180px;
}

.layoutImg {
	width: 160px;
	height: 160px;
	text-align: center;
}
</style>

<script type="text/javascript">
	$(function() {
		picInit();
	});
	function picInit() {
		var opts = new PtsObject();
		opts.dataList = ".dataList";
		opts.searchForm = ".searchForm";
		opts.pagination = ".pagination";
		opts.example = "example";
		opts.showCount = 12;
		opts.formAction = "${CTX}/premisesPictures/getPremisesPicturesPage.do";
		opts.detailFunction = function(obj, data) {
			obj.find("img").attr("src",
					"${IMAGE_URL}" + data.folderName + "/" + data.fileNameLong+"@160w_160h");
			
			obj.find(".download").click(
					function() {
						window.location.href = "${IMAGE_URL}" + data.folderName
								+ "/" + data.fileNameLong;
					});
			
			obj.find("#clickPicture").click(
					function() {
						clickPicture(data);
					});
			if(data.representPic==1){
				obj.find("strong").html("(代表图)");
			}
			
		};
		GDPaging.initDataList(opts);
		countPic();
	}
	
	/* 根据图片类型获取分组 */
	function countPic(){
		var url = "${CTX}/premisesPictures/getGroupsByPicType.do?premisesId="
			+ $("#premisesId").val();
		$.ajax({
			url : url,
			dataType : "json",
			success : function(data) {
				var totalCount=0;
				for(var i = 0; i < data.length; i++) { 
				     var datas = data[i];  
				     $("#picId_"+datas.PICTYPE).find("span").html(datas.COUNT);
				     totalCount+=datas.COUNT;
				}  
				$("#picId_0").find("span").html(totalCount);
			}
		});
		
	}
	/* 添加上传图片页面 */
	function uploadPicture() {
		var heights = $(window).height()*0.7;
		var widths = $(window).width()*0.45;
		oaDialogOpen("addUploadPicture",//对话框ID，必填，且不能与当前页面的ID重复
		{
			url : "${CTX}/premisesPictures/uploadPicture.do?premisesId="
					+ $("#premisesId").val(),//调用页面的url
			title : "上传图片",//弹框的title
			closeOnEscpe : true,//是否通过escpe关闭弹框
			closeBtn : true,//是否显示关闭按钮
			width : widths,//弹框的宽度
			height : heights,
			buttons : {
				"确定" : function() {
					if(saveUploadPicture()) {
						$(this).dialog("close");
						picInit();
					}
				},
				"取消" : function() {
					$(this).dialog("close");
				}
			},
			openCall : function() {
			},//弹框打开后的回调函数
			closeCall : function() {
			}//弹框关闭后的回调函数
		});
	}

	/*删除图片*/
	function deletePicture() {
		var idList = new Array();
		$('input:checkbox[name=checkIds]:checked').each(function() {
			var checkId = $(this).text();
			if(checkId != ''){
				idList.push(checkId);
			}
			
		})
		
		if (idList == null || idList == '') {
			alert("没有选中的记录！");
			return;
		}
		
		var url = "${CTX}/premisesPictures/deletePicture.do";
		if (confirm("确认删除？")) {
			$.ajax({
				url : url,
				dataType : "json",
				data : {
					"idList" : idList
				},

				success : function(data) {
					alert("删除成功！");
					picInit();
				}
			});
		}
	}

	/*设置代表图片*/
	function setRepresentPic() {
		var idList = new Array();
		var count=0;
		$('input:checkbox[name=checkIds]:checked').each(function() {
			var checkId = $(this).text();
			idList.push(checkId);
			count+=1;
		})

		if (idList == null || idList == '') {
			alert("没有选中的图片！");
			return;
		}
		
		if (count >1) {
			alert("请只选择一张图片！");
			return;
		}
		var url = "${CTX}/premisesPictures/setRepresentPic.do";
		if (confirm("确认设置为代表图？")) {
			$.ajax({
				url : url,
				dataType : "json",
				data : {
					"idList" : idList
				},
				success : function(data) {
					alert("设置代表图成功！");
					picInit();
				}
			});
		}
	}
	
	/*根据图片类型分页查询楼盘图片*/
	function changePicType(index) {
		if(index == 0){
			$("#picType").val("");
		}else{
			$("#picType").val(index);
		}
		picInit();
	}
	
	
	/* 点击图片显示大图 */
	function clickPicture(data) {
		bootbox.dialog({
			title:'图片预览',
            message: '<div><img src="${IMAGE_URL}'+data.folderName+'/'+data.fileNameLong+'@${IMAGE_RULE}"/></div>',
            buttons: {
                "button": {
                   	"label": "确定",
                    "className": "btn-sm btn-blue"
                }
            }
        });
	}
	
	/* 全选 */
	function selectAll() {
		
		var isCheck = $("#selectAll").is(':checked');
		$("input[name='checkIds']").prop("checked",isCheck);
	}
	
</script>
