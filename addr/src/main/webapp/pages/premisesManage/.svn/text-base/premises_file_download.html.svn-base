<div class="tableContent">
	<input id="premisesId" value="${premisesId!}" type="hidden"> <input
		id="folderName" value="${folderName!}" type="hidden"> <input
		id="fileName" value="${fileName!}" type="hidden">
	<div class="row">
		<div class=" col-md-3 col-sm-6">
			<div class=" form-xs form-group row">
				<a	class="col-xs-2 control-label" onclick="downloadFiles()">下载</a>
				<a	class="col-xs-2 control-label" onclick="deteleFiles()">删除</a>
				<button class="btn btn-xs btn-icon btn-blue" style="float:right;"
					onclick="toUploadFile();">
					<span>上传</span>
				</button>
			</div>
		</div>
		<div class="col-xs-12">
			<table id="road_jqGrid"/>
			<div id="jqGridPager"></div>
		</div>
	</div>
</div>
<script type="text/javascript">
	$(function() {
		init_jqGrid();
	});

	function init_jqGrid() {
		$("#road_jqGrid")
				.jqGrid(
						{
							url : "${CTX}/premisesDetail/getFileList.do?premisesId="
									+ $("#premisesId").val(),
							datatype : "json",
							colModel : [
									{
										label : '文件名称',
										name : 'fileName',
										index : 'fileName',
										sortable : true,
										width : 10,
										formatter : function(cellvalue,
												options, rowObject) {
											return "<a href='${IMAGE_URL}"+rowObject.folderName+"/"+rowObject.fileNameLong+"' style='text-decoration:underline;color:blue'>"
													+ cellvalue + "</a>";
										}
									}, {
										label : '上传时间',
										name : 'uploadDateStr',
										index : 'uploadDateStr',
										sortable : false,
										width : 15
									}, {
										label : '上传人',
										name : 'uploadPerson',
										index : 'uploadPerson',
										sortable : true,
										width : 15
									},
									{
										label : '文件夹名称',
										name : 'folderName',
										index : 'folderName',
										hidden : true
									},
									{
										label : '服务器上的文件名称',
										name : 'fileNameLong',
										index : 'fileNameLong',
										hidden : true
									}],
							multiselect : true,
							multiboxonly : true,
							onSelectRow : function(rowId, status, e) {
								rowDataNames = [];
								var rowIds = $("#road_jqGrid").jqGrid(
										'getGridParam', 'selarrrow');
								$(rowIds)
										.each(
												function(i, rowId) {
													rowDataNames
															.push($("#road_jqGrid")
																	.jqGrid('getRowData',rowId));		
												});
							},
							viewrecords : true,
							autowidth : true,
							height : $(window).height() - 300,
							rowNum : 30,
							rowList : [ 10, 20, 30, 50, 100 ],
							pager : "#jqGridPager",
							jsonReader : {
								root : 'pagerResults',
								page : 'currentPage',
								rows : 'rowCount',
								total : 'pageCount',
								records : 'totalCount',
								repeatitems : false
							}
						});
	}

	/* 添加上传文件页面 */
	function toUploadFile() {
		oaDialogOpen("addUploadFile",//对话框ID，必填，且不能与当前页面的ID重复
		{
			url : "${CTX}/premisesDetail/toUploadFile.do?premisesId="
					+ $("#premisesId").val(),//调用页面的url
			title : "上传文件",//弹框的title
			closeOnEscpe : true,//是否通过escpe关闭弹框
			closeBtn : true,//是否显示关闭按钮
			width : 800,//弹框的宽度
			height : 400,
			buttons : {
				"确定" : function() {
					saveUploadFile();
					$(this).dialog("close");
					$("#road_jqGrid").trigger('reloadGrid');
				},
				"取消" : function() {
					$(this).dialog("close");
				}
			},
			openCall : function() {
			},//弹框打开后的回调函数
			closeCall : function() {
			}//弹框关闭后的回调函数
		});
	}
	
	/*删除*/
	function deteleFiles(){
		var rowIds = $("#road_jqGrid").jqGrid('getGridParam','selarrrow');
		var selCount=rowIds.length;
		
		if (selCount==0){
			alert("没有选中的记录！");
			return;
		}
		var url = "${CTX}/premisesDetail/deleteFiles.do";
		if (confirm("确认删除？")) {
			$.ajax({
				url : url,
				dataType : "json",
				data : {
					rowIds : rowIds
				},
				
				success : function(data) {
					$("#road_jqGrid").trigger('reloadGrid');
					alert("删除成功！");
				}
			});
		}
	}
	
	/*批量下载*/
	function downloadFiles(){
		var rowIds = $("#road_jqGrid").jqGrid('getGridParam','selarrrow');
		var selCount=rowIds.length;
		
		if (selCount==0){
			alert("没有选中的文件！");
			return;
		}else if(selCount >1){
			alert("请只选择一个文件！");
			return;
		}
		
		var rowData = $("#road_jqGrid").jqGrid('getRowData',rowIds);
		var fileNameLong = rowData.fileNameLong;
		var folderName = rowData.folderName;
		var url1 = "${IMAGE_URL}"+folderName+"/"+fileNameLong;
		
		if (confirm("确认下载吗？")) {
			window.open(url1);
		}
	}

</script>