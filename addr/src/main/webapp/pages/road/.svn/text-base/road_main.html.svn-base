<title>道路管理</title>
<!-- tools S -->
<div id="top_tools" class=" btn-group">
  <button id="road_query" class="btn btn-sm btn-white  confirmBtn" id="confirm">
    <i class="iconfont">&#xe6e4;</i>
    <span>查询</span>
  </button>

  <button id="road_add" class="btn btn-sm btn-white ladda-button">
    <i class="iconfont">&#xe6e0;</i>
    <span>新增</span>
  </button>
  
  <button id="road_Num" class="btn btn-sm btn-white ladda-button" onclick="scatterRoadNum(1);">
    <i class="iconfont">&#xe6e0;</i>
    <span>撒号</span>
  </button>
  
   <button id="anew_road_Num" class="btn btn-sm btn-white ladda-button" onclick="scatterRoadNum(2);">
    <i class="iconfont">&#xe6e0;</i>
    <span>重新撒号</span>
  </button>
  
 <button id="road_edit" class="btn btn-sm btn-white btn-default">
    <i class="iconfont">&#xe6dd;</i>
    <span>修改</span>
  </button>
  
  <button id="road_del" class="btn btn-sm btn-white btn-info">
    <i class="iconfont">&#xe6e3;</i>
    <span>删除</span>
  </button>
  
</div>
<div class="row">
	<div class="col-xs-12">
	  <div class="tabbable tabbable-lightBlue">
	    <ul class="nav nav-tabs" >
	      <li id="road_tab" class="active">
	        <a data-toggle="tab" tabUrl="${CTX}/road/getRoadTable.do" tabView="#tab-content1">道路管理</a>
	      </li>
	      <li>
	        <a data-toggle="tab" tabUrl="${CTX}/road/getRoadNumTable.do" tabView="#tab-content1">撒号管理</a>
	      </li>
	       <li>
	        <a data-toggle="tab" tabUrl="${CTX}/road/getRoadLogTable.do" tabView="#tab-content1">日志管理</a>
	      </li>
	    </ul>
	    <div class="tab-content" id="tab-content1"></div>
	  </div>
	</div> 
</div> 
<div id="road_form" ></div>
<script type="text/javascript">
	 $('.page-content-area').ace_ajax('loadScripts', [null, null], function () {});
	
     /* 新增 */
     $("#road_add").click(function(){
    	  openDialog("");
     });
     /* 修改 */
	 $("#road_edit").click(function(){
	      var rowIds = jQuery("#road_jqGrid").jqGrid('getGridParam', 'selarrrow');
  		  var selCount=rowIds.length;
		  if(selCount==0){
			 alert("没有选中的记录！");
			 return;
		  }
	  	  if(selCount >1){
	   		 alert("每次只能修改一条道路信息，请重新选择！");
	   		 return;
	   	  }
	  	  openDialog(rowIds);
     });
	 /* 道路弹窗 */
	 function openDialog(rowIds){
		 oaDialogOpen(
			   "addRoadDialog",{
				url: "${CTX}/road/getRoadAddDialog.do?id="+rowIds,//调用页面的url
				title: "道路管理",
				closeOnEscpe: true,
				height : 200,
		        width : 400,
				buttons: {
					"确定" : function() {
		        	    var roadName = $.trim($("#road_name").val());
		        	    if(roadName==""){
		        	    	alert("道路名称不能为空！");
		        	    }else{
		        	    	var queryString = $("#roadForm").serialize();
				       		$.ajax({
				        		url: "${CTX}/road/saveRoad.do",
				        		data:{
				        			id:$("#id").val(),
				        			roadName:roadName
				        		},
				        		type:"post",
				    			dataType:"json",
				        		success:function(data){
				        			$("#road_jqGrid").trigger('reloadGrid');
				        			if(data==1){
				        				alert("保存成功！");
				        			}else{
				        				alert("保存失败！");
				        			}
				        		}
				        	});
			       	  		$(this).dialog("close");	
		        	    }
		            },
		            "取消" : function() {
		                $(this).dialog("close");
		                $("#road_jqGrid").trigger('reloadGrid');
		            }
				},
				openCall: function() {
					
				},
				closeCall: function() {
					$(this).empty();
				}
		 });
	 }
	/* 删除*/
	$("#road_del").click(function(){
		var rowIds = $("#road_jqGrid").jqGrid('getGridParam','selarrrow');
  		var selCount=rowIds.length;
		if (selCount==0){
			alert("没有选中的记录！");
			return;
		}
		var url = "${CTX}/road/delRoads.do";
		var str = rowIds.join(",");
		if (confirm("确认删除？")) {
			$.ajax({
				url : url,
				dataType : "json",
				data : {
					rowIds : str
				},
				success : function(data) {
					if(data==1){
						$("#road_jqGrid").trigger('reloadGrid');
						alert("删除成功！");
					}else if(data==2){
						alert("当前道路下某个号段已被楼盘引用无法删除!");
					}else{
						alert("操作异常!");
					}
				}
			});
		}
	});
</script>