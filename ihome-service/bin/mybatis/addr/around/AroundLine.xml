<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="aroundLine">

	<!-- 新增线路 -->
	<insert id="insertLine" parameterType="map">  
       INSERT INTO AROUND_LINE (
			id,
			LINE_NAME,
			FIRST_TIME,
			LAST_TIME,
			TICKET_PRICE,
			TRAFFIC_TYPE,
			REMARK,
			START_STATION,
			END_STATION
		)
		VALUES (
			AROUND_LINE_SEQ.NEXTVAL,
			#{lineName,jdbcType=VARCHAR},
			#{firstTime,jdbcType=VARCHAR},
			#{lastTime,jdbcType=VARCHAR},
			#{ticketPrice,jdbcType=VARCHAR},
			#{trafficType,jdbcType=DECIMAL},
			#{remark,jdbcType=VARCHAR},
			#{startStation,jdbcType=VARCHAR},
			#{endStation,jdbcType=VARCHAR}
		)
    </insert>
    
    <!-- 分页查询线路 -->
   	<select id="getLineListForPage" parameterType="map" resultType="aroundLineModel">
		SELECT
			id,
			LINE_NAME AS lineName,
			FIRST_TIME AS firstTime,
			LAST_TIME AS lastTime,
			TICKET_PRICE AS ticketPrice,
			TRAFFIC_TYPE AS trafficType,
			REMARK AS remark,
			START_STATION AS startStation,
			END_STATION AS endStation
		FROM
			AROUND_LINE 
		WHERE
			1=1
			AND TRAFFIC_TYPE = #{trafficType}
			<if test="lineId!=null and lineId!=''">
				AND id=#{lineId}
			</if>
		ORDER BY
			id desc
   	</select>
	
   	<!-- 根据id查询线路 -->
   	<select id="getLineById" parameterType="map" resultType="aroundLineModel">
		SELECT
			id,
			LINE_NAME AS lineName,
			FIRST_TIME AS firstTime,
			LAST_TIME AS lastTime,
			TICKET_PRICE AS ticketPrice,
			TRAFFIC_TYPE AS trafficType,
			REMARK AS remark,
			START_STATION AS startStation,
			END_STATION AS endStation
		FROM
			AROUND_LINE 
		WHERE
			id=#{id}
   	</select>
   	
   	<!-- 根据name查询线路 -->
   	<select id="getLineByName" parameterType="map" resultType="aroundLineModel">
		SELECT
			id,
			LINE_NAME AS lineName,
			FIRST_TIME AS firstTime,
			LAST_TIME AS lastTime,
			TICKET_PRICE AS ticketPrice,
			TRAFFIC_TYPE AS trafficType,
			REMARK AS remark,
			START_STATION AS startStation,
			END_STATION AS endStation
		FROM
			AROUND_LINE 
		WHERE
			LINE_NAME=#{lineName}
		AND TRAFFIC_TYPE=#{trafficType}
   	</select>
   	
   	<!-- 根据id删除线路信息 -->
	<delete id="deleteLineById" parameterType="map" >
	     DELETE FROM AROUND_LINE WHERE id=#{id}
	</delete>
	
	<!-- 根据id更新线路信息 -->
   	<update id="updateLineById" parameterType="map">             
	     UPDATE 
	     	 AROUND_LINE
		 SET 
		 	 LINE_NAME = #{lineName,jdbcType=VARCHAR},
		 	 FIRST_TIME = #{firstTime,jdbcType=VARCHAR},
		 	 LAST_TIME = #{lastTime,jdbcType=VARCHAR},
		 	 TICKET_PRICE = #{ticketPrice,jdbcType=DECIMAL},
		 	 TRAFFIC_TYPE = #{trafficType,jdbcType=DECIMAL},
		 	 REMARK = #{remark,jdbcType=VARCHAR},
		 	 START_STATION = #{startStation,jdbcType=VARCHAR},
			 END_STATION = #{endStation,jdbcType=VARCHAR}
		 WHERE
			id = #{id}
	</update> 
	
	<!-- 批量删除线路信息 -->
	<delete id="deleteLines" parameterType="map">
	    DELETE FROM AROUND_LINE WHERE id IN (${lineIds})
	</delete>
	
	<!-- 根据站点id查询所有关联线路信息 -->
   	<select id="getLinesBySiteId" parameterType="map" resultType="aroundLineModel">
		SELECT
			l.id,
			l.LINE_NAME AS lineName,
			l.FIRST_TIME AS firstTime,
			l.LAST_TIME AS lastTime,
			l.TICKET_PRICE AS ticketPrice,
			l.TRAFFIC_TYPE AS trafficType,
			l.REMARK,
			l.START_STATION AS startStation,
			l.END_STATION AS endStation
		FROM
			around_site s
		LEFT JOIN around_site_line sl ON sl.site_id = s.id
		LEFT JOIN around_line l ON l.id = sl.line_id
		WHERE
			s.id = #{id}
   	</select>
   	
   	<!-- 查询所有线路信息 -->
   	<select id="getLineList" parameterType="map" resultType="aroundLineModel">
		SELECT
			id,
			LINE_NAME AS lineName,
			FIRST_TIME AS firstTime,
			LAST_TIME AS lastTime,
			TICKET_PRICE AS ticketPrice,
			TRAFFIC_TYPE AS trafficType,
			REMARK AS remark,
			START_STATION AS startStation,
			END_STATION AS endStation
		FROM
			AROUND_LINE 
		WHERE
			TRAFFIC_TYPE = #{trafficType,jdbcType=DECIMAL}
		ORDER BY 
			id 
   	</select>
   	
   	<!-- 查询线路名称是否存在 -->
   	<select id="getLineByNameIs" parameterType="map" resultType="aroundLineModel">
		SELECT
			id,
			LINE_NAME AS lineName,
			FIRST_TIME AS firstTime,
			LAST_TIME AS lastTime,
			TICKET_PRICE AS ticketPrice,
			TRAFFIC_TYPE AS trafficType,
			REMARK AS remark
		FROM
			AROUND_LINE
		WHERE
			1=1
			<if test="lineName != null  and lineName !=''"> 
		    	AND LINE_NAME = #{lineName}
		    </if>
		    <if test="trafficType != null  and trafficType !=''"> 
		    	AND TRAFFIC_TYPE = #{trafficType}
		    </if> 
		    <if test="lineId != null  and lineId !=''"> 
		    	AND id &lt;&gt; #{lineId}
		    </if> 
   	</select>
   	
   	<!-- 模糊查询线路信息 -->
	<select id="getLineListByMatch" resultType="aroundLineModel" parameterType="map">
		SELECT
			id,
			LINE_NAME AS lineName,
			FIRST_TIME AS firstTime,
			LAST_TIME AS lastTime,
			TICKET_PRICE AS ticketPrice,
			TRAFFIC_TYPE AS trafficType,
			REMARK AS remark,
			START_STATION AS startStation,
			END_STATION AS endStation
		FROM
			AROUND_LINE 
		WHERE
			1=1
			<if test="matchStr != null  and matchStr !=''"> 
		    	AND INSTR(LINE_NAME, #{matchStr}) > 0
		    </if>
		    AND TRAFFIC_TYPE=#{trafficType}
		ORDER BY id 
   	</select>
   	
   	<!-- 根据线路名称查询线路 -->
	<select id="getLineByLineName" resultType="aroundLineModel" parameterType="map">
		SELECT
	      id,
	      LINE_NAME AS lineName,
	      FIRST_TIME AS firstTime,
	      LAST_TIME AS lastTime,
	      TICKET_PRICE AS ticketPrice,
	      START_STATION AS startStation,
	      END_STATION AS endStation
	    FROM
	      AROUND_LINE 
	    WHERE
	      1=1
	      <if test="lineName != null  and lineName !=''"> 
		    	AND line_name = #{lineName}
		  </if>
	        AND TRAFFIC_TYPE = #{trafficType}
   	</select>
   	
</mapper>