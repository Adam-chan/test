<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="premisesExamine">

	<!-- 楼盘审核列表 -->
	<select id="getPremisesExaminePage" parameterType="map" resultType="basePremisesModel">
SELECT
			BP.ID AS id,
			BP.NAME AS name,
			BP.COMPLETE_STATUS AS completeStatus,
			BP.DATA_STATUS AS dataStatus,
			BP.OPERATE_TIME AS operateTime,
			BP.OPERATE_USER AS operateUser,
			BP.EXAMINE_USER AS examineUser,
			BP.AUDITING_STATUS AS auditingStatus
		FROM
			BASE_PREMISES BP	 	
		INNER JOIN
			AREA_ROAD_NUM AR
		ON
			BP.ROAD_ID = AR.UNITE_ID 
		<where>
			<if test="areaId != null and areaId != ''">
				AND AR.AREA_ID = #{areaId}
			</if>
			<if test="premisesName != null and premisesName != ''">
				AND BP.NAME = #{premisesName}
			</if>
			<if test="busiAreaId != null and busiAreaId != ''">
				AND BP.BUSI_AREA_ID = #{busiAreaId}
			</if>
			<if test="operateUserId != null and operateUserId != ''">
				AND BP.OPERATE_USER_ID = #{operateUserId}
			</if>
			<if test="examineUserId != null and examineUserId != ''">
				AND BP.EXAMINE_USER_ID = #{examineUserId}
			</if>
			<if test="completeStatus != null and completeStatus != ''">
				AND BP.COMPLETE_STATUS = #{completeStatus}
			</if>
			<if test="dataStatus != null and dataStatus != ''">
				AND BP.DATA_STATUS = #{dataStatus}
			</if>
				AND BP.AUDITING_STATUS = 2  <!-- 2未审核 -->
				AND BP.FLAG = 1
		</where>
   	</select>
   	
    <!-- 审核 -->
   	<update id="examine" parameterType="map">             
	     UPDATE 
	     	 BASE_PREMISES
	     	<set>
				<if test="examineType == 1"><!-- 1完整度 -->
					COMPLETE_STATUS = #{examineResult},
				</if>
				<if test="examineType == 2"><!-- 2准确度 -->
					DATA_STATUS = #{examineResult},
				</if>
				<if test="examineType == 3"><!-- 3审核 -->
					AUDITING_STATUS = #{examineResult},
				</if>
				<if test="examineUser != null and examineUser != ''">
					EXAMINE_USER = #{examineUser},
				</if>
				<if test="examineUserId != null and examineUserId != ''">
					EXAMINE_USER_ID = #{examineUserId}
				</if>
	      	</set>
		 WHERE ID IN (${rowIds})
	</update> 
   	   	
	<!-- 模糊查询楼盘 -->
	<select id="getPremisesByMatch" resultType="basePremisesModel">
		SELECT
			ID,
			NAME
		FROM
			BASE_PREMISES
		<where> 
			<if test="matchStr != null  and matchStr !=''"> 
		     	AND INSTR(NAME,'${matchStr}')>0
		    </if>
		</where>
			AND FLAG = 1
		ORDER BY ID 
   	</select>
   	
	<!-- 查询申请人List -->
	<select id="getOperateUserList" resultType="basePremisesModel">
		SELECT
    		COUNT(OPERATE_USER_ID),
			OPERATE_USER AS operateUser,
			OPERATE_USER_ID AS operateUserId
		FROM
			BASE_PREMISES
		GROUP BY OPERATE_USER_ID, OPERATE_USER
		ORDER BY OPERATE_USER_ID 
   	</select>
    	
	<!-- 查询审核人List -->
	<select id="getExamineUserList" resultType="basePremisesModel">
		SELECT
    		COUNT(EXAMINE_USER_ID),
			EXAMINE_USER AS examineUser,
			EXAMINE_USER_ID AS examineUserId
		FROM
			BASE_PREMISES
      	WHERE EXAMINE_USER_ID 
      		IS NOT NULL
		GROUP BY EXAMINE_USER_ID, EXAMINE_USER
		ORDER BY EXAMINE_USER_ID 
   	</select>
   
</mapper>