<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="operate">
   
   <!-- 楼盘查询 dl-->
   <select id="getPremisesAddrForPage" parameterType="map" resultType="operateModel" >
   		SELECT
			bp.id AS premisesId,
			bp.NAME AS premisesName,
			ar.NAME||' '||arn.num AS roadName,
			ba.NAME AS baseAreaName,
			sub.NAME AS subdistrictName,
			ac.NAME AS communityName,
			ROWNUM
		FROM
			base_premises bp
		LEFT JOIN area_road_num arn ON arn.unite_id = bp.road_id
		LEFT JOIN area_road ar ON ar.id = arn.road_id
		LEFT JOIN base_area ba ON ba.id = arn.area_id
		LEFT JOIN area_subdistrict sub ON sub.id = bp.subdistrict_id
        LEFT JOIN area_community ac ON ac.id = bp.community_id
		WHERE
			bp.flag = 1
		<if test="p_baseArea !=null and p_baseArea !=''">
			AND ba.id = #{p_baseArea}
		</if>
		<if test="p_subdistrict !=null and p_subdistrict !=''">
			AND sub.id = #{p_subdistrict}
		</if>
		<if test="p_community !=null and p_community !=''">
			AND ac.id = #{p_community}
		</if>
		<if test="p_road !=null and p_road !=''">
			AND ar.id = #{p_road}
		</if>
		<if test="p_startNum !=null and p_startNum !=''">
			AND arn.num &gt;= #{p_startNum}
		</if>
		<if test="p_ndNum !=null and p_ndNum !=''">
			AND arn.num &lt;= #{p_ndNum}
		</if>
		ORDER BY
			bp.id DESC
   </select>
   
   
   
   
   <!-- *********************************************************************** -->
   
   <!-- 分页查询楼盘的经营范围分配(买卖) 列表 sy  -->
   <select id="getOperateSaleListForPage" parameterType="map" resultType="operateModel">
  	    SELECT 
	          ba.id AS baseAreaId,
	          ba.name as baseAreaName,
	          bp.id AS premisesId,
	          bp.name AS premisesName,
	          asu.id AS subdistrictId,
	          asu.name AS subdistrictName,
	          ac.id as communityId,
	          ac.name as communityName,
	          ar.id as areaRoadId,
	          ar.name AS areaRoadName,
	          os.operate_date AS operateDate
	    FROM operate_sale os
	    LEFT JOIN base_premises bp ON bp.id = os.data_id
	    LEFT JOIN area_subdistrict asu ON asu.id = bp.subdistrict_id 
	    LEFT JOIN area_community ac ON ac.id = bp.community_id
	    LEFT JOIN area_road ar ON ar.id = bp.road_id 
	    LEFT JOIN area_road_num arn  ON  arn.unite_id = bp.road_id 
	    LEFT JOIN base_area ba ON ba.id = arn.area_id
   </select>
</mapper>