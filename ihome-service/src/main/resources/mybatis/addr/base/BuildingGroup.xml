<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="BuildingGroup" >
 <!-- 分组表字段 -->
  <sql id="Base_Column_List" >
    ID as id, PREMISES_ID as premisesId, GROUP_NAME as groupName, CREATE_TIME as createTime, UPDATE_TIME as updateTime, HOUSE_NUM as houseNum, HOUSE_CODE_TYPE as houseCodeType, 
    CREART_TYPE as creartType, HOUSE_PRE as housePre, HOUSE_SUF as houseSuf, NUM_START as numStart,NUM_END as numEnd
  </sql>
  <!-- 根据条件查询  -->
  <select id="getBuildingGroupList" resultType="buildingGroupModel" parameterType="map" >
    select 
    <include refid="Base_Column_List" />
    from BUILDING_GROUP
    <where>
			<if test="groupName != null and groupName !='' ">
			   and GROUP_NAME like '%${groupName}%'
			</if>
			<if test="premisesId !=  null  ">
			   and PREMISES_ID = #{premisesId}
			</if>
			<if test="groupNames != null and groupNames !='' ">
			   and GROUP_NAME = #{groupNames}
			</if>	
	</where>
	</select>
	<!--根据楼栋分组id获取分组实体  -->
	<select id="getBuildingGroup" resultType="buildingGroupModel" parameterType="map" >
	    select 
	    <include refid="Base_Column_List" />
	    from BUILDING_GROUP
	   where ID = #{groupId}
	</select>
	
	<!-- 校验是否重名 -->
	<select id="getGroupNum" resultType="java.lang.Integer" parameterType="map" >
	    select 
	   	count(0)
	    from BUILDING_GROUP
	    <where>
				<if test="groupName != null and groupName !='' ">
				   and GROUP_NAME = #{groupName} and PREMISES_ID=${premisesId}
				</if>
				<if test="updateGroupName != null and updateGroupName !='' and groupId!=null and premisesId !=null">
				  and GROUP_NAME =#{updateGroupName} and ID &lt;&gt; #{groupId} and PREMISES_ID=${premisesId}
				</if>
		</where>
  </select>
  <!-- 根据id删除 -->
  <delete id="delete" parameterType="java.lang.Long" >
    delete from BUILDING_GROUP
    where ID IN (${groupId})
  </delete>
  <!-- 插入一条分组数据 -->
  <insert id="insert" parameterType="buildingGroupModel" >
    insert into BUILDING_GROUP (ID, PREMISES_ID, GROUP_NAME, 
      CREATE_TIME, UPDATE_TIME, HOUSE_NUM, 
      HOUSE_CODE_TYPE, CREART_TYPE, HOUSE_PRE, 
      HOUSE_SUF,NUM_START,NUM_END)
    values (#{id,jdbcType=DECIMAL}, #{premisesId,jdbcType=DECIMAL}, #{groupName,jdbcType=VARCHAR}, 
      #{createTime,jdbcType=DATE}, #{updateTime,jdbcType=DATE}, #{houseNum,jdbcType=DECIMAL}, 
      #{houseCodeType,jdbcType=DECIMAL}, #{creartType,jdbcType=DECIMAL}, #{housePre,jdbcType=VARCHAR}, 
      #{houseSuf,jdbcType=VARCHAR},#{numStart,jdbcType=VARCHAR},#{numEnd,jdbcType=VARCHAR})
  </insert>
  <!-- 有选择的插入一条分组数据 -->
  <insert id="insertSelective" parameterType="buildingGroupModel" >
  	<selectKey resultType="java.lang.Integer" order="BEFORE" keyProperty="id">
		  SELECT BUILDING_GROUP_SEQ.NEXTVAL FROM DUAL
	</selectKey>
    insert into BUILDING_GROUP
    <trim prefix="(" suffix=")" suffixOverrides="," >
        ID,
      <if test="premisesId != null" >
        PREMISES_ID,
      </if>
      <if test="groupName != null" >
        GROUP_NAME,
      </if>
      <if test="createTime != null" >
        CREATE_TIME,
      </if>
      <if test="updateTime != null" >
        UPDATE_TIME,
      </if>
      <if test="houseNum != null" >
        HOUSE_NUM,
      </if>
      <if test="houseCodeType != null" >
        HOUSE_CODE_TYPE,
      </if>
      <if test="creartType != null" >
        CREART_TYPE,
      </if>
      <if test="housePre != null" >
        HOUSE_PRE,
      </if>
      <if test="houseSuf != null" >
        HOUSE_SUF,
      </if>
      <if test="numStart != null" >
        NUM_START,
      </if>
      <if test="numEnd != null" >
        NUM_END,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=DECIMAL},
      </if>
      <if test="premisesId != null" >
        #{premisesId,jdbcType=DECIMAL},
      </if>
      <if test="groupName != null" >
        #{groupName,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=DATE},
      </if>
      <if test="updateTime != null" >
        #{updateTime,jdbcType=DATE},
      </if>
      <if test="houseNum != null" >
        #{houseNum,jdbcType=DECIMAL},
      </if>
      <if test="houseCodeType != null" >
        #{houseCodeType,jdbcType=DECIMAL},
      </if>
      <if test="creartType != null" >
        #{creartType,jdbcType=DECIMAL},
      </if>
      <if test="housePre != null" >
        #{housePre,jdbcType=VARCHAR},
      </if>
      <if test="houseSuf != null" >
        #{houseSuf,jdbcType=VARCHAR},
      </if>
      <if test="numStart != null" >
        #{numStart,jdbcType=VARCHAR},
      </if>
      <if test="numEnd != null" >
        #{numEnd,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <!-- 有选择更新 -->
  <update id="updateSelective" parameterType="map" >
    update BUILDING_GROUP
    <set >
      <if test="premisesId != null" >
        PREMISES_ID = #{premisesId,jdbcType=DECIMAL},
      </if>
      <if test="groupName != null" >
        GROUP_NAME = #{groupName,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        CREATE_TIME = #{createTime,jdbcType=DATE},
      </if>
      <if test="updateTime != null" >
        UPDATE_TIME = #{updateTime,jdbcType=DATE},
      </if>
      <if test="houseNum != null" >
        HOUSE_NUM = #{houseNum,jdbcType=DECIMAL},
      </if>
      <if test="houseCodeType != null" >
        HOUSE_CODE_TYPE = #{houseCodeType,jdbcType=DECIMAL},
      </if>
      <if test="creartType != null" >
        CREART_TYPE = #{creartType,jdbcType=DECIMAL},
      </if>
      <if test="housePre != null" >
        HOUSE_PRE = #{housePre,jdbcType=VARCHAR},
      </if>
      <if test="houseSuf != null" >
        HOUSE_SUF = #{houseSuf,jdbcType=VARCHAR},
      </if>
      <if test="numStart != null" >
        NUM_START = #{numStart,jdbcType=VARCHAR},
      </if>
      <if test="numEnd != null" >
        NUM_END = #{numEnd,jdbcType=VARCHAR},
      </if>
    </set>
    where ID = #{id,jdbcType=DECIMAL}
  </update>
  <!-- 更新楼盘分组 -->
	  <update id="update" parameterType="buildingGroupModel" >
	    update BUILDING_GROUP
	    set PREMISES_ID = #{premisesId,jdbcType=DECIMAL},
	      GROUP_NAME = #{groupName,jdbcType=VARCHAR},
	      CREATE_TIME = #{createTime,jdbcType=DATE},
	      UPDATE_TIME = #{updateTime,jdbcType=DATE},
	      HOUSE_NUM = #{houseNum,jdbcType=DECIMAL},
	      HOUSE_CODE_TYPE = #{houseCodeType,jdbcType=DECIMAL},
	      CREART_TYPE = #{creartType,jdbcType=DECIMAL},
	      HOUSE_PRE = #{housePre,jdbcType=VARCHAR},
	      HOUSE_SUF = #{houseSuf,jdbcType=VARCHAR}
	      NUM_START = #{numStart,jdbcType=VARCHAR}
	      NUM_END = #{numEnd,jdbcType=VARCHAR}
	    where ID = #{id,jdbcType=DECIMAL}
	  </update>
	<!-- 楼栋首页导航 获取分组部分 -->
	<select id="getPremisesMenuPage" resultType="PremisesMenuModel" parameterType="map">
		select a.id as groupId,a.group_name as groupName from building_group a  where a.premises_id = #{premisesId} ORDER BY  CASE WHEN ascii(a.group_name ) BETWEEN 48 AND 57 THEN TO_NUMBER(a.group_name ) ELSE ascii(a.group_name) END

	</select>
	<!-- 批量插入分组 -->
   	<insert id="insertBatch" parameterType="map" useGeneratedKeys="false">  
	   	INSERT INTO BUILDING_GROUP (ID,GROUP_NAME,PREMISES_ID) 
	    	SELECT AROUND_SITE_LINE_SEQ.NEXTVAL,a.* from (
	    <foreach collection="groupList" item="item" index="index" separator="UNION ALL" >
	    	SELECT #{item},#{premisesId}  FROM DUAL
	    </foreach>)a
    </insert>
	
</mapper>