<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="fake" >
	<!-- 分页查询我的打假 -->
	<select id="getFakePage" parameterType="map" resultType="fakeManageModel">
		SELECT
			ID,
			HOUSE_INFO_ID as houseInfoId,
			HOUSE_CODE as houseCode,
			PROPOSER_USER as proposerUser,
			PROPOSER_USER_ID as proposerUserId,
			PROPOSER_ORG_CODE as proposerOrgCode,
			PROPOSER_ORG_NAME as proposerOrgName,
			PROPOSER_AREA_NAME as proposerAreaName,
			PASSIVE_USER as passiveUser,
			PASSIVE_USER_ID as passiveUserId,
			PASSIVE_ORG_NAME as passiveOrgName,
			PASSIVE_ORG_CODE as  passiveOrgCode,
			PASSIVE_AREA_NAME as  passiveAreaName,
			REASON,
			HANDING_SUGGESTION as handingSuggestion,
			EXAMINE_USER as examineUser,
			EXAMINE_USER_ID as examineUserId,
			EXAMINE_STATUS as examineStatus,
			CREATE_TIME as createTime,
			EXAMINE_TIME as examineTime,
			TYPE,
			TRANS_TYPE as transType,
			USE_TYPE as useType
		FROM MANAGE_FAKE
		<where>
			<if test="startTime != null and startTime != ''">
				CREATE_TIME  &gt; TO_DATE(#{startTime},'YYYY-MM-DD HH:mm')
			</if>
			<if test="endTime != null and endTime != ''">
				AND CREATE_TIME &lt; TO_DATE(#{endTime},'YYYY-MM-DD HH:mm')
			</if>
			<if test="houseCode != null and houseCode != ''">
				and HOUSE_CODE = #{houseCode}
			</if>
			<if test="fakeType != null and fakeType != ''">
				and TYPE = #{fakeType}
			</if>
			<if test="examineStatus != null and examineStatus != ''">
				and EXAMINE_STATUS = #{examineStatus}
			</if>
			<if test="transType != null and transType != ''">
				and TRANS_TYPE = #{transType}
			</if>
			<if test="useType != null and useType != ''">
				and USE_TYPE = #{useType}
			</if>
		</where>
			ORDER BY id DESC
	</select>
		<!-- 查询我的打假数据 -->
	<select id="getFakeInfo" parameterType="map" resultType="fakeManageModel">
		SELECT
			mf.ID,
			mf.HOUSE_INFO_ID as houseInfoId,
			mf.HOUSE_CODE as houseCode,
			mf.PROPOSER_USER as proposerUser,
			mf.PROPOSER_USER_ID as proposerUserId,
			mf.PROPOSER_ORG_CODE as proposerOrgCode,
			mf.PROPOSER_ORG_NAME as proposerOrgName,
			mf.PROPOSER_AREA_NAME as proposerAreaName,
			mf.PASSIVE_USER as passiveUser,
			mf.PASSIVE_USER_ID as passiveUserId,
			mf.PASSIVE_ORG_NAME as passiveOrgName,
			mf.PASSIVE_ORG_CODE as  passiveOrgCode,
			mf.PASSIVE_AREA_NAME as  passiveAreaName,
			mf.REASON,
			mf.HANDING_SUGGESTION as handingSuggestion,
			mf.EXAMINE_USER as examineUser,
			mf.EXAMINE_USER_ID as examineUserId,
			mf.EXAMINE_STATUS as examineStatus,
			mf.CREATE_TIME as createTime,
			mf.EXAMINE_TIME as examineTime,
			mf.TYPE as type,
			mf.TRANS_TYPE as transType,
			mf.USE_TYPE as useType
			<if test="fakeType ==1">
				,mfh.HOUSE_ADDRESS as houseFakeAddr
			</if>
			<if test="fakeType ==1">
				,mfh.HOUSE_OWNER as fakeOwer
			</if>
			<if test="fakeType ==1">
				,mfh.CONTACT as fakeTell
			</if>
			<if test="fakeType ==3">
				,mfk.DEPOSIT_STORE as depositStore
			</if>
			<if test="fakeType ==3">
				,mfk.KEY_TYPE as keyType
			</if>
			<if test="fakeType ==3">
				,mfk.STORE_TELL as storeTell
			</if>
			<if test="fakeType ==4">
				,mfp.SIGN_TIME as signTime
			</if>
			<if test="fakeType ==4">
				,mfp.PROXY_CODE as proxyCode
			</if>
			<if test="fakeType ==4">
				,mfp.FOLDER_NAME as folderName
			</if>
			<if test="fakeType ==4">
				,mfp.FILE_NAME as fileName
			</if>
		FROM MANAGE_FAKE mf
		<if test="fakeType ==1">
			left join MANAGE_FAKE_HOUSE mfh on mf.id = mfh.FAKE_ID
		</if>
		<if test="fakeType ==2">
			left join MANAGE_FAKE_HOUSE mfh on mf.id = mfh.FAKE_ID
		</if>
		<if test="fakeType ==3">
			left join MANAGE_FAKE_KEY mfk on mf.id = mfk.FAKE_ID
		</if>
		<if test="fakeType ==4">
			left join MANAGE_FAKE_PROXY mfp on mf.id = mfp.FAKE_ID
		</if>
		where mf.id = #{fakeId}
	</select>
			<!-- 保存打假 -->
	<insert id="insertFake" parameterType="map">
		<selectKey resultType="java.lang.Integer" order="BEFORE" keyProperty="fakeId">
			SELECT MANAGE_FAKE_SEQ.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO
			MANAGE_FAKE
		(
			ID,
			HOUSE_INFO_ID,
			HOUSE_CODE,
			REASON,
			TRANS_TYPE,
			PROPOSER_USER,
			PROPOSER_USER_ID,
			PROPOSER_ORG_CODE,
			PROPOSER_ORG_NAME,
			PROPOSER_AREA_NAME,
			PASSIVE_USER,
			PASSIVE_USER_ID,
			PASSIVE_ORG_NAME,
			PASSIVE_ORG_CODE,
			PASSIVE_AREA_NAME,
			EXAMINE_STATUS,
			CREATE_TIME,
			TYPE,
			USE_TYPE
		)
		VALUES
		( MANAGE_FAKE_SEQ.NEXTVAL,
			#{houseInfoId},
			#{houseCode},
			#{reason},
			#{transType},
			#{proposerUser},
			#{proposerUserId},
			#{proposerOrgCode},
			#{proposerOrgName},
			#{proposerAreaName},
			#{passiveUser},
			#{passiveUserId},
			#{passiveOrgName},
			#{passiveOrgCode},
			#{passiveAreaName},
			#{examineStatus},
			#{createTime},
			#{type},
			#{useType}
		)
	</insert>
	<!-- 保存房源打假 -->
	<insert id="insertHouseFake" parameterType="map">
		INSERT INTO
			MANAGE_FAKE_HOUSE
		(
			ID,
			FAKE_ID,
			HOUSE_ADDRESS,
			HOUSE_OWNER,
			CONTACT
		)
		VALUES
		(	MANAGE_FAKE_HOUSE_SEQ.NEXTVAL,
			#{fakeId},
			#{houseAddress},
			#{houseOwner},
			#{contact}
		)
	</insert>
	<!-- 保存钥匙打假 -->
	<insert id="insertKeyFake" parameterType="map">
		INSERT INTO
			MANAGE_FAKE_KEY
		(
			ID,
			FAKE_ID,
			KEY_TYPE,
			COLELECT_USER,
			COLELECT_USER_ID,
			COLELECT_ORG,
			COLELECT_ORG_CODE,
			COLELECT_AREA,
			KEY_CODE,
			DEPOSIT_STORE,
			STORE_TELL
		)
		VALUES
		(	MANAGE_FAKE_KEY_SEQ.NEXTVAL,
			#{fakeId},
			#{keyType},
			#{colelectUser},
		    #{colelectUserId},
			#{colelectOrg},
			#{colelectOrgCode},
			#{colelectZone},
			#{keyType},
			#{depositStoreId},
			#{depositContact}
		)
	</insert>
	<!-- 保存委托书打假 -->
	<insert id="insertProxyFake" parameterType="map">
		INSERT INTO
			MANAGE_FAKE_PROXY
		(
			ID,
			FAKE_ID,
			FOLDER_NAME,
			FILE_NAME,
			SIGN_TIME,
			PROXY_CODE
		)
		VALUES
		(	MANAGE_FAKE_PROXY_SEQ.NEXTVAL,
			#{fakeId},
			#{folderName},
			#{fileName},
			to_date(#{signTime},'yyyy-mm-dd hh24:mi:ss'),
			#{proxyCode}
		)
	</insert>
		<!-- 打假信息只能存在一条 查询打假审核进行中的数据 -->
	<select id="getFakeCheck" parameterType="map" resultType="java.lang.Integer">
		SELECT
			count(0)
		FROM
			MANAGE_FAKE
		WHERE  EXAMINE_STATUS = 1 and TYPE = #{type} and HOUSE_INFO_ID = #{houseInfoId}
	</select>
</mapper>