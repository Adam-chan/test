<div id="top_tools" class=" btn-group">
  <button id="space_see_del" class="btn btn-sm btn-white btn-info">
	  <i class="iconfont">&#xe6e3;</i> <span>删除</span>
  </button>
  <button id="space_see_query" class="btn btn-sm btn-white confirmBtn">
      <i class="iconfont">&#xe6e4;</i>
      <span>查询</span>
  </button>
</div>

<div class="row">
	<div class="col-xs-12 my-group">
		<div enterfor=".confirmBtn" class="form-horizontal row my-inputs">
		    <div class="col-md-3 col-sm-6">
				<div class=" form-xs form-group row">
					<label class="col-xs-3 control-label">房源编号:</label>
					<div class="col-xs-8">
						<input type="text" id="houseCode" class="form-control input-xs searchKey" name="houseCode" value=""/>
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-6">
				<div class="form-xs form-group row">
					<label class="col-xs-3 control-label">空看区：</label>
					<div class="col-xs-8">
						<select id="quOrg" class="input-xs form-control searchKey">
							<option value="">请选择</option>
							<#list quOrgList as item>
								<option value="${item.orgCode}">${item.name}</option>
							</#list>
						</select>
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-6">
				<div class=" form-xs form-group row">
					<label class="col-xs-3 control-label">空看组:</label>
					<div class="col-xs-8">
						<select id="zuOrg" class="input-xs form-control searchKey">
							<option value="">请选择</option>
						</select>
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-6">
				<div class=" form-xs form-group row">
					<label class="col-xs-3 control-label">空看人:</label>
					<div class="col-xs-8">
						<select id="jingjiren" class="input-xs form-control searchKey">
							<option value="">请选择</option>
						</select>
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-6">
				<div class=" form-xs form-group row">
					<label class="col-xs-3 control-label">业务类型:</label>
					<div class="col-xs-8">
						<select id="demandType" name="demandType" class="input-xs form-control searchKey">
							<option value="">请选择</option>
							<option value="2">租赁</option>
							<option value="1">买卖</option>
						</select>
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-6">
				<div class=" form-xs form-group row">
					<label class="col-xs-3 control-label">使用类别:</label>
					<div class="col-xs-8">
						<select id="useType"  name="useType" class="input-xs form-control searchKey">
							<option value="">请选择</option>
							<option value="1">住宅</option>
							<option value="2">商铺</option>
							<option value="3">写字楼</option>
							<option value="4">车位</option>
						</select>
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-6">
				<div class=" form-xs form-group row">
					<label class="col-xs-3 control-label">空看时间:</label>
					<div class="col-xs-8">
						<div class="input-daterange input-group 5i5jdate">
							<input id="SpaceSeeTimeS" type="text" class="form-control input-xs searchKey" name="start" placeholder="开始时间">
							<span class="input-group-addon addon-xs">
								<i class="fa fa-exchange"></i>
							</span>
							<input id="SpaceSeeTimeE" type="text" class="form-control input-xs searchKey" name="end" placeholder="结束时间">
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="col-xs-12 my-grid">
    	<table id="space_see_jqGrid">
    	
    	</table>
    	<div id="jqGridPager"></div>
  	</div>
</div>

<script type="text/javascript">

	$('.page-content-area').ace_ajax('loadScripts', [null, null], function () {});
	
	var aihome={
			
		init_jqGrid : function(){
			$("#space_see_jqGrid").jqGrid({
				 url: "${CTX}/houseSpaceSee/getHouseSpaceSeeListForPage.do", 
		         datatype: "json",
		         colModel: [
					 { label: 'id', name: 'id',index:'id',hidden:true},
					 { label: 'houseInfoId', name: 'houseInfoId',index:'houseInfoId',hidden:true},
		             { label: '房源编号', name: 'houseCode',index:'houseCode',width: 30,
						 formatter:function(rowName, options, rowObject){
		            	    return "<a href=\"javascript:aihome.houseDetail('"+rowObject.houseInfoId+"',"+rowObject.demmandType+","+rowObject.useType+");\"  style='text-decoration:none;color:blue'>"+rowName+"</a>";
		             	 }
		             },
		             { label: '业务类型', name: 'demandType',index:'demandType',width: 30,
		            	 formatter:function(rowName, options, rowObject){
		            		 var html = "";
		            		 if(rowName){
		            			 if(rowName=="1"){
		            				 html = "买卖";
		            			 }else if(rowName=="2"){
		            				 html = "租赁";
		            			 }
		            		 }
		            	    return html;
		             	 }	 
		             },
		             { label: '使用类别', name: 'useType',index:'useType',width: 30 ,
		            	 formatter:function(rowName, options, rowObject){
		            		 var html = "";
		            		 if(rowName){
		            			 if(rowName=="1"){
		            				 html = "住宅";
		            			 }else if(rowName=="2"){
		            				 html = "商铺";
		            			 }else if(rowName=="3"){
		            				 html = "写字楼";
		            			 }else if(rowName=="4"){
		            				 html = "车位";
		            			 }
		            		 }
		            	    return html;
		             	 }	 	 
		             },
		             { label: '空看区', name: 'operateGroup',index:'operateGroup',width: 30 },
		             { label: '所属组', name: 'isOperateUserCount',index:'isOperateUserCount',width: 30, 
		            	 formatter:function(rowName, options, rowObject){
		            		 if((rowObject.isOperateUserCount)>0){
		            			 return "<a href=\"javascript:aihome.isGroup('"+rowObject.houseInfoId+"');\"  style='text-decoration:none;color:blue'>"+rowName+"</a>";
		            		 }else{
		            			 return rowName;
		            		 }
			              }
		             },
		             { label: '非所属组', name: 'noOperateUserCount',index:'noOperateUserCount',width: 30,
		            	 formatter:function(rowName, options, rowObject){
		            		  if((rowObject.noOperateUserCount)>0){
		            			  return "<a href=\"javascript:aihome.noGroup('"+rowObject.houseInfoId+"');\"  style='text-decoration:none;color:blue'>"+rowName+"</a>";
		            		  }else{
		            			  return rowName;
		            		  }
			              }
		             }
		         ],
		         multiselect: true,
		         multiboxonly: true,
		         viewrecords: true, 
		         autowidth:true,
		         height: $(window).height()-300,
		         rowNum:30, 
			     rowList:[10,20,30,50,100],
		         pager: "#jqGridPager",
		     	 jsonReader: { root: 'pagerResults', page:'currentPage',rows:'rowCount',total:'pageCount',records:'totalCount',repeatitems: false} 
		    });
		},
		//查看租赁房源详情页
		houseDetail : function(houseId,type,num){
			oaDialogOpen("lookUpHouse",//对话框ID，必填，且不能与当前页面的ID重复
				 {url:"${CTX}/houseManage/lookUpDetail.do?houseInfoId="+houseId+"&type="+type+"&num="+num,
				      title:"查看详细信息",//弹框的title
				      closeOnEscpe:true,//是否通过escpe关闭弹框
				      closeBtn:true,//是否显示关闭按钮
				      width: $(window).width()*0.8,//弹框的宽度
					  height: $(window).height()*0.9,
				  })
		},
		//所属组
		isGroup : function(houseInfoId){
			oaDialogOpen("lookIsGroup",//对话框ID，必填，且不能与当前页面的ID重复
				 {url:"${CTX}/houseSpaceSee/isGroup.do?houseInfoId="+houseInfoId,
				      title:"空看详情",//弹框的title
				      closeOnEscpe:true,//是否通过escpe关闭弹框
				      closeBtn:true,//是否显示关闭按钮
				      width : 800,
					  height: 400,
				  })
		},
		//非所属组
		noGroup : function(houseInfoId){
			oaDialogOpen("lookNoGroup",//对话框ID，必填，且不能与当前页面的ID重复
					 {url:"${CTX}/houseSpaceSee/noGroup.do?houseInfoId="+houseInfoId,
					      title:"空看详情",//弹框的title
					      closeOnEscpe:true,//是否通过escpe关闭弹框
					      closeBtn:true,//是否显示关闭按钮
					      width : 800,
						  height: 400,
					  })
		},
		
		
		getAddress : function (val, objId) {
			var _url  = "${CTX}/org/orgList.do";
			if(objId == "jingjiren"){
				_url= "${CTX}/org/userList.do";
			}
			$.ajax({
				type : "post",
				url : _url,
				async : false,
				dataType : 'json',
				async:false,
				data : {
					"orgCode" : val
				},
				success : function(data) {
					
					aihome.changeAddress(data, objId);
				},
			});
		},
		changeAddress : function(data, objId) {
			var obj = $("#" + objId);
			
			obj.children().first().siblings().remove();
			var str = "";
			for (var i = 0; i < data.length; i++) {
				var orgCode = "";
				if(objId==="jingjiren"){
					orgCode = data[i].userId;
				}else{
					orgCode = data[i].orgCode;
				}
				var name = data[i].name;
				str = '<option value="'+orgCode+'">'
						+ name + '</option>';
				obj.append(str);
			}
		}
	}
	
	$(function (){
		aihome.init_jqGrid();
		/**查询*/
		$("#space_see_query").click(function(){
			var param = getSearchParam();
	 		$("#space_see_jqGrid").setGridParam({url:"${CTX}/houseSpaceSee/getHouseSpaceSeeListForPage.do?"+param,page:1}).trigger('reloadGrid');
		});
		/**删除*/
		$("#space_see_del").click(function(){
			var rowIds=$("#space_see_jqGrid").jqGrid('getGridParam', 'selarrrow');
			var selCount=rowIds.length;
			if (selCount==0){
				alert("没有选中的记录！");
				return;
			}
			var str = rowIds.join(",");
			if (confirm("确认删除？")) { 
				$.ajax({
					url : "${CTX}/houseSpaceSee/deleteSpaceSeeByIds.do",
					dataType : "json",
					data : {
						spaceSeeIds:str
					},
					success : function(data) {
						$("#space_see_jqGrid").trigger('reloadGrid');
						alert("删除成功！");
					}
				});
			}
		});
			
		/**组*/
		$("#zuOrg").change(function (){
			var orgCode = $(this).val();
			//组数据变更，下级全部清空
			$("#jingjiren").children().first().siblings().remove();
			aihome.getAddress(orgCode, "jingjiren");
		});
		/**区*/
		$("#quOrg").change(function() {
			var orgCode = $(this).val();
			//区数据变更，下级全部清空
			$("#zuOrg").children().first().siblings().remove();
			$("#jingjiren").children().first().siblings().remove();
			aihome.getAddress(orgCode, "zuOrg");
		}); 
	});
	
</script>