<form action="" id="saveForm">
<div class="row" style="margin:0">
	<#if originalContract ??>
	<div class="col-xs-12 my-group limittimeContractNum" enterforbtn="confirm-role">
	 		<div id="element_id" >
				<div class="form-horizontal row my-inputs">
		           <div class="col-md-6 col-sm-6 col-xs-6" >
						<div class=" form-xs form-group row">
							<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">原合同号：</label>
							<input class="isFlag" type="text" name="originalContract" <#if originalContract ??> value="${originalContract!}"  </#if> readonly="readonly">
						</div>
	           		</div>
				</div>
			</div>
	</div>
	</#if>
	<#if  ManageTimeLimitExpress ??>
		<#if  ManageTimeLimitExpress.originalContract ??>
			<div class="col-xs-12 my-group limittimeContractNum" enterforbtn="confirm-role">
			 		<div id="element_id" >
						<div class="form-horizontal row my-inputs">
				           <div class="col-md-6 col-sm-6 col-xs-6" >
								<div class=" form-xs form-group row">
									<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">原合同号：</label>
									<input class="isFlag" type="text" name="originalContract"  value="${ManageTimeLimitExpress.originalContract!}" readonly="readonly" >
								</div>
			           		</div>
						</div>
					</div>
			</div>
			</#if>
	</#if>
	<div class="col-xs-12 my-group" enterforbtn="confirm-role">
 		<div id="element_id" >
			<div class="form-horizontal row my-inputs">
	           <div class="col-md-6 col-sm-6 col-xs-6" >
					<div class=" form-xs form-group row">
						<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">限时合同号：</label>
						<input class="isFlag" type="text" name="limittimeContractNum" <#if ManageTimeLimitExpress ??> value=${ManageTimeLimitExpress.limittimeContractNum!} <#else> value=${limittimeContractNum!} readonly="readonly" </#if>>
					</div>
           		</div>
   				<div class="col-md-6 col-sm-6 col-xs-6" >
					<div class=" form-xs form-group row">
					<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">房源编号：</label>
					<input class="isFlag" type="text" name="code" <#if ManageTimeLimitExpress ??>value="${ManageTimeLimitExpress.code!}" <#else> <#if sale??> value="${sale.code!}" </#if></#if> readonly="readonly" />
					</div>
           		</div>
           		
			</div>
		</div>
	</div>
	<div class="col-xs-12 my-group" enterforbtn="confirm-role">
		<div id="element_id" >
			<div class="form-horizontal row my-inputs">
   				<div class="col-md-6 col-sm-6 col-xs-6" >
					<div class=" form-xs form-group row">
						<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">房产证地址：</label>
						<input class="isFlag" type="text" required name="codeAddress" <#if ManageTimeLimitExpress ??>value="${ManageTimeLimitExpress.codeAddress!}" </#if><#if sale ??> value="${sale.zzdzDetail!}" title="${sale.zzdzDetail!}" </#if>  >
					</div>
           		</div>
           		 <div class="col-md-6 col-sm-6 col-xs-6" >
					<div class=" form-xs form-group row">
					<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">限时序列号：</label>
					<input class="isFlag" type="text" name="limittimeSerialNum"  <#if ManageTimeLimitExpress ??>value="${ManageTimeLimitExpress.limittimeSerialNum!}" </#if> maxlength="25">
					</div>
           		</div>
			</div>
		</div>
	</div>
	<div class="col-xs-12 my-group" enterforbtn="confirm-role">
		<div id="element_id" >
			<div class="form-horizontal row my-inputs">
	           <div class="col-md-6 col-sm-6 col-xs-6" >
					<div class=" form-xs form-group row">
					<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">产权证号：</label>
							<a id="clone_add">
	    					<i class="iconfont ">&#xe6e0;</i>
	    					<span>新增</span>
	    					</a>
					</div>
           		</div>
   				<div class="col-md-6 col-sm-6 col-xs-6" >
           		</div>
			</div>
		</div>
	</div>
	<div class="col-xs-12  form-group row" enterforbtn="confirm-role">
		<div class="col-xs-1"></div>
		<div class="col-xs-10">
		<table class="col-xs-12 table-input">
			<thead>
				<tr>
					<td width="10%">序号</td>
					<td width="40%">证件类型</td>
					<td width="40%">证件号</td> 
				</tr>
			</thead>
			<tbody id="lm_tbody">
				<#if BuildingPapersList ??>
							<#list BuildingPapersList as item>
								<tr id="lm_tr0" class="hasDelete">
									<td  width="10%" class="cloneList">1</td>
									<td width="40%">
										<select name="credentialsType" style="width: 50%" class="input-xs " readonly="readonly" data-value="">
												<option  selected="selected" value="1">产权证</option>
												<option value="2">土地证</option>
										</select>
									</td>
									<td width="40%"><input id="check" name="credentialsNum" style="width: 80%" type="text" value="${item.credentialsNum!}" readonly="readonly" maxlength="20" onblur="aihome.check(this)"></td>
								</tr>
							</#list>	
						<#else>
							<tr id="lm_tr0" class="hasDelete">
								<td  width="10%" class="cloneList">1</td>
								<td width="40%">
									<select name="credentialsType" style="width: 50%" class="input-xs "  data-value="">
											<option selected="selected" value="1">产权证</option>
											<option value="2">土地证</option>
									</select>
								</td>
								<td width="40%"><input id="check" name="credentialsNum" style="width: 80%" type="text" value="123456789" maxlength="20" onblur="aihome.check(this)"></td>
							</tr>
				</#if>
			</tbody>
		</table>	
		</div>
	</div>
	<div class="col-xs-12 my-group" enterforbtn="confirm-role">
		<div id="element_id" >
			<div class="form-horizontal row my-inputs">
   				<div class="col-md-6 col-sm-6 col-xs-6" >
					<div class=" form-xs form-group row">
						<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">业主姓名：</label>
						<input class="isFlag" type="text" name="proprietor" required <#if ManageTimeLimitExpress ??>value="${ManageTimeLimitExpress.proprietor!}"<#else> <#if sale??> value="${sale.ownerName!}"</#if> </#if>  maxlength="8">
					</div>
           		</div>
           		 <div class="col-md-6 col-sm-6 col-xs-6" >
					<div class=" form-xs form-group row">
					<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label" >业主电话：</label>
					<input class="isFlag" type="text" name="contact_phone" englishVerification="true" required <#if ManageTimeLimitExpress ??>value="${ManageTimeLimitExpress.proprietor!}"<#else><#if sale ??> value="${sale.ownerTel!}"</#if>  </#if>  >
					</div>
           		</div>
			</div>
		</div>
	</div>
	<div class="col-xs-12 my-group" enterforbtn="confirm-role">
		<div id="element_id" >
			<div class="form-horizontal row my-inputs">
   				<div class="col-md-6 col-sm-6 col-xs-6" >
					<div class=" form-xs form-group row">
						<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">证件类型：</label>
						<select name="proprietorCertificateType" style="width: 35%" class="input-xs isFlag" data-value="">
								<option value="1"  selected="selected">身份证</option>
						</select>
					</div>
           		</div>
           		 <div class="col-md-6 col-sm-6 col-xs-6" >
					<div class=" form-xs form-group row">
					<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">业主证件号：</label>
					<input class="isFlag" type="text" isIdCardNo="true" name="proprietorCertificateNum" required <#if ManageTimeLimitExpress ??>value="${ManageTimeLimitExpress.proprietorCertificateNum!}"</#if> >
					</div>
           		</div>
			</div>
		</div>
	</div>
	<div class="col-xs-12 my-group" enterforbtn="confirm-role">
		<div id="element_id" >
			<div class="form-horizontal row my-inputs">
   				<div class="col-md-6 col-sm-6 col-xs-6" >
					<div class=" form-xs form-group row">
						<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">委托开始时间：</label>
						 <input class="5i5jdate input-xs isFlag" <#if ManageTimeLimitExpress ??>value="${ManageTimeLimitExpress.entrustStartime!}"</#if> name="entrustStartime"  required type="text" placeholder="选择时间"/>
					</div>
           		</div>
           		 <div class="col-md-6 col-sm-6 col-xs-6" >
					<div class=" form-xs form-group row">
					<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">委托结束时间：</label>
					 <input class="5i5jdate input-xs isFlag" <#if ManageTimeLimitExpress ??>value="${ManageTimeLimitExpress.entrustEndtime!}"</#if>  name="entrustEndtime" required type="text" placeholder="选择时间"/>
					</div>
           		</div>
			</div>
		</div>
	</div>
	<div class="col-xs-12 my-group" enterforbtn="confirm-role">
		<div id="element_id" >
			<div class="form-horizontal row my-inputs">
   				<div class="col-md-6 col-sm-6 col-xs-6" >
					<div class=" form-xs form-group row">
						<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">合同签订日：</label>
						 <input class="5i5jdate input-xs isFlag" <#if ManageTimeLimitExpress ??>value="${ManageTimeLimitExpress.contractDate!}"</#if> name="contractDate" required type="text" placeholder="选择时间"/>
					</div>
           		</div>
           		 <div class="col-md-6 col-sm-6 col-xs-6" >
					<div class=" form-xs form-group row">
					<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">是否赔付：</label>
					<input id = "pament" type="radio" value="1"  <#if ManageTimeLimitExpress ??> <#if ManageTimeLimitExpress.pament == 1> checked="checked"</#if><#else> checked="checked"</#if>   name="pament" >是 <input id = "paments" <#if ManageTimeLimitExpress ??> <#if ManageTimeLimitExpress.pament == 2> checked="checked"</#if></#if> type="radio" value="2" name="pament">否
					</div>
           		</div>
			</div>
		</div>
	</div>
	<div class="col-xs-12 my-group" enterforbtn="confirm-role">
		<div id="element_id" >
			<div class="form-horizontal row my-inputs">
   				<div class="col-md-6 col-sm-6 col-xs-6" >
					<div class=" form-xs form-group row">
						<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">赔付方式：</label>
						<select name="pamentWay"  style="width:35%" class="input-xs isFlag" >
								<option selected="selected"  value="">请选择</option>
									<option  value="1">先赔付</option>
									<option value="2">后赔付</option>
								
								
						</select>
					</div>
           		</div>
           		 <div class="col-md-6 col-sm-6 col-xs-6" >
					<div class=" form-xs form-group row">
					<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">赔付金额：</label>
					<input class="isFlag" type="text" name="pamentAmount" required  number="true" <#if ManageTimeLimitExpress ??>value="${ManageTimeLimitExpress.pamentAmount!}" </#if>  maxlength="11">
					</div>
           		</div>
			</div>
		</div>
	</div>
	<div class="col-xs-12 my-group" enterforbtn="confirm-role">
		<div id="element_id" >
			<div class="form-horizontal row my-inputs">
   				<div class="col-md-6 col-sm-6 col-xs-6" >
					<div class=" form-xs form-group row">
						<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">限时保证金：</label>
						<input class="isFlag" type="text" name="limittimeBond" required number="true" <#if ManageTimeLimitExpress ??>value="${ManageTimeLimitExpress.limittimeBond!}" </#if>   maxlength="11" />
					</div>
           		</div>
           		 <div class="col-md-6 col-sm-6 col-xs-6" >
					<div class=" form-xs form-group row">
					<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">收限人：</label>
					<input class="isFlag" type="text" name="limitUser" <#if ManageTimeLimitExpress ??> value="${ManageTimeLimitExpress.limitUser!}" <#else> value="${limitUser!}" </#if>  maxlength="8" readonly="readonly"/>
					</div>
           		</div>
			</div>
		</div>
	</div>
	<div class="col-xs-12 my-group" enterforbtn="confirm-role">
		<div id="element_id" >
			<div class="form-horizontal row my-inputs">
   				<div class="col-md-6 col-sm-6 col-xs-6" >
					<div class=" form-xs form-group row">
						<label for="userName" class="col-md-5 col-sm-5 col-xs-5 control-label">收限店：</label>
						<input class="isFlag" type="text" name="recycleHouseShop" <#if ManageTimeLimitExpress ??> value="${ManageTimeLimitExpress.recycleHouseShop!}" <#else> value="${recycleHouseShop!}" </#if>   maxlength="14" readonly="readonly" />
					</div>
           		</div>
           		 <div class="col-md-6 col-sm-6 col-xs-6" >
           		</div>
			</div>
		</div>
	</div>
	
</div>
	<!-- 隐藏参数 -->
	<input name="status" type="hidden" value="${status!}" >
	<input name="houseInfoId" type="hidden" value="${houseInfoId!}" >
	<input name="limitUserId" type="hidden" value="${limitUserId!}" >
	<input name="limitUserOrg" type="hidden" value="${limitUserOrg!}" >
	<input name="limitUserArea" type="hidden" value="${limitUserArea!}" >
	<input name="limitUserBigArea" type="hidden" value="${limitUserBigArea!}" >
	<input name="limitUserCode" type="hidden" value="${limitUserCode!}" >
</form>
<style type="text/css">

</style>
<script type="text/javascript">

$('.5i5jdate').datepicker({
    todayBtn: "linked",//今天按钮
    clearBtn: true,//清空按钮
    language: "zh-CN",//语言
    autoclose: true,//自动关闭
    todayHighlight: true,//今天高亮
    format: "yyyy-mm-dd",//日期格式，可以不写，直接使用默认的
})
//校验表格
aihome.check = function(obj){
	var zmsz = /^[0-9a-zA-Z]*$/g; 
	if($(obj).val()==""||$(obj).val()==null){
		if($(obj).next().html()==undefined || $(obj).next().html()=="请输入正确的格式"){
			$(obj).after("<label  class=\"error\" for=\"proprietorCertificateNum\">不能为空</label>");
			$(obj).next().next().remove()
		}
	}else{
		if(!zmsz.test($(obj).val())){
			if($(obj).next().html()==undefined || $(obj).next().html()=="不能为空"){
				$(obj).after("<label  class=\"error\" for=\"proprietorCertificateNum\">请输入正确的格式</label>");
				$(obj).next().next().remove()
			}
		}else{
			$(obj).next().remove();
		}
	}
}
aihome.validateFunction=function(){
	var idCard = /^(\d{6})()?(\d{4})(\d{2})(\d{2})(\d{3})(\w)$/;   
	 var zmsz = /^[0-9a-zA-Z]*$/g; 
	 var isMobile = /^0\d{2,3}-\d{7,8}(-\d{1,6})?$|(^(13[0-9]|15[0|3|6|7|8|9]|18[8|9])\d{8}$)/; 
	 $.validator.addMethod("zmsz", function(value, element) {
		 return this.optional(element) || zmsz.test(value);
		 }, "请输入正确证件号码");
	   $.validator.addMethod("isIdCardNo", function(value, element) {
		 return this.optional(element) || idCard.test(value);
		 }, "请输入正确身份证号码");
	 $.validator.addMethod("englishVerification",function(value,element,params){
			return this.optional(element) || isMobile.test(value);
		},"请输入正确电话号码！");
	 return $("#saveForm").validate({
			onfocusout: function(element) { 
				$(element).valid();
			},  
			rules:{  
			},
			messages:{
				codeAddress:{       
					required:"不能为空",
				},proprietor:{       
					required:"不能为空",
				},contact_phone:{
					required:"不能为空",
				},entrustEndtime:{
					required:"不能为空",
				},entrustStartime:{
					required:"不能为空",
				},contractDate:{
					required:"不能为空",
				},pament:{
					required:"不能为空",
				},pamentWay:{
					required:"不能为空",
				},pamentAmount:{
					required:"不能为空",
					number:"必须为数字",
				},limittimeBond:{
					required:"不能为空",
					number:"必须为数字",
				},proprietorCertificateNum:{
					required:"不能为空",
				},credentialsType:{
					required:"不能为空",
				},credentialsNum:{
					required:"不能为空",
				},
			},
	        errorPlacement: function(error, element){
	            error.appendTo(element.parent());
	        }
		}); 
	
}

aihome.ispan=function(){
	$("[name='credentialsNum']").each(function(){
		   if($(this).val()==""){
			   $(this).after("<label  class=\"error\" for=\"proprietorCertificateNum\">不能为空</label>");
		   }
	  });
}
//添加
aihome.manageTimeLimitExpress=function(){
	var type = 0;

	//表单验证
	if(!aihome.validateFunction().form()) {
		aihome.ispan();
		return false;
	}
	if($("#lm_tbody").find("td").find("label").length>0){
		aihome.ispan();
		return false;
	}
	// 获取表单
	var oForm = $('#saveForm');
	var saveForm = oForm.result();
	var credentialsType = [];
	var credentialsNum = [];
		$("[name='credentialsType']").each(function(){
			credentialsType.push($(this).val());
			
		  });
		$("[name='credentialsNum']").each(function(){
			credentialsNum.push($(this).val());
		  });
		
	saveForm = $.extend(true,saveForm,{credentialsType:credentialsType,credentialsNum:credentialsNum});
	$.ajax({
	       type : "POST",
	       url : '${CTX}/manageTimeLimitExpress/addManageTimeLimit.do',
	       dataType : 'json',
	       data : saveForm,
	       async:false,
	       success : function(data) {
	    	   	type= data;
	      }
	   });
	return type;
}
//tr克隆
$("#clone_add").click(function(){
	if($("#check").next().html() == "不能为空" || $("#check").next().html()=="请输入正确的格式" ){
		alert("请在填写正确的证件号在填加输入框！")
		return false;
	}
	cloneDom({
	    dom:$("#lm_tr0"),//克隆对象
	    target:$("#lm_tbody"),//克隆位置
	    loadBefore: null,
	    callBack: function(a){
	    	$("#lm_tbody tr:first td:last").hide();
	    	$("#lm_tbody select").each(function(i){
	    		if(i!=0){
	    			$(this).attr("disabled",false);
	    		}
	    	});
	    },//克隆后的回调函数，a为克隆完成后的html对象
	    willDelete: function(a){console.log(a)},//删除前回调函数
	    deleteBack: function(a){console.log(a)},//删除后回调函数
	    deleteNoId: false,//行对象是否有ID
	    allDelete:true//是否允许全部删除
	});
});
$(function(){
	<#if ManageTimeLimitExpress ??> 
		$(".isFlag").attr("disabled","disabled");
		$("[name='pament']").attr("disabled","disabled");
		$(".middle").remove();
	</#if>
	//校验
	aihome.validateFunction();
	$("#pament").change(function(){
		if($(this).val() == "1"){
			$("[name='pamentWay']").removeAttr("disabled");
			$("[name='pamentAmount']").removeAttr("disabled");
			$("[name='limittimeBond']").removeAttr("disabled");
			$("[name='pamentWay']").attr("required","true");
			$("[name='pamentAmount']").attr("required","true");
			$("[name='limittimeBond']").attr("required","true");
		}
	});
	$("#paments").change(function(){
			$("[name='pamentWay']").val("");
			$("[name='pamentAmount']").val("");
			$("[name='limittimeBond']").val("");
			$("[name='pamentWay']").next().remove();
			$("[name='pamentAmount']").next().remove();
			$("[name='limittimeBond']").next().remove();
			$("[name='pamentWay']").removeAttr("required");
			$("[name='pamentAmount']").removeAttr("required");
			$("[name='limittimeBond']").removeAttr("required");
			$("[name='pamentWay']").attr("disabled","disabled");
			$("[name='pamentAmount']").attr("disabled","disabled");
			$("[name='limittimeBond']").attr("disabled","disabled");
	});
	//当证件类型改变是校验规则改变
	$("[name='proprietorCertificateType']").change(function(){
		var ispan = $(this).val();
		if(ispan == "1"){
			$("[name='proprietorCertificateNum']").removeAttr("zmsz");
			$("[name='proprietorCertificateNum']").attr("isIdCardNo","true");
		}else{
			$("[name='proprietorCertificateNum']").removeAttr("isIdCardNo");
			$("[name='proprietorCertificateNum']").attr("zmsz","true")
		}
	})

});
</script>