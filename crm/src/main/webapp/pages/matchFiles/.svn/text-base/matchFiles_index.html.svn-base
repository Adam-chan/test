<div id="top_tools" class=" btn-group">
	<button id="zone_query" class="btn btn-sm btn-white  confirmBtn">
		<i class="iconfont">&#xe6e4;</i> <span>查询</span>
	</button>

	<button id="zone_insert" class="btn btn-sm btn-white ladda-button">
		<i class="iconfont">&#xe6e0;</i> <span>新增</span>
	</button>

	<button id="zone_update" class="btn btn-sm btn-white btn-default">
		<i class="iconfont">&#xe6dd;</i> <span>修改</span>
	</button>

	<button id="zone_del" class="btn btn-sm btn-white btn-info">
		<i class="iconfont">&#xe6e3;</i> <span>删除</span>
	</button>

</div>

<div class="row">
	<div class="col-xs-12 my-group" enterforbtn="confirm-role">
		<div id="element_id">
			<div class="form-horizontal row my-inputs">
				<div class="col-md-2 col-sm-2">
					<div class="form-xs form-group row">
						<label class="col-xs-4 control-label">赛区名称：</label>
						<div class="col-xs-8">
							<input id="zoneName" class="form-control input-xs searchKey"
								placeholder="输入类别名称" />
						</div>
					</div>
				</div>
				<div class="col-md-2 col-sm-2">
					<div class=" form-xs form-group row">
						<label for="layers" class="col-xs-4 control-label">赛区类别：</label>
						<div class="col-xs-8">
							<select id="categoryName" class=" input-xs form-control">
								<option id="categoryOption">请选择</option>
								<#list categoryNameList as item>
								<option id="${item.id!}">${item.name!}</option>
								</#list>
							</select>
						</div>
					</div>
				</div>
				<div class="col-md-2 col-sm-2">
					<div class=" form-xs form-group row">
						<label for="status" class="col-xs-4 control-label">赛区级次：</label>
						<div class="col-xs-8">
							<select id="grade" class=" input-xs form-control">
								<option id="statusOption">请选择</option>
								<option id="statusOption">一级</option>
								<option id="statusOption">二级</option>
								<option id="statusOption">三级</option>
								<option id="statusOption">四级</option>
								<option id="statusOption">五级</option>
							</select>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>

	<div class="col-md-12">
		<div class="col-xs-12 my-grid ">
			<!-- PAGE CONTENT BEGINS -->
			<table id="matchZone_jqGrid">

			</table>
			<div id="matchZone_jqGridPager"></div>
		</div>
	</div>
</div>

<script type="text/javascript">
$('.page-content-area').ace_ajax('loadScripts', [null,"../assets/js/bootbox.js"], function () {});
$(function() {
	matchFilesListInit();
});

//初始化jqGrid
function matchFilesListInit(){
	$("#matchZone_jqGrid").jqGrid({
		height: $(window).height() - 219,
		autowidth:true,
		autoheight:true,
	    multiselect: true,
	    multiboxonly: true,
	    viewrecords: true,
	    autowidth:true,
	    rownumbers:true,
       	url: "${CTX}/matchFiles/getmatchZoneList.do",
       	datatype: "json", //,'楼盘数','操作'
       	colNames : ['序号','赛区名称','赛区类别','赛区级次','业务类型','买卖战队','租赁站队','买卖战队id','租赁战队id'],
       	postData:{
       	},
       	colModel: [
       	    {  name: 'id',index:'id',sortable : false, width: 20,hidden:true},
       		{  name: 'name',index:'name',sortable : false, width: 20,formatter:function(rowName, options, rowObject){
        	    return "<a onclick=\"openMatchFilesEdit("+rowObject.id+",'查看详情')\" style=\"text-decoration:underline;color:blue\">"+rowName+"</a>";}},
          	{  name: 'categroyName',categroyName:'layer',sortable : false, width: 20},
         	{  name: 'grade',index:'grade',sortable : false, width: 20},
          	{  name: 'bussunessType',index:'bussunessType',sortable : false, width: 20},
         	{  name: 'businessTeamName',index:'businessTeamName',sortable : false, width: 40},
        	{  name: 'leaseTeamName',index:'leaseTeamName',sortable : false, width: 40},
         	{  name: 'businessTeamId',index:'businessTeamId',sortable : false, width: 20,hidden:true},
        	{  name: 'leaseTeamId',index:'leaseTeamId',sortable : false, width: 20,hidden:true}
         
       	],
       	onSelectRow: function (rowId, status, e){},
       rowNum:30, 
	   rowList:[10,20,30,50,100],
       pager: "#matchZone_jqGridPager",
       /* 在数据初始化前进行数据编辑 */
   	   jsonReader: { root:'pagerResults', page:'currentPage',rows:'rowCount',total:'pageCount',records:'totalCount',repeatitems: false}
   	});
}

//查询
$("#zone_query").click(function(){
	var grade = "";
	var categoryName = $("#categoryName").val();
	if($("#grade").val() == "一级"){
		grade = 1;
	}else if($("#grade").val() == "二级"){
		grade = 2;
	}else if($("#grade").val() == "三级"){
		grade = 3;
	}else if($("#grade").val() == "四级"){
		grade = 4;
	}else if($("#grade").val() == "五级"){
		grade = 5;
	}
	
	if(categoryName == "请选择"){
		categoryName ="";
	}
	
	$("#matchZone_jqGrid").setGridParam({
		postData : {
			zoneName : $("#zoneName").val(),
			categoryName : categoryName,
			grade : grade
		}
	}).trigger("reloadGrid");
})

//新增
$("#zone_insert").click(function(){
	openMatchFilesEdit("","新增赛区");
})

//修改
$("#zone_update").click(function(){
	var zoneId = jQuery("#matchZone_jqGrid").jqGrid('getGridParam', 'selarrrow');
	if(zoneId.length == 0){
		alert("请勾选一条数据");
		return;
	}
	if(zoneId.length > 1){
		alert("每次只能修改一条数据");
		return;
	}
	openMatchFilesEdit(zoneId,"新增赛区");
})

//删除
$("#zone_del").click(function(){
	var matchZoneId = jQuery("#matchZone_jqGrid").jqGrid('getGridParam', 'selarrrow');
	var matchZoneIds = matchZoneId.join(",");
	if(matchZoneId.length == 0){
		alert("请勾选数据");
		return;
	}
	if (confirm("是否删除该赛区类别")){
		$.ajax({
			  url : "${CTX}/matchFiles/deleteMatchZone.do",
			  type:"post",
			  dataType:"json",
			  data:{
				  "id":matchZoneIds
			  },
			  success:function(data){
				if(data==0){
      				alert("删除失败！");
      			}else{
      				alert("删除成功！");
				  	$("#matchZone_jqGrid").trigger('reloadGrid');
      			}
			  }
		  });
	}
	$("#category_jqGrid").trigger('reloadGrid');
})

//open新增或修改页面
function openMatchFilesEdit(zoneId,title){
	var bussunessType = "";
	var but ;
	var readType;
	if(title == "查看详情"){
		readType = "read"
		but= {
			"取消" : function() {
		    	  $(this).dialog("close");
		      }
		}
	}else{
		but= {
			"保存" : function() {
				var businessBox = $("#businessBox")[0].checked;
				var leaseBox = $("#leaseBox")[0].checked;
				var grade = $("#gradeSel").val();
				//校验赛区类别是否为空
				if($("#categorySel").val() == null || $("#categorySel").val() == "" ||  $("#categorySel").val() == "请选择"){
					alert("赛区类别为必填项");
					return;
				}
				//校验赛区级次是否为空
				if(grade == null || grade == "" || grade == "请选择"){
					alert("赛区级次为必填项");
					return;
				}else if(grade == "一级"){
					grade = 1;
				}else if(grade == "二级"){
					grade = 2;	
				}else if(grade == "三级"){
					grade = 3;	
				}else if(grade == "四级"){
					grade = 4;
				}else if(grade == "五级"){
					grade = 5;	
				}
				//校验赛区名称
				if($("#editName").val() == "" || $("#editName").val() == null){
					alert("赛区名称为必填项");
					return;
				}
				
				//将业务类型转换为(1、买卖 2、租赁 3、买卖+租赁)
				if(businessBox == true && leaseBox == true){
					if(($("#businessTeams").text() == "" || $("#businessTeams").text() == null) || ($("#leaseTeams").text() == "" || $("#leaseTeams").text() == null)){
						alert("请按照业务类型填写战队");
						return;
					}
					bussunessType = 3;
				}else if(businessBox == false && leaseBox == false){
					alert("请选择业务类型");
					return;
				}else{
					if(businessBox == true){
						if($("#businessTeams").text() == "" || $("#businessTeams").text() == null){
							alert("请添加买卖战队");
							return;
						}
						bussunessType = 1;
					}else if(leaseBox == true){
						if($("#leaseTeams").text() == "" || $("#leaseTeams").text() == null){
							alert("请添加租赁战队");
							return;
						}
						bussunessType = 2;
					}
				}
				$.ajax({
					url : "${CTX}/matchFiles/insertMatchZone.do?id="+zoneId,
					type:"post",
					dataType:"json",
					data:{
						matchZoneName : $("#editName").val(),
						categorySel : $("#categorySel").val(),
						grade : grade,
						businessTeams : $("#businessTeams").text(),
						leaseTeams : $("#leaseTeams").text(),
						remarks : $("#remarks").val(),
						categoryId : $(":selected","#categorySel").attr("id"),
						bussunessType : bussunessType
					},
					success:function(data){
						if(data==0){
							alert("保存失败！");
						}else{
							alert("保存成功！");
							$("#category_jqGrid").trigger('reloadGrid');
						}
					}
				});
				$(this).dialog("close");
			  },
			"取消" : function() {
			   	  		$(this).dialog("close");
			     	}
			};
	}
	
	oaDialogOpen("matchZone",//对话框ID，必填，且不能与当前页面的ID重复
		      {url:"${CTX}/matchFiles/insertMatchZonePage.do?id="+zoneId+"&read="+readType,//调用页面的url
				title:title,//弹框的title
		      	closeOnEscpe:true,//是否通过escpe关闭弹框
		      	closeBtn:true,//是否显示关闭按钮
		      	width:500,//弹框的宽度
		      	height:450,
		      	buttons:but,
		     	openCall:function(){
		      	},//弹框打开后的回调函数
		      	closeCall:function(){
			    	$("#matchZone_jqGrid").trigger("reloadGrid");
		      	}//弹框关闭后的回调函数
		  	})
}

</script>