<div id="top_tools" class=" btn-group">
	<button id="area_query" class="btn btn-sm btn-white" onclick="search();" >
		<i class="iconfont">&#xe6e4;</i>
		<span>查询</span>
	</button>

	<button id="add_area" class="btn btn-sm btn-white ladda-button" onclick="editMacth(true);">
		<i class="iconfont">&#xe6e0;</i>
		<span>新增</span>
	</button>

	<button id="area_edit" class="btn btn-sm btn-white btn-default" onclick="publish();">
		<i class="iconfont">&#xe6dd;</i>
		<span>发布</span>
	</button>

	<button id="area_edit" class="btn btn-sm btn-white btn-default" onclick="editMacth(false);">
		<i class="iconfont">&#xe6dd;</i>
		<span>修改</span>
	</button>

	<button id="area_del" class="btn btn-sm btn-white btn-info" onclick="deteleMatch();">
		<i class="iconfont">&#xe6e3;</i>
		<span>删除</span>
	</button>
</div>

<div class="row">
	<form id="searchForm">
		<div class="col-xs-12 my-group" enterforbtn="confirm-role">
			<div id="element_id">
				<div class="form-horizontal row my-inputs">
					
					<div class=" col-md-2 col-sm-6">
						<div class=" form-xs form-group row" >
							<label for="addClass" class="col-md-4 col-sm-4 col-xs-4 control-label">赛事名称：</label>
							<div class="col-md-8 col-sm-8 col-xs-8">
								<input class="col-md-10 col-sm-10 col-xs-10 selectInput" type="text" name="name" id="name" placeholder="输入赛事名称" >
							</div>
						</div>
					</div>
					
					<div class=" col-md-2 col-sm-6">
						<div class=" form-xs form-group row"  >
							<label for="addClass" class="col-md-4 col-sm-4 col-xs-4 control-label">赛区类别：</label>
							<div class="col-md-8 col-sm-8 col-xs-8">
								<select id="categoryId" name="categoryId" class="area input-xs form-control" >
									<option value="">请选择</option>
								</select>
							</div>
						</div>
					</div>
					
					<div class=" col-md-2 col-sm-6">
						<div class=" form-xs form-group row"  >
							<label for="addClass" class="col-md-4 col-sm-4 col-xs-4 control-label">赛事年度：</label>
							<div class="col-md-8 col-sm-8 col-xs-8">
								<select id="year" name="year" class="area input-xs form-control" >
									<option value="">请选择</option>
									<option value="2016">2016年度</option>
									<option value="2015">2015年度</option>
									<option value="2014">2014年度</option>
									<option value="2013">2013年度</option>
								</select>
							</div>
						</div>
					</div>
					
					<div class=" col-md-2 col-sm-6">
						<div class=" form-xs form-group row"  >
							<label for="addClass" class="col-md-3 col-sm-3 col-xs-3 control-label">开始时间：</label>
							
							<div class="col-md-4 col-sm-4 col-xs-4">
								<div class="input-group" >
									<input class="form-control 5i5jdate input-xs" name="startTime" id="startTime" type="text" placeholder="选择时间"/>
									<span class="input-group-addon addon-xs">
										<i class="fa fa-calendar bigger-110"></i>
									</span>
								</div>
							</div>
							
							<div class="col-md-1 col-sm-1 col-xs-1" style="text-align: center;">至</div>
							
							<div class="col-md-4 col-sm-4 col-xs-4">
								<div class="input-group" >
									<input class="form-control 5i5jdate input-xs" name="endTime" id="endTime" type="text" placeholder="选择时间"/>
									<span class="input-group-addon addon-xs">
										<i class="fa fa-calendar bigger-110"></i>
									</span>
								</div>
							</div>
							
						</div>
					</div>
					
					<div class=" col-md-2 col-sm-6">
						<div class=" form-xs form-group row"  >
							<label for="addClass" class="col-md-4 col-sm-4 col-xs-4 control-label">发布状态：</label>
							<div class="col-md-8 col-sm-8 col-xs-8">
								<select id="status" name="status" class="area input-xs form-control" >
									<option value="">请选择</option>
									<option value="1">未发布</option>
									<option value="2">已发布</option>
								</select>
							</div>
						</div>
					</div>
					
					<div class=" col-md-2 col-sm-6">
						<div class=" form-xs form-group row"  >
							<label for="addClass" class="col-md-4 col-sm-4 col-xs-4 control-label">赛事状态：</label>
							<div class="col-md-8 col-sm-8 col-xs-8">
								<select id="matchStatus" name="matchStatus" class="area input-xs form-control" >
									<option value="">请选择</option>
									<option value="1">未开始</option>
									<option value="2">进行中</option>
									<option value="3">已结束</option>
								</select>
							</div>
						</div>
					</div>
					
				</div>
			</div>
		</div>
	</form>

	<div class="col-xs-12 my-grid " >
		<!-- PAGE CONTENT BEGINS -->
		<table id="jqGrid">
		
		</table>
		<div id="jqGridPager"></div>
		<!-- PAGE CONTENT ENDS -->
	</div>
</div>


<script type="text/javascript">
	$('.page-content-area').ace_ajax('loadScripts', [null,null], function () {
		
	});
	var aihome = {
		// 新增 /修改 赛事
		editMacth : function (flag, id){
			var title = "";
			var url = "";
			var matchId = jQuery("#jqGrid").jqGrid('getGridParam', 'selarrrow') + "";
			var matchIds = matchId.split(",");
			if(flag){
				title= "新增赛事";
				url = "${CTX}/match/addMatchIndex.do";
			}else{
				if(id != null){
					matchId = id;
				}
				if(matchIds.length != 1 || matchId.length == 0){
					alert("请勾选一条数据");
					return;
				}
				title= "修改赛事";
				url = "${CTX}/match/editMatchIndex.do?matchId=" + matchId;
			}
			oaDialogOpen("addMacth",						// 对话框ID，必填，且不能与当前页面的ID重复
				{url : url,									// 调用页面的url
				title : title,								// 弹框的title
				closeOnEscpe : true,						// 是否通过escpe关闭弹框
				closeBtn : true,							// 是否显示关闭按钮
				width : 500,								// 弹框的宽度
				height : 600,								// 弹框的高度
				buttons : {
					"确定" : function() {
						var url = "";
						if($("#id").val() != ""){
							url = "${CTX}/match/editMatch.do";
						}else{
							url = "${CTX}/match/addMatch.do";
						}
						$.ajax({
							url : url,
							type : "post",
							dataType : "json",
							data : $("#addMatchForm").serialize(),
							error:function(){
								alert(error);
							},
							success:function(data){
								if(data == 1){
									alert("保存成功！");
								}else{
									alert("保存失败！");
								}
							}
						});
						
						$(this).dialog("close");
					},
					"发布" : function() {
						var url = "";
						if($("#id").val() != ""){
							url = "${CTX}/match/editMatch.do";
						}else{
							url = "${CTX}/match/addMatch.do";
						}
						$.ajax({
							url : url,
							type : "post",
							dataType : "json",
							data : $("#addMatchForm").serialize(),
							error:function(){
								alert(error);
							},
							success:function(data){
								if(data == 1){
									alert("保存并发布成功！");
								}else{
									alert("保存并发布失败！");
								}
							}
						});
						
						$(this).dialog("close");
					},
					"取消" : function() {
						
						$(this).dialog("close");
					}
				},
				// 弹框打开后的回调函数
				openCall:function(){
					
				},
				// 弹框关闭后的回调函数
				closeCall:function(){
					$("#jqGrid").trigger("reloadGrid");
				}
			});
		},
		
		/* 分页初始化 */
		init_jqGrid : function (){
			$("#jqGrid").jqGrid({
				url: '${CTX}/match/getMatchJQPage.do', 
				datatype: "json",
				colModel:[
					{ label: '赛事名称', name: 'name',index:'name',sortable : true,width: 30,align:'center',formatter : function (cellValue, options, rowObject){
						return "<a onclick='editMacth(false," + rowObject.id + ");'>" + cellValue + "</a>";
					}},
					{ label: '赛区类别', name: 'categoryName',index:'categoryName',sortable : true,width: 30,align:'center'},
					{ label: '开始时间', name: 'startTime',index:'startTime',sortable : true,width: 30,align:'center'},
					{ label: '结束时间', name: 'endTime',index:'endTime',sortable : true,width: 30,align:'center'},
					{ label: '赛事规则', name: 'rule',index:'rule',sortable : true,width: 30,align:'center'},
					{ label: '发布状态', name: 'status',index:'status',sortable : true,width: 30,align:'center',formatter : function(cellValue, options, rowObject){
						if(cellValue == 2){
							return "<span >已发布</span>";
						}else if(cellValue == 1 || cellValue == 3){
							return "<span style='color: red;'>未发布</span>";
						}
					}},
					{ label: '发布时间', name: 'publishTime',index:'publishTime',sortable : true,width: 30,align:'center'},
					{ label: '赛事状态', name: 'matchStatus',index:'status',sortable : true,width: 30,align:'center'},
				], 
				multiselect: true,
				multiboxonly: true,
				rownumbers: true,
				viewrecords: true,
				autowidth:true,
				height: $(window).height()-300,
				rowNum:30,
				rowList:[10,20,30,50,100],
				pager: "#jqGridPager",
				jsonReader: { root: 'pagerResults', page:'currentPage',rows:'rowCount',total:'pageCount',records:'totalCount',repeatitems: false} 
		    });
		},
		
		// 下拉列表赋值
		setSelectValue : function (){
		
			$.ajax({
		        type : "POST",
		        url : '${CTX}/match/getSelectList.do',
		        dataType : 'json',
		        error : function(request) {
		            alert("Error");
		            
		        },
		        success : function(data) {
		//             alert("Success");
		        	aihome.setCategoryId(data.categoryList);
		        }
		    });
		},
		
		// 设置赛事类别下拉列表
		setCategoryId : function (modelList){
			var categoryId = document.getElementById("categoryId");
			var i = 0;
			while(i <= modelList.length - 1){
		 		var option = new Option(modelList[i].categoryName, modelList[i].categoryId);
		 		categoryId.options.add(option);
				i++;
			}
		}
	}
	
	$(function (){
		aihome.setSelectValue();
		aihome.init_jqGrid();
	});

	// 查询
	function search(){
		var param = $("#searchForm").serialize();
		var url = '${CTX}/match/getMatchJQPage.do?'+param;
		jQuery("#jqGrid").setGridParam({datatype:'json',url:url,page:1}).trigger("reloadGrid");
	}
	
	// 删除
	function deteleMatch(){
		var matchId = jQuery("#jqGrid").jqGrid('getGridParam', 'selarrrow') + "";
		if(matchId.length == 0){
			alert("请勾选数据");
			return;
		}
		if (confirm("是否删除该赛事")){
			$.ajax({
				url : "${CTX}/match/deleteMatch.do",
				type:"post",
				dataType:"json",
				data:{
					"id" : matchId
				},
				error:function(){
					alert(error);
				},
				success:function(data){
					if(data >= 1){
						alert("删除成功！");
					}else{
						alert("删除失败！");
					}
					$("#jqGrid").trigger('reloadGrid');
				}
			});
		}
	}
	
	// 新增 /修改 赛事
	function editMacth (flag, id){
		var title = "";
		var url = "";
		var matchId = jQuery("#jqGrid").jqGrid('getGridParam', 'selarrrow') + "";
		var matchIds = matchId.split(",");
		if(flag){
			title= "新增赛事";
			url = "${CTX}/match/addMatchIndex.do";
		}else{
			if(id != null){
				matchId = id;
			}
			if(matchIds.length != 1 || matchId.length == 0){
				alert("请勾选一条数据");
				return;
			}
			title= "修改赛事";
			url = "${CTX}/match/editMatchIndex.do?matchId=" + matchId;
		}
		oaDialogOpen("addMacth",						// 对话框ID，必填，且不能与当前页面的ID重复
			{url : url,									// 调用页面的url
			title : title,								// 弹框的title
			closeOnEscpe : true,						// 是否通过escpe关闭弹框
			closeBtn : true,							// 是否显示关闭按钮
			width : 500,								// 弹框的宽度
			height : 600,								// 弹框的高度
			buttons : {
				"确定" : function() {
					var url = "";
					if($("#id").val() != ""){
						url = "${CTX}/match/editMatch.do";
					}else{
						url = "${CTX}/match/addMatch.do";
					}
					$.ajax({
						url : url,
						type : "post",
						dataType : "json",
						data : $("#addMatchForm").serialize(),
						error:function(){
							alert(error);
						},
						success:function(data){
							if(data == 1){
								alert("保存成功！");
							}else{
								alert("保存失败！");
							}
						}
					});
					
					$(this).dialog("close");
				},
				"发布" : function() {
					var url = "";
					if($("#id").val() != ""){
						url = "${CTX}/match/editMatch.do";
					}else{
						url = "${CTX}/match/addMatch.do";
					}
					$.ajax({
						url : url,
						type : "post",
						dataType : "json",
						data : $("#addMatchForm").serialize(),
						error:function(){
							alert(error);
						},
						success:function(data){
							if(data == 1){
								alert("保存并发布成功！");
							}else{
								alert("保存并发布失败！");
							}
						}
					});
					
					$(this).dialog("close");
				},
				"取消" : function() {
					
					$(this).dialog("close");
				}
			},
			// 弹框打开后的回调函数
			openCall:function(){
				
			},
			// 弹框关闭后的回调函数
			closeCall:function(){
				$("#jqGrid").trigger("reloadGrid");
			}
		});
	}
	
	// 发布
	function publish(){
		var matchId = jQuery("#jqGrid").jqGrid('getGridParam', 'selarrrow') + "";
		if(matchId.length == 0){
			alert("请勾选数据");
			return;
		}
		$.ajax({
			url : "${CTX}/match/publishMatch.do",
			type:"post",
			dataType:"json",
			data:{
				"id" : matchId
			},
			error:function(){
				alert(error);
			},
			success:function(data){
				if(data >= 1){
					alert("发布成功！");
				}else{
					alert("发布失败！");
				}
				$("#jqGrid").trigger('reloadGrid');
			}
		});
	}
</script>