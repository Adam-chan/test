<div class="row">
	<div class="col-sm-12 col-xs-12 my-group ">
		<div class="form-horizontal row ">

			<div class=" row ">
				<div class="col-md-11 col-sm-11">
					<div class="form-xs form-group row">
						<label for="" class="col-xs-3 control-label">方式：</label>
						<div class="col-xs-4">
							<input id="" name="transferWay" type="radio" class="input-xs ace"
								value="1" onchange="aihome.switchRadio();" />&nbsp;<span class="lbl">共享到公客池</span>
						</div>
						<div class="col-xs-4">
							<input id="" name="transferWay" type="radio" class="input-xs ace"
								value="2" onchange="aihome.switchRadio();" />&nbsp;<span class="lbl">转介</span>
						</div>
					</div>
				</div>
			</div>

			<div id="contentHide">

				<div class=" row ">
					<div class="col-md-11 col-sm-11">
						<div class="form-xs form-group row">
							<label for="transferRate" class="col-xs-3 control-label">分佣比例：</label>
							<div class="col-xs-4">
								<input id="transferRate" type="text" class="input-xs ">&nbsp;%</input>
							</div>
						</div>
					</div>
				</div>

				<div class=" row ">
					<div class="col-md-11 col-sm-11 ">
						<div class="form-xs form-group row">
							<div class="col-xs-2 "></div>
							<label for="" class="col-xs-1 control-label">录入区：</label>
							<div class="col-xs-2 ">
								<select id="quOrgTransfer" class="input-xs form-control">
									<option value="${quCode}"  selected="true">${quCodeName}</option> 
								</select>
							</div>
							<label for="" class="col-xs-1 control-label">录入组：</label>
							<div class="col-xs-2 ">
								<select id="zuOrgTransfer" class="input-xs form-control">
									<option value=""></option>
								</select>
							</div>
							<label for="" class="col-xs-1 control-label">录入人：</label>
							<div class="col-xs-2 ">
								<select id="jingjirenTransfer" class="input-xs form-control">
									<option value=""></option>
								</select>
							</div>
						</div>
					</div>
				</div>

			</div>

		</div>
	</div>
</div>

<script type="text/javascript">
	$(function() {
		$("#contentHide").hide();
		var orgCode = $("#quOrgTransfer").val();
		aihome.getAddress(orgCode, "zuOrgTransfer");
	});
	aihome.getAddress = function(val, objId) {
		var _url = "${CTX}/org/orgList.do";
		if (objId == "jingjirenTransfer") {
			_url = "${CTX}/org/userList.do";
		}
		$.ajax({
			type : "post",
			url : _url,
			async : false,
			dataType : 'json',
			async : false,
			data : {
				"orgCode" : val
			},
			success : function(data) {

				aihome.changeAddress(data, objId);
			},
		});
	}

	aihome.changeAddress = function(data, objId) {
		var obj = $("#" + objId);

		obj.children().first().siblings().remove();
		var str = "";
		for (var i = 0; i < data.length; i++) {
			var orgCode = "";
			if (objId === "jingjirenTransfer") {
				orgCode = data[i].userId;
			} else {
				orgCode = data[i].orgCode;
			}
			var name = data[i].name;
			str = '<option value="'+orgCode+'">' + name + '</option>';
			obj.append(str);
		}
	}

	/**组*/
	$("#zuOrgTransfer").change(function() {
		var orgCode = $(this).val();
		//组数据变更，下级全部清空
		$("#jingjirenTransfer").children().first().siblings().remove();
		aihome.getAddress(orgCode, "jingjirenTransfer");
	});
	/**
	 * 区
	 */
	$("#quOrgTransfer").change(function() {

		var orgCode = $(this).val();
		//区数据变更，下级全部清空
		$("#zuOrgTransfer").children().first().siblings().remove();
		$("#jingjirenTransfer").children().first().siblings().remove();
		aihome.getAddress(orgCode, "zuOrgTransfer");
	});

	aihome.switchRadio = function() {
		transferWay = $("[name='transferWay']:checked").val();
		if (transferWay == 2) {
			$("#contentHide").show();
		} else {
			$("#contentHide").hide();
		}
	}
	
	/*将客源转入公客池*/
	aihome.saveTransferCustomer = function(rowIds){
		transferWay = $("[name='transferWay']:checked").val();
		if (transferWay == 1) {
			
			$.ajax({
				type : "post",
				url : "${CTX}/customerSource/saveCustToPubPool.do",
				async : false,
				dataType : 'json',
				data : {
					rowIds : rowIds
				},
				success : function(data) {
					alert("成功转入公客池！");
				},
			});
		}else if (transferWay == 2) {
			
			var transferRate = $("#transferRate").val();
			var zuOrgId = $("#zuOrgTransfer").val();
			var jingjirenId = $("#jingjirenTransfer").val();
			var zuOrg = $("#zuOrgTransfer").find("[value='"+zuOrgId+"']").text();
			var jingjiren = $("#jingjirenTransfer").find("[value='"+jingjirenId+"']").text();
			
			$.ajax({
				type : "post",
				url : "${CTX}/customerSource/transferCustomerToOther.do",
				async : false,
				dataType : 'json',
				data : {
					demandId : rowIds,
					rate : transferRate,
					receiveOrgCode : zuOrgId,
					receiveUserId : jingjirenId,
					receiveOrgName : zuOrg,
					receiveUser : jingjiren
				},
				success : function(data) {
					alert("已将转介信息发送给对方，请等待对方回复！");
				},
			});
		}
		
	}
</script>