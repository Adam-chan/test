<input type="hidden" id="demandType" value ="${(demandType)!''}" />
<input type="hidden" id="propertyType" value ="${(propertyType)!''}" />
<div class="row">
	<div class="col-md-6 col-xs-6">
		<div class="form-xs form-group row">
			<label class="col-xs-3 control-label">范围：</label>
			<div class="col-xs-6">
				<select id="rangeAdd" class="input-xs form-control col-xs-6">
					<option selected="selected" value="">请选择</option>
					<option value="1">收藏盘</option>
					<option value="2">责任盘</option>
					<option value="3">经营盘</option>
				</select>
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div class="col-xs-6">
		<div class="form-xs form-group row">
			<label class="col-xs-3 control-label">房源编号：</label>
			<div class="col-xs-6">
				<input id="codeAdd" class="form-control input-xs" />
			</div>
		</div>
	</div>
	<div class="col-xs-6">
		<div class="form-xs form-group row">
			<label for="" class="col-xs-2 control-label">价格：</label>
			<div class="col-xs-2">
				<input id="priceStartAdd" class="form-control input-xs" type="text">
			</div>
			<div class="col-xs-1">
				<label>-</label>
			</div>					
			<div class="col-xs-2">
				<input id="priceEndAdd" class="form-control input-xs" type="text">
			</div>			
			<div class="col-xs-2">
				<label class="control-label">元/月</label>
			</div>	
		</div>
	</div>	
</div>	
<div class="row">
	<div class="col-xs-6">
		<div class="form-xs form-group row">
			<label class="col-xs-3 control-label">建筑面积：</label>
			<div class="col-xs-2">
				<input id="areaStartAdd" class="form-control input-xs" type="text">
			</div>
			<div class="col-xs-1">
				<label>-</label>
			</div>					
			<div class="col-xs-2">
				<input id="areaEndAdd" class="form-control input-xs" type="text">
			</div>			
			<div class="col-xs-1">
				<label>㎡</label>
			</div>	
		</div>
	</div>	
	<div class="col-xs-6 ">
		<div class="form-xs form-group row">
			<label for="" class="col-xs-2 control-label">户型：</label>
			<div class="col-xs-1">
				<select id="roomsAdd" class="input-xs form-control">
					<option value=""></option>
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
				</select>
			</div>
			<div class="col-xs-1">
				<label>室</label>
			</div>
			<div class="col-xs-1">
				<select id="officeAdd" class="input-xs form-control">
					<option value=""></option>
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
				</select>
			</div>
			<div class="col-xs-1">
				<label>厅</label>
			</div>
			<div class="col-xs-1">
				<select id="wcAdd" class="input-xs form-control">
					<option value=""></option>
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
				</select>
			</div>
			<div class="col-xs-1">
				<label>卫</label>
			</div>
			<div class="col-xs-1">
				<select id="balconyAdd" class="input-xs form-control">
					<option value=""></option>
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
				</select>
			</div>
			<div class="col-xs-1">
				<label>厨</label>
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div class="col-md-6">
		<div class="form-xs form-group row">
			<label class="col-xs-3 control-label">楼层要求： </label>
			<div class="col-xs-3">
				<input id="needFloorStartAdd" class="form-control input-xs" type="text" >
			</div>
			<div class="col-xs-1">
				<label>-</label>
			</div>					
			<div class="col-xs-3">
				<input id="needFloorEndAdd" class="form-control input-xs" type="text" >
			</div>
			<div class="col-xs-1">
				<label>层</label>
			</div>										
		</div>
	</div>
	<div class="col-md-6">
		<div class="form-xs form-group row">
			<label class="col-xs-2 control-label">装修： </label>
			<div class="col-xs-6">
				<div class="col-xs-12">
					<select id="decorationAdd" class="input-xs form-control">
						<option selected="selected" value="">请选择</option>
						<option value="1">均可</option>
						<option value="2">毛坯</option>
						<option value="3">精装</option>
						<option value="4">简装</option>
					</select>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div class="col-md-6 col-xs-6">
		<div class="form-xs form-group row">
			<label class="col-xs-3 control-label">楼盘：</label>
			<div class="col-xs-8">
				<input id="premisesAdd" class="form-control input-xs" placeholder="输入楼盘名称" />
				<input id="premisesIdAdd" type="hidden" >
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div class="col-md-6 col-sm-6">
		<div class="form-xs form-group row">
			<label class="col-xs-3 control-label">商圈： </label>
			<div class="col-xs-8">
				<input id="busiAreaAdd" class="form-control input-xs" placeholder="输入商圈名称" />
				<input id="busiAreaIdAdd" type="hidden" >
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div class="col-xs-4">
	</div>
	<button class="col-md-1 col-sm-1 col-xs-1 btn btn-xs btn-blue ladda-button" onclick="aihome.query();">
		<span>查询</span>
	</button> 
	<div class="col-xs-1">
	</div>
	<button class="col-md-1 col-sm-1 col-xs-1 btn btn-xs btn-blue ladda-button" onclick="aihome.clear();">
		<span>清空</span>
	</button> 	
	<div class="col-xs-5">
	</div>
</div>


<table id="addRecommendJqGrid"></table>
<div id="addRecommendJqGridPager"></div>
<script type="text/javascript">
	
/*初始化分页页面*/
aihome.addRecommendInit = function () {
	$("#addRecommendJqGrid")
	.jqGrid(
			{
				height : $(window).height() - 600,
				multiselect : true,
				multiboxonly : true,
				viewrecords : true,
				rownumbers : true,
				autowidth : true,
				autoheight : true,
				async : false,
				url : "${CTX}/customerSource/getHouseSourcePage.do",
				postData : {
					demandType :$("#demandType").val(),
					propertyType :$("#propertyType").val()
				},
				datatype : "json",
				colNames : [ '房源编号', '楼盘', '地址', '价格（万元）','面积（m&sup2;）', '户型', 
								'楼层','装修','房源地址 ','房源id','楼层','朝向 ','小区名','useType','code','houseInfoId'],
				colModel : [       
							{name : 'houseCode',sortable : false,width : 5,align : 'center',
								formatter:function(rowName, options, rowObject){
									 var html = "";
									 if(rowObject.code){
										 var demandType = $("#demandType").val();
										 html += "<a style='color: blue;' onclick='aihome.houseDetail(" + rowObject.houseInfoId +","+demandType+","+rowObject.useType + ");'>"+rowObject.code +"<a/>";
									 }
				            	     return html;
					             }}, 
							{name : 'premisesName',sortable : false,width : 8,align : 'center'},
							{name : 'addressDetail',sortable : false,width : 3,align : 'center',
								 formatter:function(rowName, options, rowObject){
									 var html = "";
									 if(rowObject.addressDetail){
										 html += "<a href=\"javascript:aihome.alertAddress('"+rowObject.addressDetail+"')\" style='text-decoration:underline;color:blue'>查看</a>";
									 }
				            	     return html;
					             }
							}, 
							{name : 'leasePrice',sortable : false,width : 4,align : 'center'}, 
							{name : 'coveredArea',sortable : false,width : 4,align : 'center'}, 
							{name : 'floorType',sortable : false,width : 6,align : 'center',
								formatter:function(rowName, options, rowObject){
								 var html = "";
								 if(rowObject.rooms){
									 html += rowObject.rooms+"室";
								 }
								 if(rowObject.office){
									 html += rowObject.office+"厅";
								 }
								 if(rowObject.wc){
									 html += rowObject.wc+"卫";
								 }
			            	     return html;
				             }}, 
							{name : 'floors',sortable : false,width : 4,align : 'center',
				            	 formatter:function(rowName, options, rowObject){
				            		 var chaoXiang = rowObject.chaoXiang;
									 var html = "";
									 if(rowObject.floor){
										 html += rowObject.floor+"层";
									 }
									 html +="（";
									 if(chaoXiang){
										 if(chaoXiang == 1){
											 html += "东";
										 }else if(chaoXiang == 2){
											 html += "南";
										 }else if(chaoXiang == 3){
											 html += "西";
										 }else if(chaoXiang == 4){
											 html += "北";
										 }
									 }
									 html +="）";
				            	     return html;
					             } }, 
							{name : 'decoradionStr',sortable : false,width : 4,align : 'center'},
							{name: 'addressDetail', index: 'addressDetail', hidden: true},
							{name: 'houseInfoId', index: 'houseInfoId', hidden: true, key: true},
							{name: 'floor', index: 'floor', hidden: true},
							{name: 'useType', index: 'useType', hidden: true},
							{name: 'code', index: 'code', hidden: true},
							{name: 'houseInfoId', index: 'houseInfoId', hidden: true},
							{name: 'communityName', index: 'communityName', hidden: true},
							{name: 'chaoXiang', index: 'chaoXiang', hidden: true,
								formatter:function(rowName, options, rowObject){
				            		 var chaoXiang = rowObject.chaoXiang;
									 var html = "";
									 if(chaoXiang){
										 if(chaoXiang == 1){
											 html += "东";
										 }else if(chaoXiang == 2){
											 html += "南";
										 }else if(chaoXiang == 3){
											 html += "西";
										 }else if(chaoXiang == 4){
											 html += "北";
										 }
									 }
				            	     return html;
					             }}
							],
				rowNum : 10,
				rowList : [ 10, 20, 30, 50, 100 ],
				pager : "#addRecommendJqGridPager",
				jsonReader : {
					root : 'pagerResults',
					page : 'currentPage',
					rows : 'rowCount',
					total : 'pageCount',
					records : 'totalCount',
					repeatitems : false
				}
			});
}
aihome.alertAddress = function(address) {
	bootbox.dialog({
		title:"具体地址:",
		message: "<div style=\"margin-left:auto;margin-right: auto;\"class=\"row form-xs\">"+address+"</div>",
	});
};

//查看房源详情页
aihome.houseDetail = function(houseId,type,num){
	oaDialogOpen("lookUpHouse",//对话框ID，必填，且不能与当前页面的ID重复
		 {url:"${CTX}/houseLease/lookUpDetail.do?houseInfoId="+houseId+"&type="+type+"&num="+num,
		      title:"查看详细信息",//弹框的title
		      closeOnEscpe:true,//是否通过escpe关闭弹框
		      closeBtn:true,//是否显示关闭按钮
		      width: $(window).width()*0.8,//弹框的宽度
			  height: $(window).height()*0.9,
		  })
};
	
$("#busiAreaAdd").autocomplete({
	source : function(request, response) {
		$.ajax({
			url:'${CTX}/customerSource/getBusiNameList.do',
			dataType : "json",
			type : 'post',
			data : {
				'busiAreaName' : request.term
			},
			success : function(data) {
				var arr = new Array(data.length);
				for (var i = 0; i < data.length; i++) {
					var s = {
						value : data[i].busiAreaName,
						key : data[i].id
					};
					arr[i] = s;
				}
				response(arr); 
			}
	});
	},
	select : function(event, ui) {
		$("#busiAreaAdd").val(ui.item.value);
		$("#busiAreaIdAdd").val(ui.item.key);
		event.preventDefault();
	}
});
	
$("#premisesAdd").autocomplete({
	source : function(request, response) {
		$.ajax({
			url:'${CTX}/customerSource/getPremisesListByMatch.do',
			dataType : "json",
			type : 'post',
			data : {
				'name' : request.term,
				'noIds': aihome.demandPremisesIdsStr
			},
			success : function(data) {
				var arr = new Array(data.length);
				for (var i = 0; i < data.length; i++) {
					var s = {
						value : data[i].name,
						key : data[i].id
					};
					arr[i] = s;
				}
				response(arr); 
			}
	});
	},
	select : function(event, ui) {
		$("#premisesAdd").val(ui.item.value);
		$("#premisesIdAdd").val(ui.item.key);
		event.preventDefault();
	}
});

/* 查询 */
aihome.query = function() {
	if ($("#areaNameAdd").val() == "") {
		$("#areaIdAdd").val("");
	}
	if ($("#busiAreaAdd").val() == "") {
		$("#busiAreaIdAdd").val("");
	}
	$("#addRecommendJqGrid").setGridParam({
		postData : {
			range:$("#range").val(),//暂未使用
			codeCust:$("#codeAdd").val(),
			priceStartCust:$("#priceStartAdd").val(),
			priceEndCust:$("#priceEndAdd").val(),
			areaStartCust:$("#areaStartAdd").val(),
			areaEndCust:$("#areaEndAdd").val(),
			roomsCust:$("#roomsAdd").val(),
			officeCust:$("#officeAdd").val(),
			wcCust:$("#wcAdd").val(),
			kitchenCust:$("#balconyAdd").val(),
			floorStartCust:$("#needFloorStartAdd").val(),
			floorEndCust:$("#needFloorEndAdd").val(),
			decoradionCust:$("#decorationAdd").val(),
			busiAreaId:$("#busiAreaIdAdd").val(),
			premisesAdd:$("#premisesAdd").val(),
			
		}
	}).trigger("reloadGrid");
}

$("#busiAreaAdd").blur(function() {
	$(this).attr("placeholder", "输入商圈名称");
});		
$("#premisesAdd").blur(function() {
	$(this).attr("placeholder", "输入楼盘名称");
});

/* 清空 */
aihome.clear = function () {
	$("#range").val("");//暂未使用
	$("#codeAdd").val("");
	$("#priceStartAdd").val("");
	$("#priceEndAdd").val("");
	$("#areaStartAdd").val("");
	$("#areaEndAdd").val("");
	$("#roomsAdd").val("");
	$("#officeAdd").val("");
	$("#wcAdd").val("");
	$("#balconyAdd").val("");
	$("#needFloorStartAdd").val("");
	$("#needFloorEndAdd").val("");
	$("#decorationAdd").val("");
	$("#busiAreaIdAdd").val("");
	$("#premisesAdd").val("");
	
}

aihome.recommend = function (){//设为推荐
	var rowIds = $("#addRecommendJqGrid").jqGrid('getGridParam', 'selarrrow').join(",");
	var selCount = rowIds.length;
	if (selCount == 0) {
		alert("请至少选择一个房源");
		return false;
	}else{
		$.ajax({
		       type: "POST",
		       url: "${CTX}/customerSource/recommend.do",
		       async:false,
		       dataType:"JSON",
		       data: {
					houseInfoIds : rowIds,
					custDemandId : $("#custDemandId").val(),
		    		   },
		       success: function(data){
			    	alert("推荐成功");
		       }
		});
    	return true;
	}
}

$(function() {
	aihome.addRecommendInit();
});
</script>