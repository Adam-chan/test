<div id="top_tools" class=" btn-group">
	<button  class="btn btn-sm btn-white"
		onclick="aihome.cleanQuery();">
		<i class="iconfont">&#xe626;</i> <span>清空</span>
	</button>
	<button  class="btn btn-sm btn-white"
		onclick="aihome.queryCustomerSource();">
		<i class="iconfont">&#xe626;</i> <span>查询</span>
	</button>
	<button  class="btn btn-sm btn-white"
		onclick="aihome.toAddCustomerSource();">
		<i class="iconfont">&#xe6e0;</i> <span>添加客源</span>
	</button>
	<button  class="btn btn-sm btn-white"
		onclick="aihome.toDealCustomerPool();">
		<i class="iconfont">&#xe657;</i> <span>转成交客户池</span>
	</button>
	<button  class="btn btn-sm btn-white"
		onclick="aihome.dispatchCustomerSource();">
		<i class="iconfont">&#xe668;</i> <span>调配</span>
	</button>
	<button class="btn btn-sm btn-white" onclick="aihome.addAppointTakeLook();">
		<i class="iconfont">&#xe62e;</i> <span>约带看</span>
	</button>
	<button  class="btn btn-sm btn-white" onclick="aihome.transferCustomer();">
		<i class="iconfont">&#xf02a4;</i> <span>转介</span>
	</button>
	<button  class="btn btn-sm btn-white"
		onclick="aihome.callBackCustomer();">
		<i class="iconfont">&#xe6c5;</i> <span>回访</span>
	</button>
	<button  class="btn btn-sm btn-white" onclick="aihome.setProtectedCust();">
		<i class="iconfont">&#xe62b;</i> <span>保护</span>
	</button>
	<button  class="btn btn-sm btn-white" onclick="aihome.cancelProtectedCust();">
		<i class="iconfont">&#xe6e3;</i> <span>取消保护</span>
	</button>
	<button  class="btn btn-sm btn-white" onclick="aihome.addBlackList();">
		<i class="iconfont">&#xe62c;</i> <span>拉黑</span>
	</button>
</div>
<div class="row">
	<div class="col-xs-12 my-group">
		<div id="cssUp" class="form-horizontal row my-inputs">
		<form id="custSourceForm" action="javascript:void(0);" >
		<div class=" row ">	
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="userType" class="col-xs-4 control-label">需求类型：</label>
					<div class="col-xs-8 ">
						<div class="row " style="padding-left: 3px;">
							<select id="demandType" class="input-xs col-xs-4 " style="margin-left: 9px;"  onchange="aihome.switchTable();">
								<option value="">请选择</option>
								<option value="2" selected="selected">求租</option>
								<option value="1">求购</option>
							</select>
							 <select id="propertyType" class="input-xs col-xs-4"  onchange="aihome.switchTable();">
								<option value="">请选择</option>
								<option value="1" selected="selected">住宅</option>
								<option value="2">商铺</option>
								<option value="3">写字楼</option>
								<option value="4">车位</option>
							</select>
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="userName" class="col-xs-4 control-label">客户名称：</label>
					<div class="col-xs-6">
						<input id="userName" mustauto="false"
							class="form-control input-xs" placeholder="输入客户名称" /> <input
							id="id" name="id" type="hidden" />
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="demandCode" class="col-xs-4 control-label">客源编号：</label>
					<div class="col-xs-6">
						<input id="demandCode" class="form-control input-xs" />
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="custJudge" class="col-xs-4 control-label">客户评价：</label>
					<div class="col-xs-6">
						<select id="custJudge" class="input-xs form-control">
							<option value=""></option>
							<option value="5">所有有效</option>
							<option value="0">所有未评价</option>
							<option value="1">A</option>
							<option value="2">B</option>
							<option value="3">C</option>
							<option value="4">F</option>
						</select>
					</div>
				</div>
			</div>
		</div>
		<div class=" row ">	
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="tell" class="col-xs-4 control-label">客户电话：</label>
					<div class="col-xs-6">
						<input id=tell class="form-control input-xs" />
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="demandStatus" class="col-xs-4 control-label">客户状态：</label>
					<div class="col-xs-6">
						<select id="demandStatus" class="input-xs form-control">
							<option value=""></option>
							<option value="8">所有有效</option>
							<option value="1">新信息</option>
							<option value="2">约带看</option>
							<option value="3">再推荐</option>
							<option value="4">意向中</option>
							<option value="5">成交</option>
							<option value="6">放弃</option>
							<option value="7">假信息</option>
						</select>
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="isPromised" class="col-xs-4 control-label">看房次数：</label>
					<div class="col-xs-6">
						<input id="isPromised" class="form-control input-xs" />
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3" style="height:30.5px;">
				<div class="form-xs form-group row">
					<label for="buildType" class="col-xs-4 control-label">楼型：</label>
					<div class="col-xs-6">
						<select id="buildType" class="input-xs form-control">
							<option value=""></option>
							<option value="1">所有</option>
							<option value="2">高层</option>
							<option value="3">多层</option>
							<option value="4">平房</option>
							<option value="5">别墅</option>
							<option value="6">其他</option>
						</select>
					</div>
				</div>
			</div>
		</div>	
		<div class=" row ">	
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="rooms" class="col-xs-4 control-label">户型：</label>
					<div class="col-xs-6">
						<select id="rooms" class="input-xs form-control">
							<option value=""></option>
							<option value="1">1室</option>
							<option value="2">2室</option>
							<option value="3">3室</option>
						</select>
					</div>
				</div>
			</div>
			
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label class="col-xs-4 control-label">客户类型：</label>
					<div class="col-xs-6">
						<select id="cdType" class="input-xs form-control">
							<option value=""></option>
							<option value="1">私客</option>
							<option value="2">组公客</option>
							<option value="3">区公客</option>
						</select>
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="demandPremises" class="col-xs-4 control-label">意向小区：</label>
					<div class="col-xs-6">
						<input id="demandPremises" class="form-control input-xs" />
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label class="col-xs-4 control-label">沟通时间：</label>
					<div class="col-xs-6">
						<div class=" input-daterange input-group 5i5jdate" style="">
							<input type="text" class="form-control input-xs"
								id="custFollowStart" placeholder="开始时间"> <span
								class="input-group-addon addon-xs"> <i
								class="fa fa-exchange"></i>
							</span> <input type="text" class="form-control input-xs"
								id="custFollowEnd" placeholder="结束时间">
						</div>
					</div>
				</div>
			</div>	
		</div>	
		
		<div class=" row ">		
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="isDemand" class="col-xs-4 control-label">承受价格：</label>
					<div class="col-xs-6">
						<input id="priceStart" class="input-xs" style="width: 32%;" />-- <input
							id="priceEnd" class="input-xs" style="width: 32%;" />元/月
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="entryPerson" class="col-xs-4 control-label">面积：</label>
					<div class="col-xs-6">
						<input id="areaStart" class="input-xs" style="width: 32%;" />-- <input
							id="areaEnd" class="input-xs" style="width: 32%;" />m&sup2;
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label class="col-xs-4 control-label">录入时间：</label>
					<div class="col-xs-6">
						<div class=" input-daterange input-group 5i5jdate" style="">
							<input type="text" class="form-control input-xs"
								id="createTimeStart" placeholder="开始时间"> <span
								class="input-group-addon addon-xs"> <i
								class="fa fa-exchange"></i>
							</span> <input type="text" class="form-control input-xs"
								id="createTimeEnd" placeholder="结束时间">
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label class="col-xs-4 control-label">看房时间：</label>
					<div class="col-xs-6">
						<div class=" input-daterange input-group 5i5jdate" style="">
							<input type="text" class="form-control input-xs"
								id="lookHouseStart" placeholder="开始时间"> <span
								class="input-group-addon addon-xs"> <i
								class="fa fa-exchange"></i>
							</span> <input type="text" class="form-control input-xs"
								id="lookHouseEnd" placeholder="结束时间">
						</div>
					</div>
				</div>
			</div>	
		</div>
		<div class=" row ">	
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="isFollowed" class="col-xs-4 control-label">有无跟进：</label>
					<div class="col-xs-6">
						<select id="isFollowed" class="input-xs form-control">
							<option value=""></option>
							<option value="1">有跟进</option>
							<option value="0">无跟进</option>
						</select>
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="isPromise" class="col-xs-4 control-label">有无带看：</label>
					<div class="col-xs-6">
						<select id="isPromise" class="input-xs form-control">
							<option value=""></option>
							<option value="1">有带看</option>
							<option value="0">无带看</option>
						</select>
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="demandRegion" class="col-xs-4 control-label">区域：</label>
					<div class="col-xs-6">
						<input id="demandRegion" class="form-control input-xs" />
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
				<label class="col-xs-4 control-label">来源：</label>
					<div class="col-xs-8">
						<div class="row " style="margin-left: 1px;">
							<select id="parentSource" class="input-xs " name="ownerSource" >
								<option value="">请选择</option>
								<#if parentSourceList?exists>
									<#list parentSourceList as source>
										<option value="${source.id!''}">${source.source!''}</option>
									</#list>
								</#if>
							</select>
							<select id="childSource" class="input-xs " >
								<option value="">请选择</option>
							</select>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class=" row ">	
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="quOrg" class="col-xs-4 control-label">归属区：</label>
					<div class="col-xs-6">
						<select id="quOrg" class="input-xs form-control">
									<option value=""></option> <#if quOrgList ??> <#list quOrgList
									as item>
									<option value="${item.orgCode}">${item.name}</option> </#list>
									</#if>
						</select>
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="zuOrg" class="col-xs-4 control-label">归属组：</label>
					<div class="col-xs-6">
						<select id="zuOrg" class="input-xs form-control">
									<option value=""></option>
						</select>
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="operateUser" class="col-xs-4 control-label">归属人：</label>
					<div class="col-xs-6">
						<select id="jingjiren" class="input-xs form-control">
									<option value=""></option>
						</select>
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="operateUser" class="col-xs-4 control-label">私客是否保护：</label>
					<div class="col-xs-6">
						<input id="showIsProtectedList" name="privateCustProtect" type="radio" class="input-xs ace"
								value="1" onchange="aihome.showIsProtectedList();" />&nbsp;<span class="lbl">是</span>
						<input id="showIsProtectedList" name="privateCustProtect" type="radio" class="input-xs ace"
								value="2" onchange="aihome.showIsProtectedList();" />&nbsp;<span class="lbl">否</span>
					</div>
				</div>
			</div>
		</div>
		<div class=" row ">	
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="entrustCode" class="col-xs-4 control-label">协议编号：</label>
					<div class="col-xs-6">
						<input id="entrustCode" class="form-control input-xs" />
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="isSign" class="col-xs-5 control-label">是否签委托协议：</label>
					<div class="col-xs-5">
						<select id="isSign" class="input-xs form-control">
							<option value=""></option>
							<option value="1">是</option>
							<option value="2">否</option>
						</select>
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
					<label for="signStatus" class="col-xs-4 control-label">协议状态：</label>
					<div class="col-xs-6">
						<select id="signStatus" class="input-xs form-control">
							<option value=""></option>
							<option value="1">有效</option>
							<option value="2">无效</option>
						</select>
					</div>
				</div>
			</div>
			<div class="col-md-3 col-sm-3">
				<div class="form-xs form-group row">
				<label  class="col-xs-4 control-label">
				<i class="glyphicon glyphicon-star" style="color:red;"></i>:被保护客源
				</label>
			   </div>
			</div>
		</div>	
		<div class=" row ">	
			<div class="col-md-4 col-sm-4">
				<div class="form-xs form-group row">
				</div>
			</div>
			<div class="col-md-5 col-sm-5">
				<div class="col-md-12 col-sm-12">
					<div class="form-xs form-group row">
						<input id="notTimeCallBack"  type="checkbox" class="input-xs ace"
									value="1" onchange="aihome.notTimeCallBack();" /><span class="lbl">&nbsp;店长未按时回访客源&nbsp;</span>
						<input id="needCallBack"  type="checkbox" class="input-xs ace"
						value="2" onchange="aihome.needCallBack();" /><span class="lbl">&nbsp;店长需回访客源&nbsp;</span>
						<input id="haveTransfered"  type="checkbox" class="input-xs ace"
						value="3" onchange="aihome.haveTransfered();" /><span class="lbl">&nbsp;转介</span>
					</div>
				</div>
		   </div>
	   </div>	
		</form>	
		</div>
		
	<div id="more-input" class="" style="height: 71px;">
			<div>
				<i class="iconfont"></i>
			</div>
		</div>
	</div>
	<div class="col-xs-12 my-grid">
		<!-- PAGE CONTENT BEGINS -->
		<table id="jqGrid">
		</table>
		<div id="jqGridPager"></div>
		<!-- PAGE CONTENT ENDS -->
	</div>
</div>
<input id = "custPromiseHouseId" type="hidden">
<input id = "custPromisePremisesId" type="hidden">
<style>
.ui-jqgrid tr.jqgrow td {
	white-space: normal !important;
	height: auto;
	vertical-align: text-top;
	padding-top: 2px;
}
</style>
<script type="text/javascript">
var aihome = {};
	$('.page-content-area').ace_ajax('loadScripts', [ null, "../assets/js/bootbox.js" ], function() {
	});

	aihome.custSourceInit = function () {
		$("#jqGrid")
				.jqGrid(
						{
							height : $(window).height() - 215,
							multiselect : true,
							multiboxonly : true,
							viewrecords : true,
							rownumbers : true,
							autowidth : true,
							autoheight : true,
							async : false,
							url : "${CTX}/customerSource/getCustomerSourcePage.do",
							postData : {
								demandType :$("#demandType").val(),
								propertyType :$("#propertyType").val()
							},
							datatype : "json",
							colNames : [ '评价', '客户姓名 客源编号', '电话',
											'带看次数 带看时间', '客户状态', '承受价位 租期',
											'需求面积（m&sup2;） ','需求户型', '楼层', '紧急程度',
											'看房时间', '意向小区', '租赁方式','录入时间 最后跟进时间', '所属组 所属人' ,
											'用户名','录入时间','最后跟进时间','承受价位','租期','所属组','所属人','带看次数','带看时间',
											'客源编号','室','厅','是否被保护','customerId','orgName'],
							colModel : [       
										{name : 'custJudgeStr',sortable : false,width : 1,align : 'center'}, 
										{name : 'Modify1',sortable : false,width : 4,align : 'center'}, 
							             {
										  name : 'tell',sortable : false,width : 2,align : 'center',
										  formatter : function(cellvalue,
												options, rowObject) {
											var id = rowObject.id;
											return "<a onclick='aihome.userCheckInfoFun(this)' demandType='2' demandId = '"+id+"' style='text-decoration:underline;color:blue'> 查看 </a>";
											}
										},     
										{name : 'Modify5',sortable : false,width : 4,align : 'center'}, 
										{name : 'demandStatusStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'Modify3',sortable : false,width : 4,align : 'center'}, 
										{name : 'buildArea',sortable : false,width : 3,align : 'center'}, 
										{name : 'Modify6',sortable : false,width : 3,align : 'center'}, 
										{name : 'buildTypeStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'demandUrgentStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'takeLookTimeStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'demandPremises',sortable : false,width : 4,align : 'center'}, 
										{name : 'joinRentStr',sortable : false,width : 2,align : 'center'}, 
										{name : 'Modify2',sortable : false,width : 4,align : 'center'}, 
										{name : 'Modify4',sortable : false,width : 4,align : 'center'}, 
										{ name: 'userName', index: 'userName', hidden: true},
										{ name: 'createTimeStr', index: 'createTimeStr', hidden: true},
										{ name: 'operateTimeStr', index: 'operateTimeStr', hidden: true},
										{ name: 'affordPrice', index: 'affordPrice', hidden: true},
										{ name: 'rentTime', index: 'rentTime', hidden: true},
										{ name: 'operateOrg', index: 'operateOrg', hidden: true},
										{ name: 'operateUser', index: 'operateUser', hidden: true},
										{ name: 'isPromised', index: 'isPromise', hidden: true},
										{ name: 'takeDateStr', index: 'takeDateStr', hidden: true},
										{ name: 'demandCode', index: 'demandCode', hidden: true},
										{ name: 'rooms', index: 'rooms', hidden: true},
										{ name: 'isProtected', index: 'rooms', hidden: true},
										{ name: 'orgName', index: 'orgName', hidden: true},
										{ name: 'customerId', index: 'customerId', hidden: true},
										{ name: 'office', index: 'office', hidden: true}
										],
										gridComplete: function () {
											var ids = $("#jqGrid").jqGrid("getDataIDs");
											for (var i = 0; i < ids.length; i++) {
												var id = ids[i];
												var rowData = $("#jqGrid").jqGrid('getRowData',id);
												var isProtected = (rowData.isProtected)==1?"<i   class='iconfont' style='color:red;cursor:pointer;'>&#xe726;</i>":'';
												var modify1 = isProtected+rowData.userName +"<br/><div><a onclick='aihome.showDetails("+id+");' style='text-decoration:underline;color:blue'>"+rowData.demandCode + "</a></div>";
												var modify2 = rowData.createTimeStr+"<br/>"+rowData.operateTimeStr;
												var modify3 = rowData.affordPrice+"元/月<br/>"+rowData.rentTime+"个月";
												var modify4 = rowData.orgName+"<br/>"+rowData.operateUser;
												var modify5 = rowData.isPromised+"<br/>"+rowData.takeDateStr;
												var modify6 = rowData.rooms+"室"+rowData.office+"厅";
												$("#jqGrid").jqGrid("setRowData", id, { Modify1: modify1 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify2: modify2 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify3: modify3 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify4: modify4 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify5: modify5 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify6: modify6 });
												
												
											}
										},
							rowNum : 30,
							rowList : [ 10, 20, 30, 50, 100 ],
							pager : "#jqGridPager",
							jsonReader : {
								root : 'pagerResults',
								page : 'currentPage',
								rows : 'rowCount',
								total : 'pageCount',
								records : 'totalCount',
								repeatitems : false
							}
						});
	}

	aihome.toAddCustomerSource = function () {
		oaDialogOpen("toAddCustomerSource",//对话框ID，必填，且不能与当前页面的ID重复
		{
			url : "${CTX}/customerSource/toAddCustomerSource.do",//调用页面的url
			title : "添加客源",//弹框的title
			closeOnEscpe : true,//是否通过escpe关闭弹框
			closeBtn : true,//是否显示关闭按钮
			width : 1200,//弹框的宽度
			height: $(window).height()*0.9,
			buttons : {
				"保存" : function() {
					aihome.saveCustomerSource(1);
					$(this).dialog("close");
					$("#jqGrid").trigger('reloadGrid');
				},
				"取消" : function() {
					$(this).dialog("close");
				}
			}
		});
	}
	
	//约带看
	aihome.addAppointTakeLook = function (lastPage) {
		var rowIds = $("#jqGrid").jqGrid('getGridParam','selarrrow');
		var selCount=rowIds.length;
		
		if (selCount==0){
			alert("没有选中的客源！");
			return;
		}else if(selCount >1){
			alert("请只选择一个客源！");
			return;
		}
		var rowData = $("#jqGrid").jqGrid('getRowData',rowIds);
		var userName = rowData.userName;
		var demandCode = rowData.demandCode;
		var demandType = $("#demandType").val();
		
		$.ajax({
			url : "${CTX}/customerSource/getTakeLookCount.do",
			dataType : "json",
			async : false,
			type : 'post',
			data : {
				rowIds : rowIds
			},
			success : function(data) {
				alert("该客源已有新建中的约带看，请去约带看管理页面进行操作！")
			},
			error : function(data) {
				var heights = $(window).height()*0.9;
				var widths = $(window).width()*0.6;
				
				oaDialogOpen("toAppointTakeLook",//对话框ID，必填，且不能与当前页面的ID重复
				{
					url : "${CTX}/customerSource/addAppointTakeLook.do?userName="+userName+
							"&demandCode="+demandCode+"&addCustomerId="+rowIds+"&demandType="+demandType+"&lastPage="+lastPage,//调用页面的url
					title : "添加约带看",//弹框的title
					closeOnEscpe : true,//是否通过escpe关闭弹框
					closeBtn : true,//是否显示关闭按钮
					width : widths,//弹框的宽度
					height : heights,
					buttons : {
						"添加" : function() {
							
							aihome.addDemandHouse();
						},
						"保存" : function() {
							var takeType = $("#takeType").val();
							if(takeType == 1){
								aihome.saveCustTakeLook(rowIds);
							}else{
								aihome.savePremisesTakeLook(rowIds);
							}
							$(this).dialog("close");
							$("#jqGrid").trigger('reloadGrid');
						},
						"取消" : function() {
							$(this).dialog("close");
						}
					}
				});
			}
		});
		
		
		
	}
	
	/* 查询 */
	aihome.queryCustomerSource = function () {
		$("#jqGrid").setGridParam({
			postData : {
				userName : $("#userName").val(),
				demandStatus : $("#demandStatus").val(),
				custJudge : $("#custJudge").val(),
				buildType : $("#buildType").val(),
				parentSource : $("#parentSource").val(),
				childSource : $("#childSource").val(),
				demandType : $("#demandType").val(),
				propertyType : $("#propertyType").val(),
				isPromised  : $("#isPromised").val(),
				operateOrg : $("#operateOrg").val(),
				demandRegion : $("#demandRegion").val(),
				demandPremises : $("#demandPremises").val(),
				operateUser : $("#jingjiren").val(),
				rooms : $("#rooms").val(),
				entrustCode : $("#entrustCode").val(),
				isSign : $("#isSign").val(),
				signStatus : $("#signStatus").val(),
				tell : $("#tell").val(),
				isFollowed : $("#isFollowed").val(),
				isPromise : $("#isPromise").val(),
				priceStart : $("#priceStart").val(),
				priceEnd : $("#priceEnd").val(),
				areaStart : $("#areaStart").val(),
				areaEnd : $("#areaEnd").val(),
				demandCode : $("#demandCode").val(),
				lookHouseStart : $("#lookHouseStart").val(),
				lookHouseEnd : $("#lookHouseEnd").val(),
				custFollowStart : $("#custFollowStart").val(),
				custFollowEnd : $("#custFollowEnd").val(),
				createTimeStart : $("#createTimeStart").val(),
				cdType : $("#cdType").val(),
				quOrg : $("#quOrg").val(),
				ZuOrg : $("#ZuOrg").val(),
				createTimeEnd : $("#createTimeEnd").val()
			}
		}).trigger("reloadGrid");
	}
	
	/* 清空 */
	aihome.cleanQuery = function () {
		$("#custSourceForm")[0].reset()
	}
	
	/* 模糊搜索*/
	$("#userName").autocomplete({
		source : function(request, response) {
			$.ajax({
				url : "${CTX}/customerManage/getUserName.do",
				dataType : "json",
				type : 'post',
				data : {
					matchStr : request.term
				},
				success : function(data) {
					var array = new Array(data.length);
					for (var i = 0; i < data.length; i++) {
						var temp = {
							key : data[i].id,
							value : data[i].userName
						};
						array[i] = temp;
					}
					response(array);
				}
			});
		},
		select : function(event, ui) {
			$("#id").val(ui.item.key);
			$("#userName").val(ui.item.value);
			event.preventDefault();
		}
	});
	
	//业主来源change
	$("#parentSource").change(function(){ 
		$("#childSource").empty();//每次重新选择父类时清空一下子类
		$("#childSource").append("<option value=''>请选择</option>");
		var parentId = $("#parentSource option:selected").val();
		$.ajax({
			url: "${CTX}/customerSource/getSourcesByParentId.do",
			data:{
				parentId:parentId
			},
			type:"post",
			dataType:"json",
			success:function(data){
				var html = "";
				if(data.length>0){
					for(var i=0;i<data.length;i++){
						html += "<option value='"+data[i].id+"'>"+data[i].source+"</option>";
					}
				}
				$("#childSource").append(html);
			}
		});
	});
	
	/* 切換table */
	aihome.switchTable = function () {
		var demandType = $("#demandType").val();
		var propertyType = $("#propertyType").val();
		$("#needCallBack").prop('checked',false);
		$("#notTimeCallBack").prop('checked',false);
		
		if(demandType==2 && propertyType==2){
			jQuery('#jqGrid').GridUnload();//卸载Grid再进行重绘  
			$("#jqGrid").jqGrid(
						{
							height : $(window).height() - 215,
							multiselect : true,
							multiboxonly : true,
							viewrecords : true,
							rownumbers : true,
							autowidth : true,
							autoheight : true,
							async : false,
							url : "${CTX}/customerSource/getCustomerSourcePage.do",
							postData : {
								demandType :demandType,
								propertyType :propertyType
							},
							datatype : "json",
							colNames : [ '评价', '客户姓名 客源编号', '电话',
									'带看次数 带看时间', '客户状态', '承受价位 租期',
									'需求面积（m&sup2;） ',  '紧急程度',
									'看房时间', '意向小区', '租赁方式', '备注','录入时间 最后跟进时间', '所属组 所属人' ,
									'用户名','录入时间','最后跟进时间','承受价位','租期','所属组','所属人','带看次数','带看时间',
									'客源编号','是否被保护','customerId','orgName'],
							colModel : [       
							                 
										{name : 'custJudgeStr',sortable : false,width : 2,align : 'center'}, 
										{name : 'Modify1',sortable : false,width : 5,align : 'center'}, 
						            	{
										  name : 'tell',sortable : false,width : 2,align : 'center',
										  formatter : function(cellvalue,
												options, rowObject) {
											var id = rowObject.id;
											return "<a onclick='aihome.userCheckInfoFun(this)' demandType='2' demandId = '"+id+"' style='text-decoration:underline;color:blue'> 查看 </a>";
											}
										},     
										{name : 'Modify5',sortable : false,width : 5,align : 'center'}, 
										{name : 'demandStatusStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'Modify3',sortable : false,width : 5,align : 'center'}, 
										{name : 'buildArea',sortable : false,width : 4,align : 'center'}, 
										{name : 'demandUrgentStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'takeLookTimeStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'demandPremises',sortable : false,width : 3,align : 'center'}, 
										{name : 'joinRentStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'remark',sortable : false,width : 5,align : 'center'}, 
										{name : 'Modify2',sortable : false,width : 5,align : 'center'}, 
										{name : 'Modify4',sortable : false,width : 5,align : 'center'}, 
										{ name: 'userName', index: 'userName', hidden: true},
										{ name: 'createTimeStr', index: 'createTimeStr', hidden: true},
										{ name: 'operateTimeStr', index: 'operateTimeStr', hidden: true},
										{ name: 'affordPrice', index: 'affordPrice', hidden: true},
										{ name: 'rentTime', index: 'rentTime', hidden: true},
										{ name: 'operateOrg', index: 'operateOrg', hidden: true},
										{ name: 'operateUser', index: 'operateUser', hidden: true},
										{ name: 'isPromised', index: 'isPromise', hidden: true},
										{ name: 'takeDateStr', index: 'takeDateStr', hidden: true},
										{ name: 'isProtected', index: 'rooms', hidden: true},
										{ name: 'orgName', index: 'orgName', hidden: true},
										{ name: 'customerId', index: 'customerId', hidden: true},
										{ name: 'demandCode', index: 'demandCode', hidden: true}
										],
										gridComplete: function () {
											var ids = $("#jqGrid").jqGrid("getDataIDs");
											for (var i = 0; i < ids.length; i++) {
												var id = ids[i];
												var rowData = $("#jqGrid").jqGrid('getRowData',id);
												var isProtected = (rowData.isProtected)==1?"<i   class='iconfont' style='color:red;cursor:pointer;'>&#xe726;</i>":'';
												var modify1 = isProtected+rowData.userName +"<br/><div><a onclick='aihome.showDetails("+id+");' style='text-decoration:underline;color:blue'>"+rowData.demandCode + "</a></div>";
												var modify2 = rowData.createTimeStr+"<br/>"+rowData.operateTimeStr;
												var modify3 = rowData.affordPrice+"元/月<br/>"+rowData.rentTime+"个月";
												var modify4 = rowData.orgName+"<br/>"+rowData.operateUser;
												var modify5 = rowData.isPromised+"<br/>"+rowData.takeDateStr;
												$("#jqGrid").jqGrid("setRowData", id, { Modify1: modify1 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify2: modify2 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify3: modify3 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify4: modify4 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify5: modify5 });
												
											}
										},
							rowNum : 30,
							rowList : [ 10, 20, 30, 50, 100 ],
							pager : "#jqGridPager",
							jsonReader : {
								root : 'pagerResults',
								page : 'currentPage',
								rows : 'rowCount',
								total : 'pageCount',
								records : 'totalCount',
								repeatitems : false
							}
						});
		}
		if(demandType==2 && propertyType==3){
			jQuery('#jqGrid').GridUnload();//卸载Grid再进行重绘  
			$("#jqGrid").jqGrid(
						{
							height : $(window).height() - 215,
							multiselect : true,
							multiboxonly : true,
							viewrecords : true,
							rownumbers : true,
							autowidth : true,
							autoheight : true,
							async : false,
							url : "${CTX}/customerSource/getCustomerSourcePage.do",
							postData : {
								demandType :demandType,
								propertyType :propertyType
							},
							datatype : "json",
							colNames : [ '评价', '客户姓名 客源编号', '电话',
											'带看次数 带看时间', '客户状态', '承受价位 租期',
											'需求面积（m&sup2;） ', '紧急程度',
											'看房时间', '意向小区', '租赁方式', '备注','录入时间 最后跟进时间', '所属组 所属人' ,
											'用户名','录入时间','最后跟进时间','承受价位','租期','所属组','所属人','带看次数','带看时间',
											'客源编号','是否被保护' ,'customerId','orgName'],
							colModel : [       
										{name : 'custJudgeStr',sortable : false,width : 2,align : 'center'}, 
										{name : 'Modify1',sortable : false,width : 5,align : 'center'}, 
						            	{
										  name : 'tell',sortable : false,width : 2,align : 'center',
										  formatter : function(cellvalue,
												options, rowObject) {
											var id = rowObject.id;
											return "<a onclick='aihome.userCheckInfoFun(this)' demandType='2' demandId = '"+id+"' style='text-decoration:underline;color:blue'> 查看 </a>";
											}
										},   
										{name : 'Modify5',sortable : false,width : 5,align : 'center'}, 
										{name : 'demandStatusStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'Modify3',sortable : false,width : 5,align : 'center'}, 
										{name : 'buildArea',sortable : false,width : 4,align : 'center'}, 
										{name : 'demandUrgentStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'takeLookTimeStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'demandPremises',sortable : false,width : 3,align : 'center'}, 
										{name : 'joinRentStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'remark',sortable : false,width : 5,align : 'center'}, 
										{name : 'Modify2',sortable : false,width : 5,align : 'center'}, 
										{name : 'Modify4',sortable : false,width : 5,align : 'center'}, 
										{ name: 'userName', index: 'userName', hidden: true},
										{ name: 'createTimeStr', index: 'createTimeStr', hidden: true},
										{ name: 'operateTimeStr', index: 'operateTimeStr', hidden: true},
										{ name: 'affordPrice', index: 'affordPrice', hidden: true},
										{ name: 'rentTime', index: 'rentTime', hidden: true},
										{ name: 'operateOrg', index: 'operateOrg', hidden: true},
										{ name: 'operateUser', index: 'operateUser', hidden: true},
										{ name: 'isPromised', index: 'isPromise', hidden: true},
										{ name: 'takeDateStr', index: 'takeDateStr', hidden: true},
										{ name: 'isProtected', index: 'rooms', hidden: true},
										{ name: 'orgName', index: 'orgName', hidden: true},
										{ name: 'customerId', index: 'customerId', hidden: true},
										{ name: 'demandCode', index: 'demandCode', hidden: true}
										],
										gridComplete: function () {
											var ids = $("#jqGrid").jqGrid("getDataIDs");
											for (var i = 0; i < ids.length; i++) {
												var id = ids[i];
												var rowData = $("#jqGrid").jqGrid('getRowData',id);
												var isProtected = (rowData.isProtected)==1?"<i   class='iconfont' style='color:red;cursor:pointer;'>&#xe726;</i>":'';
												var modify1 = isProtected+rowData.userName +"<br/><div><a onclick='aihome.showDetails("+id+");' style='text-decoration:underline;color:blue'>"+rowData.demandCode + "</a></div>";
												var modify2 = rowData.createTimeStr+"<br/>"+rowData.operateTimeStr;
												var modify3 = rowData.affordPrice+"元/月<br/>"+rowData.rentTime+"个月";
												var modify4 = rowData.orgName+"<br/>"+rowData.operateUser;
												var modify5 = rowData.isPromised+"<br/>"+rowData.takeDateStr;
												$("#jqGrid").jqGrid("setRowData", id, { Modify1: modify1 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify2: modify2 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify3: modify3 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify4: modify4 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify5: modify5 });
												
											}
										},
							rowNum : 30,
							rowList : [ 10, 20, 30, 50, 100 ],
							pager : "#jqGridPager",
							jsonReader : {
								root : 'pagerResults',
								page : 'currentPage',
								rows : 'rowCount',
								total : 'pageCount',
								records : 'totalCount',
								repeatitems : false
							}
						});
		}
		if(demandType==2 && propertyType==4){
			jQuery('#jqGrid').GridUnload();//卸载Grid再进行重绘  
			$("#jqGrid").jqGrid(
						{
							height : $(window).height() - 215,
							multiselect : true,
							multiboxonly : true,
							viewrecords : true,
							rownumbers : true,
							autowidth : true,
							autoheight : true,
							async : false,
							url : "${CTX}/customerSource/getCustomerSourcePage.do",
							postData : {
								demandType :demandType,
								propertyType :propertyType
							},
							datatype : "json",
							colNames : [ '评价', '客户姓名 客源编号', '电话',
											'带看次数 带看时间', '客户状态', '承受价位 租期', '紧急程度',
											'看房时间', '意向小区', '租赁方式', '备注','录入时间 最后跟进时间', '所属组 所属人' ,
											'用户名','录入时间','最后跟进时间','承受价位','租期','所属组','所属人','带看次数','带看时间',
											'客源编号','是否被保护','customerId','orgName'],
							colModel : [       
										{name : 'custJudgeStr',sortable : false,width : 2,align : 'center'}, 
										{name : 'Modify1',sortable : false,width : 5,align : 'center'}, 
						            	{
										  name : 'tell',sortable : false,width : 2,align : 'center',
										  formatter : function(cellvalue,
												options, rowObject) {
											var id = rowObject.id;
											return "<a onclick='aihome.userCheckInfoFun(this)' demandType='2' demandId = '"+id+"' style='text-decoration:underline;color:blue'> 查看 </a>";
											}
										},    
										{name : 'Modify5',sortable : false,width : 5,align : 'center'}, 
										{name : 'demandStatusStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'Modify3',sortable : false,width : 5,align : 'center'}, 
										{name : 'demandUrgentStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'takeLookTimeStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'demandPremises',sortable : false,width : 3,align : 'center'}, 
										{name : 'joinRentStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'remark',sortable : false,width : 5,align : 'center'}, 
										{name : 'Modify2',sortable : false,width : 5,align : 'center'}, 
										{name : 'Modify4',sortable : false,width : 5,align : 'center'}, 
										{ name: 'userName', index: 'userName', hidden: true},
										{ name: 'createTimeStr', index: 'createTimeStr', hidden: true},
										{ name: 'operateTimeStr', index: 'operateTimeStr', hidden: true},
										{ name: 'affordPrice', index: 'affordPrice', hidden: true},
										{ name: 'rentTime', index: 'rentTime', hidden: true},
										{ name: 'operateOrg', index: 'operateOrg', hidden: true},
										{ name: 'operateUser', index: 'operateUser', hidden: true},
										{ name: 'isPromised', index: 'isPromise', hidden: true},
										{ name: 'takeDateStr', index: 'takeDateStr', hidden: true},
										{ name: 'isProtected', index: 'rooms', hidden: true},
										{ name: 'orgName', index: 'orgName', hidden: true},
										{ name: 'customerId', index: 'customerId', hidden: true},
										{ name: 'demandCode', index: 'demandCode', hidden: true}
										],
										gridComplete: function () {
											var ids = $("#jqGrid").jqGrid("getDataIDs");
											for (var i = 0; i < ids.length; i++) {
												var id = ids[i];
												var rowData = $("#jqGrid").jqGrid('getRowData',id);
												var isProtected = (rowData.isProtected)==1?"<i   class='iconfont' style='color:red;cursor:pointer;'>&#xe726;</i>":'';
												var modify1 = isProtected+rowData.userName +"<br/><div><a onclick='aihome.showDetails("+id+");' style='text-decoration:underline;color:blue'>"+rowData.demandCode + "</a></div>";
												var modify2 = rowData.createTimeStr+"<br/>"+rowData.operateTimeStr;
												var modify3 = rowData.affordPrice+"元/月<br/>"+rowData.rentTime+"个月";
												var modify4 = rowData.orgName+"<br/>"+rowData.operateUser;
												var modify5 = rowData.isPromised+"<br/>"+rowData.takeDateStr;
												$("#jqGrid").jqGrid("setRowData", id, { Modify1: modify1 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify2: modify2 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify3: modify3 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify4: modify4 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify5: modify5 });
												
											}
										},		
							rowNum : 30,
							rowList : [ 10, 20, 30, 50, 100 ],
							pager : "#jqGridPager",
							jsonReader : {
								root : 'pagerResults',
								page : 'currentPage',
								rows : 'rowCount',
								total : 'pageCount',
								records : 'totalCount',
								repeatitems : false
							}
						});
		}
		if(demandType==2 && propertyType==1){
			jQuery('#jqGrid').GridUnload();//卸载Grid再进行重绘  
			aihome.custSourceInit();
		}
		if(demandType==1 && propertyType==1){
			jQuery('#jqGrid').GridUnload();//卸载Grid再进行重绘  
			$("#jqGrid").jqGrid(
						{
							height : $(window).height() - 215,
							multiselect : true,
							multiboxonly : true,
							viewrecords : true,
							rownumbers : true,
							autowidth : true,
							autoheight : true,
							async : false,
							url : "${CTX}/customerSource/getCustomerSourcePage.do",
							postData : {
								demandType :demandType,
								propertyType :propertyType
							},
							datatype : "json",
							colNames : [ '评价', '客户姓名 客源编号', '电话',
											'带看次数 带看时间', '客户状态', '承受价位 首付款',
											'需求面积（m&sup2;） ','需求户型', '楼层', '紧急程度',
											'看房时间', '意向小区', '购房动机','录入时间 最后跟进时间', '所属组 所属人' ,
											'用户名','录入时间','最后跟进时间','承受价位','首付','租期','所属组','所属人','带看次数','带看时间',
											'客源编号','室','厅','楼层要求start','楼层要求end','是否被保护','customerId','orgName'],
							colModel : [       
										{name : 'custJudgeStr',sortable : false,width : 1,align : 'center'}, 
										{name : 'Modify1',sortable : false,width : 4,align : 'center'}, 
						            	{
										  name : 'tell',sortable : false,width : 2,align : 'center',
										  formatter : function(cellvalue,
												options, rowObject) {
											var id = rowObject.id;
											return "<a onclick='aihome.userCheckInfoFun(this)' demandType='1' demandId = '"+id+"' style='text-decoration:underline;color:blue'> 查看 </a>";
											}
										},   
										{name : 'Modify5',sortable : false,width : 4,align : 'center'}, 
										{name : 'demandStatusStr',sortable : false,width : 2,align : 'center'}, 
										{name : 'Modify3',sortable : false,width : 3,align : 'center'}, 
										{name : 'buildArea',sortable : false,width : 3,align : 'center'}, 
										{name : 'Modify6',sortable : false,width : 3,align : 'center'}, 
										{name : 'Modify7',sortable : false,width : 3,align : 'center'}, 
										{name : 'demandUrgentStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'takeLookTimeStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'demandPremises',sortable : false,width : 4,align : 'center'}, 
										{name : 'buyMotivationStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'Modify2',sortable : false,width : 4,align : 'center'}, 
										{name : 'Modify4',sortable : false,width : 3,align : 'center'}, 
										{ name: 'userName', index: 'userName', hidden: true},
										{ name: 'createTimeStr', index: 'createTimeStr', hidden: true},
										{ name: 'operateTimeStr', index: 'operateTimeStr', hidden: true},
										{ name: 'affordPrice', index: 'affordPrice', hidden: true},
										{ name: 'firstPay', index: 'firstPay', hidden: true},
										{ name: 'rentTime', index: 'rentTime', hidden: true},
										{ name: 'operateOrg', index: 'operateOrg', hidden: true},
										{ name: 'operateUser', index: 'operateUser', hidden: true},
										{ name: 'isPromised', index: 'isPromise', hidden: true},
										{ name: 'takeDateStr', index: 'takeDateStr', hidden: true},
										{ name: 'demandCode', index: 'demandCode', hidden: true},
										{ name: 'rooms', index: 'rooms', hidden: true},
										{ name: 'office', index: 'office', hidden: true},
										{ name: 'needFloorStart', needFloorStart: 'rooms', hidden: true},
										{ name: 'isProtected', index: 'rooms', hidden: true},
										{ name: 'orgName', index: 'orgName', hidden: true},
										{ name: 'customerId', index: 'customerId', hidden: true},
										{ name: 'needFloorEnd', index: 'needFloorEnd', hidden: true}
										],
										gridComplete: function () {
											var ids = $("#jqGrid").jqGrid("getDataIDs");
											for (var i = 0; i < ids.length; i++) {
												var id = ids[i];
												var rowData = $("#jqGrid").jqGrid('getRowData',id);
												var isProtected = (rowData.isProtected)==1?"<i   class='iconfont' style='color:red;cursor:pointer;'>&#xe726;</i>":'';
												var modify1 = isProtected+rowData.userName +"<br/><div><a onclick='aihome.showDetails("+id+");' style='text-decoration:underline;color:blue'>"+rowData.demandCode + "</a></div>";
												var modify2 = rowData.createTimeStr+"<br/>"+rowData.operateTimeStr;
												var modify3 = rowData.affordPrice+"万<br/>"+rowData.firstPay+"万<br/>";
												var modify4 = rowData.orgName+"<br/>"+rowData.operateUser;
												var modify5 = rowData.isPromised+"<br/>"+rowData.takeDateStr;
												var modify6 = rowData.rooms+"室"+rowData.office+"厅";
												var modify7 = rowData.needFloorStart+"~"+rowData.needFloorEnd+"层";
												$("#jqGrid").jqGrid("setRowData", id, { Modify1: modify1 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify2: modify2 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify3: modify3 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify4: modify4 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify5: modify5 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify6: modify6 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify7: modify7 });
												
											}
										},
							rowNum : 30,
							rowList : [ 10, 20, 30, 50, 100 ],
							pager : "#jqGridPager",
							jsonReader : {
								root : 'pagerResults',
								page : 'currentPage',
								rows : 'rowCount',
								total : 'pageCount',
								records : 'totalCount',
								repeatitems : false
							}
						});
		}
		if(demandType==1 && propertyType==2){
			jQuery('#jqGrid').GridUnload();//卸载Grid再进行重绘  
			$("#jqGrid").jqGrid(
						{
							height : $(window).height() - 215,
							multiselect : true,
							multiboxonly : true,
							viewrecords : true,
							rownumbers : true,
							autowidth : true,
							autoheight : true,
							async : false,
							url : "${CTX}/customerSource/getCustomerSourcePage.do",
							postData : {
								demandType :demandType,
								propertyType :propertyType
							},
							datatype : "json",
							colNames : [ '评价', '客户姓名 客源编号', '电话','带看次数 带看时间', '客户状态',
											 '承受价位 首付款','需求面积（m&sup2;） ', '紧急程度','看房时间', '意向小区', 
											 '备注','录入时间 最后跟进时间', '所属组 所属人' ,'用户名','录入时间','最后跟进时间',
											'承受价位','首付','租期','所属组','所属人','带看次数','带看时间','客源编号','是否被保护','customerId','orgName'],
							colModel : [       
										{name : 'custJudgeStr',sortable : false,width : 2,align : 'center'}, 
										{name : 'Modify1',sortable : false,width : 5,align : 'center'}, 
						            	{
										  name : 'tell',sortable : false,width : 2,align : 'center',
										  formatter : function(cellvalue,
												options, rowObject) {
											var id = rowObject.id;
											return "<a onclick='aihome.userCheckInfoFun(this)' demandType='1' demandId = '"+id+"' style='text-decoration:underline;color:blue'> 查看 </a>";
											}
										},   
										{name : 'Modify5',sortable : false,width : 5,align : 'center'}, 
										{name : 'demandStatusStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'Modify3',sortable : false,width : 5,align : 'center'}, 
										{name : 'buildArea',sortable : false,width : 3,align : 'center'}, 
										{name : 'demandUrgentStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'takeLookTimeStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'demandPremises',sortable : false,width : 3,align : 'center'}, 
										{name : 'remark',sortable : false,width : 5,align : 'center'}, 
										{name : 'Modify2',sortable : false,width : 5,align : 'center'}, 
										{name : 'Modify4',sortable : false,width : 5,align : 'center'}, 
										{ name: 'userName', index: 'userName', hidden: true},
										{ name: 'createTimeStr', index: 'createTimeStr', hidden: true},
										{ name: 'operateTimeStr', index: 'operateTimeStr', hidden: true},
										{ name: 'affordPrice', index: 'affordPrice', hidden: true},
										{ name: 'firstPay', index: 'firstPay', hidden: true},
										{ name: 'rentTime', index: 'rentTime', hidden: true},
										{ name: 'operateOrg', index: 'operateOrg', hidden: true},
										{ name: 'operateUser', index: 'operateUser', hidden: true},
										{ name: 'isPromised', index: 'isPromise', hidden: true},
										{ name: 'takeDateStr', index: 'takeDateStr', hidden: true},
										{ name: 'isProtected', index: 'rooms', hidden: true},
										{ name: 'orgName', index: 'orgName', hidden: true},
										{ name: 'customerId', index: 'customerId', hidden: true},
										{ name: 'demandCode', index: 'demandCode', hidden: true}
										],
										gridComplete: function () {
											var ids = $("#jqGrid").jqGrid("getDataIDs");
											for (var i = 0; i < ids.length; i++) {
												var id = ids[i];
												var rowData = $("#jqGrid").jqGrid('getRowData',id);
												var isProtected = (rowData.isProtected)==1?"<i   class='iconfont' style='color:red;cursor:pointer;'>&#xe726;</i>":'';
												var modify1 = isProtected+rowData.userName +"<br/><div><a onclick='aihome.showDetails("+id+");' style='text-decoration:underline;color:blue'>"+rowData.demandCode + "</a></div>";
												var modify2 = rowData.createTimeStr+"<br/>"+rowData.operateTimeStr;
												var modify3 = rowData.affordPrice+"万<br/>"+rowData.firstPay+"万<br/>";
												var modify4 = rowData.orgName+"<br/>"+rowData.operateUser;
												var modify5 = rowData.isPromised+"<br/>"+rowData.takeDateStr;
												$("#jqGrid").jqGrid("setRowData", id, { Modify1: modify1 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify2: modify2 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify3: modify3 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify4: modify4 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify5: modify5 });
												
											}
										},
							rowNum : 30,
							rowList : [ 10, 20, 30, 50, 100 ],
							pager : "#jqGridPager",
							jsonReader : {
								root : 'pagerResults',
								page : 'currentPage',
								rows : 'rowCount',
								total : 'pageCount',
								records : 'totalCount',
								repeatitems : false
							}
						});
		}
		if(demandType==1 && propertyType==3){
			jQuery('#jqGrid').GridUnload();//卸载Grid再进行重绘  
			$("#jqGrid").jqGrid(
						{
							height : $(window).height() - 215,
							multiselect : true,
							multiboxonly : true,
							viewrecords : true,
							rownumbers : true,
							autowidth : true,
							autoheight : true,
							async : false,
							url : "${CTX}/customerSource/getCustomerSourcePage.do",
							postData : {
								demandType :demandType,
								propertyType :propertyType
							},
							datatype : "json",
							colNames : [ '评价', '客户姓名 客源编号', '电话',
											'带看次数 带看时间', '客户状态', '承受价位 首付款',
											'需求面积（m&sup2;） ', '紧急程度','看房时间', '意向小区', '备注',
											'录入时间 最后跟进时间', '所属组 所属人' ,'用户名','录入时间','最后跟进时间',
											'承受价位','首付','租期','所属组','所属人','带看次数','带看时间','客源编号','是否被保护','customerId','orgName'],
							colModel : [       
										{name : 'custJudgeStr',sortable : false,width : 2,align : 'center'}, 
										{name : 'Modify1',sortable : false,width : 5,align : 'center'}, 
						            	{
										  name : 'tell',sortable : false,width : 2,align : 'center',
										  formatter : function(cellvalue,
												options, rowObject) {
											var id = rowObject.id;
											return "<a onclick='aihome.userCheckInfoFun(this)' demandType='1' demandId = '"+id+"' style='text-decoration:underline;color:blue'> 查看 </a>";
											}
										},   
										{name : 'Modify5',sortable : false,width : 5,align : 'center'}, 
										{name : 'demandStatusStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'Modify3',sortable : false,width : 5,align : 'center'}, 
										{name : 'buildArea',sortable : false,width : 4,align : 'center'}, 
										{name : 'demandUrgentStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'takeLookTimeStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'demandPremises',sortable : false,width : 3,align : 'center'}, 
										{name : 'remark',sortable : false,width : 5,align : 'center'}, 
										{name : 'Modify2',sortable : false,width : 5,align : 'center'}, 
										{name : 'Modify4',sortable : false,width : 5,align : 'center'}, 
										{ name: 'userName', index: 'userName', hidden: true},
										{ name: 'createTimeStr', index: 'createTimeStr', hidden: true},
										{ name: 'operateTimeStr', index: 'operateTimeStr', hidden: true},
										{ name: 'affordPrice', index: 'affordPrice', hidden: true},
										{ name: 'firstPay', index: 'firstPay', hidden: true},
										{ name: 'rentTime', index: 'rentTime', hidden: true},
										{ name: 'operateOrg', index: 'operateOrg', hidden: true},
										{ name: 'operateUser', index: 'operateUser', hidden: true},
										{ name: 'isPromised', index: 'isPromise', hidden: true},
										{ name: 'takeDateStr', index: 'takeDateStr', hidden: true},
										{ name: 'isProtected', index: 'rooms', hidden: true},
										{ name: 'orgName', index: 'orgName', hidden: true},
										{ name: 'customerId', index: 'customerId', hidden: true},
										{ name: 'demandCode', index: 'demandCode', hidden: true}
										],
										gridComplete: function () {
											var ids = $("#jqGrid").jqGrid("getDataIDs");
											for (var i = 0; i < ids.length; i++) {
												var id = ids[i];
												var rowData = $("#jqGrid").jqGrid('getRowData',id);
												var isProtected = (rowData.isProtected)==1?"<i   class='iconfont' style='color:red;cursor:pointer;'>&#xe726;</i>":'';
												var modify1 = isProtected+rowData.userName +"<br/><div><a onclick='aihome.showDetails("+id+");' style='text-decoration:underline;color:blue'>"+rowData.demandCode + "</a></div>";
												var modify2 = rowData.createTimeStr+"<br/>"+rowData.operateTimeStr;
												var modify3 = rowData.affordPrice+"万<br/>"+rowData.firstPay+"万<br/>";
												var modify4 = rowData.orgName+"<br/>"+rowData.operateUser;
												var modify5 = rowData.isPromised+"<br/>"+rowData.takeDateStr;
												$("#jqGrid").jqGrid("setRowData", id, { Modify1: modify1 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify2: modify2 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify3: modify3 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify4: modify4 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify5: modify5 });
												
											}
										},
							rowNum : 30,
							rowList : [ 10, 20, 30, 50, 100 ],
							pager : "#jqGridPager",
							jsonReader : {
								root : 'pagerResults',
								page : 'currentPage',
								rows : 'rowCount',
								total : 'pageCount',
								records : 'totalCount',
								repeatitems : false
							}
						});
		}
		if(demandType==1 && propertyType==4){
			jQuery('#jqGrid').GridUnload();//卸载Grid再进行重绘  
			$("#jqGrid").jqGrid(
						{
							height : $(window).height() - 215,
							multiselect : true,
							multiboxonly : true,
							viewrecords : true,
							rownumbers : true,
							autowidth : true,
							autoheight : true,
							async : false,
							url : "${CTX}/customerSource/getCustomerSourcePage.do",
							postData : {
								demandType :demandType,
								propertyType :propertyType
							},
							datatype : "json",
							colNames : [ '评价', '客户姓名 客源编号', '电话',
											'带看次数 带看时间', '客户状态', '承受价位 首付款','紧急程度','看房时间', '意向小区',
											'备注','录入时间 最后跟进时间', '所属组 所属人' ,'用户名','录入时间',
											'最后跟进时间','承受价位','首付','租期','所属组','所属人','带看次数','带看时间','客源编号','是否被保护','customerId','orgName'],
							colModel : [       
										{name : 'custJudgeStr',sortable : false,width : 2,align : 'center'}, 
										{name : 'Modify1',sortable : false,width : 5,align : 'center'}, 
						            	{
										  name : 'tell',sortable : false,width : 2,align : 'center',
										  formatter : function(cellvalue,
												options, rowObject) {
											var id = rowObject.id;
											return "<a onclick='aihome.userCheckInfoFun(this)' demandType='1' demandId = '"+id+"' style='text-decoration:underline;color:blue'> 查看 </a>";
											}
										},   
										{name : 'Modify5',sortable : false,width : 5,align : 'center'}, 
										{name : 'demandStatusStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'Modify3',sortable : false,width : 5,align : 'center'}, 
										{name : 'demandUrgentStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'takeLookTimeStr',sortable : false,width : 3,align : 'center'}, 
										{name : 'demandPremises',sortable : false,width : 3,align : 'center'}, 
										{name : 'remark',sortable : false,width : 5,align : 'center'}, 
										{name : 'Modify2',sortable : false,width : 5,align : 'center'}, 
										{name : 'Modify4',sortable : false,width : 5,align : 'center'}, 
										{ name: 'userName', index: 'userName', hidden: true},
										{ name: 'createTimeStr', index: 'createTimeStr', hidden: true},
										{ name: 'operateTimeStr', index: 'operateTimeStr', hidden: true},
										{ name: 'affordPrice', index: 'affordPrice', hidden: true},
										{ name: 'firstPay', index: 'firstPay', hidden: true},
										{ name: 'rentTime', index: 'rentTime', hidden: true},
										{ name: 'operateOrg', index: 'operateOrg', hidden: true},
										{ name: 'operateUser', index: 'operateUser', hidden: true},
										{ name: 'isPromised', index: 'isPromise', hidden: true},
										{ name: 'takeDateStr', index: 'takeDateStr', hidden: true},
										{ name: 'isProtected', index: 'rooms', hidden: true},
										{ name: 'orgName', index: 'orgName', hidden: true},
										{ name: 'customerId', index: 'customerId', hidden: true},
										{ name: 'demandCode', index: 'demandCode', hidden: true}
										],
										gridComplete: function () {
											var ids = $("#jqGrid").jqGrid("getDataIDs");
											for (var i = 0; i < ids.length; i++) {
												var id = ids[i];
												var rowData = $("#jqGrid").jqGrid('getRowData',id);
												var isProtected = (rowData.isProtected)==1?"<i   class='iconfont' style='color:red;cursor:pointer;'>&#xe726;</i>":'';
												var modify1 = isProtected+rowData.userName +"<br/><div><a onclick='aihome.showDetails("+id+");' style='text-decoration:underline;color:blue'>"+rowData.demandCode + "</a></div>";
												var modify2 = rowData.createTimeStr+"<br/>"+rowData.operateTimeStr;
												var modify3 = rowData.affordPrice+"万<br/>"+rowData.firstPay+"万<br/>";
												var modify4 = rowData.orgName+"<br/>"+rowData.operateUser;
												var modify5 = rowData.isPromised+"<br/>"+rowData.takeDateStr;
												$("#jqGrid").jqGrid("setRowData", id, { Modify1: modify1 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify2: modify2 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify3: modify3 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify4: modify4 });
												$("#jqGrid").jqGrid("setRowData", id, { Modify5: modify5 });
												
											}
										},	
							rowNum : 30,
							rowList : [ 10, 20, 30, 50, 100 ],
							pager : "#jqGridPager",
							jsonReader : {
								root : 'pagerResults',
								page : 'currentPage',
								rows : 'rowCount',
								total : 'pageCount',
								records : 'totalCount',
								repeatitems : false
							}
						});
		}
		
	}
	
	/* 客源详情 */
	aihome.showDetails = function(id,lastPage) {		
		$("#jqGrid").trigger('reloadGrid');
		$("#jqGrid").jqGrid('setSelection',id);
		oaDialogOpen("customerSourceDetail",//对话框ID，必填，且不能与当前页面的ID重复
			{
		url : "${CTX}/customerSource/customerSourceDetail.do?id="+id+"&lastPage="+lastPage,//调用页面的url
		title : "客源详情",//弹框的title
		closeOnEscpe : true,//是否通过escpe关闭弹框
		closeBtn : true,//是否显示关闭按钮
		width: 900,//弹框的宽度
		height: $(window).height()*0.9,
		buttons : {
			"取消" : function() {
				$(this).dialog("close");
			}
		}
	});
	}
	
	/* 转成交客户池 */
	aihome.toDealCustomerPool = function (){	
		var rowIds = $("#jqGrid").jqGrid('getGridParam','selarrrow');
		
		var selCount=rowIds.length;
		if (selCount == 0){
			alert("没有选中的客源！");
			return null;
		}
		if (selCount > 1){
			alert("请只选择一个客源！");
			return null;
		}
		
		var isDealed = '';
		$.ajax({
			url : "${CTX}/customerSource/getDealedByDemandId.do",
			dataType : "json",
			async : false,
			type : 'post',
			data : {
				demandId : rowIds
			},
			success : function(data) {
				isDealed = data;
			}
		});
		
		if(isDealed == 4){
			alert("该客源已在成交客户池中，不可以重复提交！");
			return
		}
		
		oaDialogOpen("dealCustomerPool",//对话框ID，必填，且不能与当前页面的ID重复
				{
					url : "${CTX}/customerSource/dealCustomerPoolIndex.do" ,//调用页面的url
					title : "转入原因",//弹框的title
					closeOnEscpe : true,//是否通过escpe关闭弹框
					closeBtn : true,//是否显示关闭按钮
					width : 450,//弹框的宽度
					height : 400,
					buttons : {
						"保存" : function() {
							aihome.saveDealCustomerPool(rowIds);
							$(this).dialog("close");
							$("#jqGrid").trigger('reloadGrid');
						},
						"取消" : function() {
							$(this).dialog("close");
						}
					}
				});
	}
	
	/* 设置为保护客源 */
	aihome.setProtectedCust = function (){	
		var rowIds = $("#jqGrid").jqGrid('getGridParam','selarrrow');
		
		var selCount=rowIds.length;
		if (selCount == 0){
			alert("没有选中的客源！");
			return null;
		}
		if (selCount > 1){
			alert("请只选择一个客源！");
			return null;
		}
		
		var isprotected = '';
		$.ajax({
			url : "${CTX}/customerSource/getProtectedByDemandId.do",
			dataType : "json",
			async : false,
			type : 'post',
			data : {
				demandId : rowIds
			},
			success : function(data) {
				isprotected = data;
			}
		});
		
		if(isprotected == 1){
			alert("该客源已被保护，不可以重复保护！");
			return
		}
		
		if(confirm("确认要保护该客源吗？")){
			$.ajax({
				url : "${CTX}/customerSource/setProtectedCust.do",
				dataType : "json",
				type : 'post',
				data : {
					rowIds : rowIds
				},
				success : function(data) {
					alert("成功保护该客源！");
					$("#jqGrid").trigger('reloadGrid');
				}
			});
		}
	}
	
	/* 取消保护该客源 */
	aihome.cancelProtectedCust = function (){	
		var rowIds = $("#jqGrid").jqGrid('getGridParam','selarrrow');
		
		var selCount=rowIds.length;
		if (selCount == 0){
			alert("没有选中的客源！");
			return null;
		}
		
		var isprotected = '';
		$.ajax({
			url : "${CTX}/customerSource/getProtectedByDemandId.do",
			dataType : "json",
			async : false,
			type : 'post',
			data : {
				demandId : rowIds
			},
			success : function(data) {
				isprotected = data;
			}
		});
		
		if(isprotected == 2){
			alert("该客源未被保护，不可以取消保护！");
			return
		}
		
		if(confirm("取消保护该客源吗？")){
			$.ajax({
				url : "${CTX}/customerSource/cancelProtectedCust.do",
				dataType : "json",
				type : 'post',
				data : {
					rowIds : rowIds.join(",")
				},
				success : function(data) {
					alert("成功取消保护该客源！");
					$("#jqGrid").trigger('reloadGrid');
				}
			});
		}
	}
	
	/* 转介 */
	aihome.transferCustomer = function (){	
		var rowIds = $("#jqGrid").jqGrid('getGridParam','selarrrow');
		
		var selCount=rowIds.length;
		if (selCount == 0){
			alert("没有选中的客源！");
			return null;
		}
		if (selCount > 1){
			alert("请只选择一个客源！");
			return null;
		}
		
		var rowData = $("#jqGrid").jqGrid('getRowData',rowIds);
		if(rowData.cdType == '私客'){
		
			var heights = $(window).height() * 0.3;
			var widths = $(window).width() * 0.45;
			oaDialogOpen("transferCustomer",//对话框ID，必填，且不能与当前页面的ID重复
					{
						url : "${CTX}/customerSource/transferCustomer.do",//调用页面的url
						title : "客源转介",//弹框的title
						closeOnEscpe : true,//是否通过escpe关闭弹框
						closeBtn : true,//是否显示关闭按钮
						width : widths,//弹框的宽度
						height : heights,
						buttons : {
							"确定" : function() {
								transferWay = $("[name='transferWay']:checked").val();
								if (transferWay == 1) {
									if(confirm("确认将该客源转入公客池吗？")){
									aihome.saveTransferCustomer(rowIds);
									}
								}else if (transferWay == 2) {
									if(confirm("确认转介该客源吗？")){
										aihome.saveTransferCustomer(rowIds);
										}
									}
								$(this).dialog("close");
							},
							"取消" : function() {
								$(this).dialog("close");
							}
						}
			});
		}else{
			alert("该客源不可以转介！");
		}	
	}
	
	/* 调配 */
	aihome.dispatchCustomerSource = function (){	
		var rowIds = $("#jqGrid").jqGrid('getGridParam','selarrrow');
		
		var selCount=rowIds.length;
		if (selCount == 0){
			alert("没有选中的客源！");
			return null;
		}
		if (selCount > 1){
			alert("请只选择一个客源！");
			return null;
		}
		
			var heights = $(window).height() * 0.25;
			var widths = $(window).width() * 0.35;
			oaDialogOpen("dispatchCustomerSource",//对话框ID，必填，且不能与当前页面的ID重复
					{
						url : "${CTX}/customerSource/dispatchCustomerSource.do",//调用页面的url
						title : "客源调配",//弹框的title
						closeOnEscpe : true,//是否通过escpe关闭弹框
						closeBtn : true,//是否显示关闭按钮
						width : widths,//弹框的宽度
						height : heights,
						buttons : {
							"确定" : function() {
								
								if(confirm("确认调配此客源吗？")){
								aihome.saveDispatchCustSource(rowIds);
								}
									$(this).dialog("close");
								
							},
							"取消" : function() {
								$(this).dialog("close");
							}
						}
			});
	}

	/* 回访 */
	aihome.callBackCustomer = function (){	
		var rowIds = $("#jqGrid").jqGrid('getGridParam','selarrrow');
		
		var selCount=rowIds.length;
		if (selCount == 0){
			alert("没有选中的客源！");
			return null;
		}
		if (selCount > 1){
			alert("请只选择一个客源！");
			return null;
		}
		
		$.ajax({
			url : "${CTX}/customerSource/getTakeLookDoneCount.do",
			dataType : "json",
			type : 'post',
			data : {
				demandId : rowIds
			},
			success : function(data) {
				if(data.COUNT > 0){
					var heights = $(window).height() * 0.9;
					var widths = $(window).width() * 0.7;
					oaDialogOpen("callBackCustomer",//对话框ID，必填，且不能与当前页面的ID重复
							{
								url : "${CTX}/customerSource/callBackCustomer.do?id="+rowIds,//调用页面的url
								title : "客源回访",//弹框的title
								closeOnEscpe : true,//是否通过escpe关闭弹框
								closeBtn : true,//是否显示关闭按钮
								width : widths,//弹框的宽度
								height : heights,
								buttons : {
									"保存" : function() {
										aihome.saveCustCallBack();
										$(this).dialog("close");
										$("#jqGrid").trigger('reloadGrid');
									},
									"取消" : function() {
										$(this).dialog("close");
									}
							}
					});
				}
			},
			error :function(){
				alert("该客源不可以回访！")
				
			}
		});
			
	}
	
	/* 店长需回访客源 */
	aihome.needCallBack = function (){	
		var isCheck = $("#needCallBack").is(':checked');
		$("#jqGrid").setGridParam({
			postData : {
				needCallBack : isCheck
			}
		}).trigger("reloadGrid");
	}
	
	/* 店长未按时回访客源 */
	aihome.notTimeCallBack = function (){	
		var isCheck = $("#notTimeCallBack").is(':checked');
		$("#jqGrid").setGridParam({
			postData : {
				notTimeCallBack : isCheck
			}
		}).trigger("reloadGrid");
	}
	
	/* 显示已经被转介的客源 */
	aihome.haveTransfered = function (){	
		var isCheck = $("#haveTransfered").is(':checked');
		$("#jqGrid").setGridParam({
			postData : {
				haveTransfered : isCheck
			}
		}).trigger("reloadGrid");
	}
	
	/*拉黑*/
	aihome.addBlackList = function() {
		var rowIds = $("#jqGrid").jqGrid('getGridParam', 'selarrrow');
		var selCount = rowIds.length;

		if (selCount == 0) {
			alert("没有选中的联系人！");
			return;
		} else if (selCount > 1) {
			alert("请只选择一个联系人！");
			return;
		}

		var rowData = $("#jqGrid").jqGrid('getRowData',rowIds);
		var customerId = rowData.customerId;
		var url = "${CTX}/customerManage/queryBlackListById.do";

		$.ajax({
			url : url,
			dataType : "json",
			data : {
				rowIds : customerId
			},

			success : function(data) {
				if (data == '1') {
					alert("此联系人已在黑名单中！");
					return;
				}
				oaDialogOpen("toAddBlackList",//对话框ID，必填，且不能与当前页面的ID重复
				{
					url : "${CTX}/customerManage/addBlackList.do?id=" + customerId,//调用页面的url
					title : "拉黑联系人",//弹框的title
					closeOnEscpe : true,//是否通过escpe关闭弹框
					closeBtn : true,//是否显示关闭按钮
					width : 450,//弹框的宽度
					height : 400,
					buttons : {
						"保存" : function() {
							saveBlackList(customerId);
							$(this).dialog("close");
							$("#jqGrid").trigger('reloadGrid');
						},
						"取消" : function() {
							$(this).dialog("close");
						}
					}
				});
			}
		});
	}
	
	aihome.getAddress = function(val, objId) {
		var _url = "${CTX}/org/orgList.do";
		if (objId == "jingjiren") {
			_url = "${CTX}/org/userList.do";
		}
		$.ajax({
			type : "post",
			url : _url,
			async : false,
			dataType : 'json',
			async : false,
			data : {
				"orgCode" : val
			},
			success : function(data) {

				aihome.changeAddress(data, objId);
			},
		});
	}

	aihome.changeAddress = function(data, objId) {
		var obj = $("#" + objId);

		obj.children().first().siblings().remove();
		var str = "";
		for (var i = 0; i < data.length; i++) {
			var orgCode = "";
			if (objId === "jingjiren") {
				orgCode = data[i].userId;
			} else {
				orgCode = data[i].orgCode;
			}
			var name = data[i].name;
			str = '<option value="'+orgCode+'">' + name + '</option>';
			obj.append(str);
		}
	}

	/**组*/
	$("#zuOrg").change(function() {
		var orgCode = $(this).val();
		//组数据变更，下级全部清空
		$("#jingjiren").children().first().siblings().remove();
		aihome.getAddress(orgCode, "jingjiren");
	});
	/**
	 * 区
	 */
	$("#quOrg").change(function() {

		var orgCode = $(this).val();
		//区数据变更，下级全部清空
		$("#zuOrg").children().first().siblings().remove();
		$("#jingjiren").children().first().siblings().remove();
		aihome.getAddress(orgCode, "zuOrg");
	});

	aihome.switchRadio = function() {
		transferWay = $("[name='transferWay']:checked").val();
		if (transferWay == 2) {
			$("#contentHide").show();
		} else {
			$("#contentHide").hide();
		}
	}
	
	/* 显示私客是否被保护 */
	 aihome.showIsProtectedList = function() {
		var isCustProtected = $("#showIsProtectedList").is(':checked');
		
		$("#jqGrid").setGridParam({
			postData : {
				isCustProtected : isCustProtected
			}
		}).trigger("reloadGrid")
	}
	
	$(function() {
		aihome.custSourceInit();
	});
	<#include "../users/users_check.html">
</script>
