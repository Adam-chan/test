<div class="row">
	<div class="row">
		<div class="col-sm-6 widget-container-col ui-sortable"  style="min-height: 259px; padding-left: 32px;" >
			<div class="widget-box ui-sortable-handle" style="opacity: 1; z-index: 0;">
				<div class="widget-header widget-header-small">
					 <h5 class="widget-title  pull-left"><i class="ace-icon fa fa-table"></i>目标考核项配置</h5>
					  <div class="widget-toolbar" >
			              <a href="javaScript:void(0);" onclick="aihome.getSysParameterType(1,1);" >
			                <i class="">新增</i>
			              </a>
			              <a href="javaScript:void(0);" onclick="aihome.getSysParameterType(1,2);">
			                <i class="">修改</i>
			              </a>
			               <a href="javaScript:void(0);" onclick="aihome.getSysParameterType(1,3);"class="orange">
			                <i class="">删除</i>
			              </a>
            		</div>
				</div>
				<div class="widget-body">
					<div class="widget-main no-padding">
				    	<div class="tab-content no-padding">
							<div class="tab-pane active">
			        		<div class="col-xs-12" style="padding: 0;">
			                	<table id="MBKHXTable" class="table table-striped table-bordered table-hover">
				                    <thead>
					                    <tr>
					                        <th class="center">选择</th>
					                        <th>排序</th>
					                        <th>考核项</th>
					                    </tr>
				                    </thead>
				                    <tbody>
				                    	<#list (result.MBKHX)! as item>
					                    <tr class="active">
					                        <td class="center" style="width: 20%">
					                            <label class="pos-rel">
					                                <input name="MBKHX_Check" type="checkbox" class="ace">
					                                 <span class="lbl"></span>
					                            </label>
					                        </td>
					                        <td style="width: 20%" hidden>${(item.id)!''}</td>
					                        <td style="width: 20%">${(item.sysOtherSort)!''}</td>
					                        <td style="width: 60%">${(item.sysOtherDescribe)!''}</td>
					                    </tr>
			                 			</#list>
				                   	</tbody>
			                	</table>
            				</div>
				      		</div>
				    	</div>
				  	</div>
				</div>
			</div>
      	</div>
	</div>
</div>
<script type="text/javascript">
var aihome = {
	TabIdentity : "",//添加类型 4个按钮的8种类型
	title : "",//弹框title
	sysOtherDescribe : "",//往后台传的描述
	sysOtherId : "",
	appendStr : "",//新增成功后追加的Str
	lable : "",//新增修改是lable
	ADDTYPE :"",//新增时添加参数类型
	closeFlag : "",//关闭
	checkBoxLength :0,
	updateSort : "",
	updateType : "",//修改时 修改参数的类型
/* 	getTypeParameter : function(num) {//切换TAB时获取标识
	}, */
/* 	saveCustomerInfo : function(Type){
		if($("#"+Type+"Num").val()!=""){
			aihome.sysCoustomerDescribe = parseInt($("#"+Type+"Num").val());
			aihome.sysCoustomId = $("#"+Type+"Num").attr(""+Type+"Num");
		}else{
			alert("设置该系统参数时不能填空值,如果想设置为空请输入0。");
			return;
		}
		 $.ajax({
		       type: "post",
		       url: "${CTX}/sys/insertCustomerInfo.do",
		       async:false,
		       dataType:'json',
		       data: {"sysCoustomId":aihome.sysCoustomId ,"sysCoustomerDescribe":aihome.sysCoustomerDescribe,"sysCoustomerType":Type},
		       success: function(data){
		    	  if(data==1){
		    		  alert("操作成功");
		    		  aihome.getSysCustomerParame(Type);
		    	  }else{
		    		  alert("请注意更改的数据没有发生改变");
		    	  }
		       },
		 });
	}, */
	getSysCustomerParame : function(Type){//查询客源参数回显
			 $.ajax({
			       type: "post",
			       url: "${CTX}/sys/getSysOtherParame.do", 
			       async:false,
			       dataType:'json',
			       data: {"sysOtherType":Type},
			       success: function(data){
			    	   aihome.getSysCustomerInfo(data,Type);
			       }
			 });
	},
	getSysCustomerInfo : function(data,Type){//查询追加数据
		$("#"+Type+"Table tbody").children().remove();
		if(Type=="MBKHX"){
			for(var i=0;i<data.length;i++){
				var appendStr = '<tr class="active"><td class="center" style="width: 20%"><label class="pos-rel"><input name="'+Type+'_Check" type="checkbox" class="ace"><span class="lbl"></span></label></td><td style="width: 20%" hidden>'+data[i].id+'</td><td style="width: 20%">'+data[i].sysOtherSort+'</td><td style="width: 60%">'+data[i].sysOtherDescribe+'</td></tr>';
				$("#"+Type+"Table tbody").append(appendStr);
			}
		}
		$("tr.active").unbind("click").click(function (){
			if(!$(this).find(":checkbox").prop("checked")) {
				$(this).find(":checkbox").prop("checked", "checked");
				$(this).find(":checkbox").trigger("change");
			}else{
				$(this).find(":checkbox").prop("checked", "");
			}
		})
		$(":checkbox").unbind("change").change(function (){
			aihome.updateType = $(this).attr("name").split("_")[0];
			if($(this).prop("checked")) {
				$("#" + aihome.updateType + "Table :checkbox").prop("checked", "");
				$(this).prop("checked", "checked");
			}
	    });
	},
	getSysParameterType : function(type,num){
		if(type==1){ //type 是按钮 
			this.title = "考核项添加";
			this.lable = "考核项";
			this.ADDTYPE = "MBKHX";
		}
		if(num!=1){//2修改和3删除
			var checkObj = $(":input[name='" + aihome.ADDTYPE + "_Check']:checked");
			if(checkObj.length==0){
				alert("请选中一条数据!");
				return ;
			}else{
				aihome.sysOtherId = checkObj.parent().parent().siblings().eq(0).text();//选中的一个条数据Id
				aihome.updateSort = checkObj.parent().parent().siblings().eq(1).text();//选中的一个条数据排序
				aihome.updateDescribe = checkObj.parent().parent().siblings().eq(2).text();//选中的一个条数据描述
			}
			if(num==3){
				aihome.deleteSysParameter(aihome.ADDTYPE);
				return false;
			}else{
				aihome.addSysParameter(type,num);
				return false;
			}
		}
		if(num==1){
			aihome.sysOtherId = "";
			aihome.updateSort = "";
			aihome.updateDescribe = "";
			aihome.addSysParameter(type,num);
		}
		
	},
	deleteSysParameter : function(type){
		if (confirm("确认删除？")){
			 $.ajax({
			       type: "post",
			       url: "${CTX}/sys/deleteSysOther.do", 
			       async:false,
			       dataType:'json',
			       data: {"sysOtherId":aihome.sysOtherId},
			       success: function(data){
			    	   if(data!=0){
			    		   alert("删除成功");
			    		   aihome.getSysCustomerParame(type);  
			    	   }
			       }
			 });
		}
	},
	addSysParameter : function(type,num){
		bootbox.dialog({
			title:aihome.title,
			message:"<div style=\"margin-left:auto;margin-right: auto;\"class=\"row form-xs\"><label  class=\"col-xs-2 control-label\" value=\"\">排序号:</label><input maxlength=\"10\" onkeyup=\"this.value=this.value.replace(/\\D/g,'')\" onafterpaste=\"this.value=this.value.replace(/\\D/g,'')\" class=\"col-xs-3\" id=\"openSort\" name=\"\" type=\"text\" value=\"" + aihome.updateSort + "\" /><label  class=\"col-xs-2 control-label\" value=\"\">" + aihome.lable + ":</label><input maxlength=\"20\" class=\"col-xs-3\" id=\"openDescribe\" name=\"\" type=\"text\" value=\"" + aihome.updateDescribe + "\" /></div>",
		    buttons:{
		        "success" :
	             {
	                "label" : "<i class='icon-ok'></i> 保存",
	                "className" : "btn-sm btn-success",
	                "callback": function() {
	                	var	openDescribe ="";
	                    var	openSort = "";
		                openDescribe = $("#openDescribe").val();
		                openSort = $("#openSort").val();
		                aihome.closeFlag = false;
		                if(openDescribe!=""&&openSort!=""){
	                	  $.ajax({
		                        type: "post",
		                        dataType: "json",
		                        url: "${CTX}/sys/insertOtherInfo.do",
		                        data:{"sysOtherDescribe":openDescribe,"sysOtherSort":openSort,"sysOtherId":aihome.sysOtherId,"updateSort":aihome.updateSort,"updateDescribe":aihome.updateDescribe,"sysOtherType":aihome.ADDTYPE,"operationType":num},
		                        async: false,
		                        success: function(data){
		                            if (data==2){
		                            	alert("输入的"+aihome.lable+"已存在");
		                            }else if(data==3){
		                            	alert("输入的排序号已存在");
		                            }else{
		                            	if(num==1){
		                            		alert("保存成功");
		                            		aihome.getSysCustomerParame(aihome.ADDTYPE);
		                            	}else{
		                            		alert("修改成功");
		                            		aihome.getSysCustomerParame(aihome.ADDTYPE);
		                            	}
		                            	$(":input[name='" + aihome.updateType + "_Check']:checked").prop("checked", "");
		                            	aihome.closeFlag = true;
		                            }
		                        }
		                  });
		                }else{
		                	alert("请填写未填写内容!");
		                }
		                return aihome.closeFlag;
	                }
	            }
		    },
		});
	}
};
$(function(){
	$('.page-content-area').ace_ajax('loadScripts', [null,"../assets/js/bootbox.js"], function () {});
	$(".tab-content.no-padding").css({"width": "100%", "height": "227px"});
	$("tr.active").unbind("click").bind("click",function (){
		if(!$(this).find(":checkbox").prop("checked")) {
			$(this).find(":checkbox").prop("checked", "checked");
			$(this).find(":checkbox").trigger("change");
		}else{
			$(this).find(":checkbox").prop("checked", "");
		}
	})
	$(":checkbox").unbind("change").bind("change",function (){
		aihome.updateType = $(this).attr("name").split("_")[0];
		if($(this).prop("checked")) {
			$("#" + aihome.updateType + "Table :checkbox").prop("checked", "");
			$(this).prop("checked", "checked");
		}
    });
})
</script>