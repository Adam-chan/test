<div class="row">
	<div class="col-xs-12 my-group">
		<div class="row">
			<div class="col-md-12">
				<div class="form-xs form-group row">
					<label class="col-xs-2 control-label">备注：</label>
					<div class="col-xs-10">
						<textarea id="remark" name="remark" rows="3" maxlength="83" style="width: 100%; resize: none;"></textarea>
					</div>
				</div>
			</div>
		</div>
		<input id="houseInfoId" name="houseInfoId" type="hidden" value="${houseInfoId!}" />
	</div>
	<div class="col-xs-12 my-grid" style="margin-top: 10px;">
		<span>历史保护记录</span>
		<!-- PAGE CONTENT BEGINS -->
		<table id="openProtectJqGrid">
		</table>
		<div id="openProtectJqGridPager"></div>
		<!-- PAGE CONTENT ENDS -->
	</div>
</div>
<script type="text/javascript">
aihome.protectInit = function() {
	$("#openProtectJqGrid").jqGrid({
		height: $(window).height() - 219,
		viewrecords: true,
		autowidth: true,
		async: false,
		url: "${CTX}/commonSearch/getProtectListForPage.do",
		postData: {
			houseInfoId: $("#houseInfoId").val()
		},
		datatype: "json",
		colNames : ['操作人', '保护时长', '设置时间', '备注'],
		colModel: [
			{ name: 'USERNAME', index: 'USERNAME', sortable: false, width: 32, align: 'center'},
			{ name: 'PROTECTDAY', index: 'PROTECTDAY', sortable: false, width: 32, align: 'center'},
			{ name: 'CREATETIME', index: 'CREATETIME', sortable: false, width: 32, align: 'center'},
			{ name: 'REMARK', index: 'REMARK', sortable: false, width: 32, align: 'center'}
		],
		onSelectRow: function (rowId, status, e) {
			var rowIds = jQuery("#openProtectJqGrid").jqGrid('getGridParam', 'selarrrow');
			var rowData = $("#openProtectJqGrid").jqGrid('getRowData',rowId);
		},
		gridComplete: function () {
			$("#openProtect .ui-jqgrid-bdiv").css("height", $("#openProtect").height() - 176);
		},
		rowNum:30, 
		rowList:[10,20,30,50,100],
		pager: "#openProtectJqGridPager",
		jsonReader: { root: 'pagerResults', page:'currentPage',rows:'rowCount',total:'pageCount',records:'totalCount',repeatitems: false}
	});
}
aihome.addProtect = function() {
	var returnFlag = false;
	$.ajax({
		url : "${CTX}/commonSearch/addProtect.do",
		async : false,
		dataType : "json",
		data : {
			houseInfoId : $("#houseInfoId").val(),
			remark : $("#remark").val()
		},
		success : function(data) {
			if(data > 0) {
				returnFlag = true;
				alert("添加保护成功！");
			} else {
				if(data == -1) {
					alert("当前房源已被保护！");
				} else if(data == -2) {
					alert("房源保护数量已达到上限！");
				}
			}
		}
	});
	return returnFlag;
}
$(function () {
	// 明细列表 Start
	aihome.protectInit();
	// 明细列表 End
})
</script>
