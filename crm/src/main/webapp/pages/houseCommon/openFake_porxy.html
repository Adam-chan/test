<div class="row" style="margin-top: 5px;">
	<div class="col-md-4 col-sm-4 col-xs-4" >
		<label class="col-xs-6 control-label" style="text-align: right;">原委托书:</label>
		<a  onclick="aihome.downloadFiles()" href="javaScript:void(0);" style='text-decoration:underline;color:blue'>下载</a>
	</div>
</div>
<div class="row" style="margin-top: 5px;">
	<div class="col-md-4 col-sm-4 col-xs-4" >
		<label class="col-xs-6 control-label" style="text-align: right;">委托书编号(原):</label>
		<div id="proxyCodePre" class="col-xs-6" style="padding-left:0px;" value="${(result.houseProxyInfo.code)!''}">
		   	${(result.houseProxyInfo.code)!''}
		</div>
	</div>
	<div class="col-md-4 col-sm-4 col-xs-4" >
		<label class="col-xs-6 control-label" style="text-align: right;">签署时间(原):</label>
		<div class="col-xs-6" style="padding-left:0px;">
		   	${(result.houseProxyInfo.createTimeStr)!''}
		</div>
	</div>
</div>
<div class="row" style="margin-top: 5px;">
	<div class="col-md-4 col-sm-4 col-xs-4" >
		<label class="col-xs-6 control-label" style="text-align: right;">委托书编号:</label>
		<div  class="col-xs-6" style="padding-left: 0px;" >
		   	<input id="proxyCode" maxlength="20" class="form-control input-xs" vRequired="true"  type="text">
		</div>
	</div>
	<div class="col-md-4 col-sm-4 col-xs-4" >
		<label class="col-xs-6 control-label" style="text-align: right;">签署时间:</label>
		<div class="col-xs-6" style="padding-left: 0px;">
		   	<input id="signTime" name="followTime" type="text" class="5i5jDateTime input-xs" style="margin-left: 5px; background-color: #FFFFFF !important;" readonly="readonly" />
			<span class="clearTime" style="margin-left: -14px; font-size: 12px; cursor: default; display: none;">×</span>
		</div>
	</div>
</div>
<div class="row" style="margin-top: 5px;">
	<div class="col-md-4 col-sm-4 col-xs-4" >
		<label class="col-xs-6 control-label" style="text-align: right;">现委托书:</label>
		<form id="form" enctype="multipart/form-data">
		<a  href="javascript:void(0);"style="position: relative;overflow: hidden;display: block;width: 55px; margin-right: 132px;float: right;height: 20px;color:blue;">
			<input onchange="aihome.fileUpload();" name="pic" type="file" style="position: absolute;top: -6px;left: -20px;opacity: 0;border: 0;width: 340px;height: 70px!important;line-height: 70px!important; cursor: pointer;">上传附件
		</a>
		</form>
	</div>
</div>
<div  class="row"  style="margin-top: 5px;text-align: right;">
	<div class="col-md-4 col-sm-4 col-xs-4" id="fileUpload" style=" margin-left: 130px;"></div>
</div>
<div class="row" style="margin-top: 5px;">
	<div class="col-md-4 col-sm-4 col-xs-4" >
		<label class="col-xs-6 control-label" style="text-align: right;">打假备注:</label>
		<div class="col-xs-6" style="padding-left: 0px;">
		   	<textarea id="proxyRemark"  cols="50" rows="4" name="textareaName" type="textarea" value=""></textarea>
		</div>
	</div>
</div>
<button class="btn btn-xs btn-blue" style=" margin-left: 522px;margin-top: 43px;"onclick="aihome.proxyFake();">确定</button>
<script type="text/javascript">
aihome.proxyFake = function(){
	if($("#proxyCodePre").attr("value")==""){
		alert("当前房源下委托书暂未生成,无法进行有效委托书打假!");
		return;
	}
	if($("#proxyCode").val()==""){
		alert("请输入委托书编号!");
		return;
	}
	if($("#signTime").val()==""){
		alert("请输入签订时间!");
		return;
	}
	if($("#proxyRemark").val()==""){
		alert("打假备注不能为空,请输入有效打假备注!");
		return;
	}
	$.ajax({
		url : "${CTX}/commonSearch/saveHouseFake.do",
		async : false,
		dataType : "json",
		data : {
			houseInfoId : $("#houseInfoId").val(),//houseInfo
			houseCode : $("#detailHouseCode").val(),//房间编号
			reason : $("#proxyRemark").val(),//委托书打假备注
			transType : ${transType},//1买卖 2租赁
			passiveUser : $("#operator").val(),//被打假人信息
			passiveUserId : $("#operatorId").val(),
			passiveOrgName : $("#operateOrgName").val(),
			passiveOrgCode : $("#operateOrgCode").val(),
			passiveAreaName : $("#operateQuName").val(),
			useType : $("#propertyTypeLayout").val(),
			type :aihome.fakeType,//打假类型
			proxyCode : $("#proxyCode").val(),//委托书编号
			signTime : $("#signTime").val(),//签署时间
			folderName : $("#fileUpload").find(".dataFiles").attr("data-folderName"),//文件夹名
			fileName : $("#fileUpload").find(".dataFiles").attr("data-fileName")//文件名
		},
		success : function(data) {
			if(data==1){
				alert("提交委托书打假成功!");
				$("#openAntiCounterfeiting").dialog("close");
				$("#myFake_jqGrid").trigger("reloadGrid");
			}else if(data==2){
				alert("该房源下委托书打假已被其他经纪人提交,审核正在进行中请稍后再试!");
			}else{
				alert("提交委托书打假失败!");
			}
		}
	});
}
$(":input[name='keyType']").change(function (){
	if($(this).val()==3){
		$("#hiddenKey").hide();
		$("#keyTypePw").show();
	}else{
		$("#keyTypePw").hide();
		$("#hiddenKey").show();
	}
});
$(".clearTime").click(function() {
	$(this).prev().val("");
	$(this).hide();
});
$(".5i5jDateTime").datetimepicker({
	format: "YYYY-MM-DD HH:mm"
});
$(".5i5jDateTime").change(function() {
	$(this).next().show();
});
/*下载*/
aihome.downloadFiles = function(){
 	var url = "${IMAGE_URL}/${(result.houseProxyInfo.floderName)!''}/${(result.houseProxyInfo.fileNameLong)!''}";
	if (confirm("确认下载吗？")){
		window.open(url);
	}
}
/*上传*/
aihome.fileUpload = function(){
	var formData = new FormData($("#form")[0]);
	$.ajax({
		url : "${UPLOAD_URL}/save.do",
		type : "POST",
		data : formData,
		dataType : "JSON",
		async : false,
		processData : false,
		contentType : false,
		success : function(data){
			$("#fileUpload").append('<span class="tag dataFiles" data-original="'+data.original+'" data-folderName="'+data.folderName+'" data-fileName="'+data.fileName+'" >'+data.original+'<button type="button" class="close" style="color:red;" onclick="aihome.closeSpan($(this));">×</button></span>');
		},
		error : function(data){
			alert("上传失败");
		}
	});
}
aihome.closeSpan = function(obj){
	obj.parent().remove();
};
</script>
