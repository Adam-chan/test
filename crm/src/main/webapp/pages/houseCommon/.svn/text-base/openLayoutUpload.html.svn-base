<div class="row" style="padding:0 25px">
	<input id="premisesId" value="${premisesId!}" type="hidden">
	<div class="row">
		<div class="col-xs-6" style="text-align:right">
			<form id="form" enctype="multipart/form-data">
				<a href="javascript:void(0);" style="position: relative;overflow: hidden;display: block;float: right;height: 24px;color:#0196ff;">
		 	  		<a class="btn btn-xs btn-icon btn-blue"> 
		 	  			<input onchange="fileUpload();" name="file" type="file" style="position: absolute;top: -15px;left: -2px;opacity: 0;border: 0;width: 78px;height: 24px!important;line-height: 70px!important; cursor: pointer;">
					    	<span style="color:white">上传图片</span>
					</a>
			    </a>
			</form>
		</div>
		<div class="col-xs-6">
			<button class="btn btn-xs btn-icon btn-blue" onclick="deletePicture();">
				<span>从楼盘图片选择</span>
			</button>
		</div>
	</div>
	<div class="row">&nbsp;</div>
	<div class="row">
		<div class='col-xs-12' id="fileUploaded" style="text-align:center">
			<img src="" style="width: 180px;height: 180px;" />
		</div>
	</div>
	
	

</div>

<style type="text/css">
</style>
<script type="text/javascript">
	var original = "";
	function fileUpload() {
		var formData = new FormData($("#form")[0]);
			$.ajax({
					url : "${UPLOAD_URL}/save.do",
					type : "POST",
					data : formData,
					dataType : "JSON",
					async : false,
					processData : false,
					contentType : false,
					success : function(data) {
						$("#fileUploaded")
								.append(
										
										 '<span style="border:0px;position:relative;" class="tags dataFiles" data-original="'+data.original+'" data-folderName="'+data.folderName+'" data-fileName="'+data.fileName+'" ><div>'
										+'</div><img src="${IMAGE_URL}'+ data.folderName + '/' + data.fileName + '@180w_180h" style="cursor:pointer;" /><div>'+data.original
										+ '</div><button style="position:absolute; z-index:2; right:25px; top:10px" type="button" class="close " onclick="closeSpan(this);"><div style="color:red;font-size:30px;">×</div></button></span>')
										
					},
					error : function(data) {
						alert("上传失败");
					}
				});
	}
	
	aihome.openLayoutUpload = function(){
		oaDialogOpen(
				"openLayoutUpload",//对话框ID，必填，且不能与当前页面的ID重复
				{
					url: "${CTX}/commonSearch/openLayoutUpload.do",//调用页面的url
					title: "上传户型图",//弹框的title
					closeOnEscpe: true,//是否通过esc关闭弹框
					closeBtn: true,//是否显示关闭按钮
					width: $(window).width()*0.4,//弹框的宽度
					height: $(window).height()*0.4,//弹框的高度
				}
			)
	}
	
	//保存上传的图片路径
	function saveUploadPicture() {
		var isSelect=$("#picTypes").val();
		if(isSelect == ''){
			alert("请设置图片类型");
			return false;
		}
		
		var dataStr = "[";
		var list = $("#fileUploaded").find(".dataFiles");
		list.each(function(i) {
			var folderName = $(this).attr("data-folderName");
			var fileName = $(this).attr("data-fileName");
			var original = $(this).attr("data-original");
			dataStr += '{"folderName":"' + folderName + '","fileNameLong":"'
					+ fileName + '","fileName":"' + original + '"}';
			if (i != list.length - 1) {
				dataStr += ',';
			}
		});
		dataStr += "]";
		var url = "${CTX}/premisesPictures/saveUploadPicture.do";
		$.ajax({
			type : "POST",
			url : url,
			async : false,
			dataType : "JSON",
			data : {
				"premisesId" : $("#premisesId").val(),
				"dataStr" : dataStr,
				"picType" :$("#picTypes").val(),
				"status"  :1
			},
			success : function(data) {
				if (data >= 1) {
					alert("操作成功");
				} else {
					alert("操作失败");
				}
			}
		});
		return true;
	}

	function closeSpan(obj) {
		$(obj).parent().remove();
	}//点击删除气泡
</script>