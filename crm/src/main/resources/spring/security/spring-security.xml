<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:util="http://www.springframework.org/schema/util" xmlns:p="http://www.springframework.org/schema/p"
    xmlns:security="http://www.springframework.org/schema/security"
    xsi:schemaLocation="http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-3.2.xsd
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.2.xsd">
  
    <security:http auto-config="true" entry-point-ref="casAuthEntryPoint" access-decision-manager-ref="accessDecisionManager">  
	    <security:custom-filter ref="casAuthenticationFilter" position="CAS_FILTER"/>  
	    <security:logout invalidate-session="true" logout-url="/logout" />  
<!-- 	<security:intercept-url pattern="/admin.jsp*" access="ROLE_USER,ROLE_ADMIN"/>  
	    <security:intercept-url pattern="/index.jsp*" access="ROLE_USER,ROLE_ADMIN"/>  -->
	    <!-- <security:intercept-url pattern="/**" access="POWERMANAGER"/> --> 
	    <security:intercept-url pattern="/**" access="LOGININ"/> 
	    								<!-- 测试可以设置为ROLE_ANONYMOUS  -->
	</security:http>  
  
	<security:authentication-manager alias="authenticationmanager">  
	    <security:authentication-provider ref="casAuthenticationProvider"/>  
	</security:authentication-manager>  
	  
	<bean id="casAuthenticationProvider" class="org.springframework.security.cas.authentication.CasAuthenticationProvider">  
	        <property name="ticketValidator" ref="casTicketValidator"/>  
	        <property name="serviceProperties" ref="casService"/>  
	        <property name="key" value="docms"/>  
	        <property name="authenticationUserDetailsService" ref="authenticationUserDetailsService"/>  
	</bean>  
	  
	<bean id="casAuthEntryPoint" class="org.springframework.security.cas.web.CasAuthenticationEntryPoint">  
	        <property name="loginUrl" value="${sso.login}"/>  
	        <property name="serviceProperties" ref="casService"/>  
	</bean>     
	  
	<bean id="casService" class="org.springframework.security.cas.ServiceProperties">  
	    <property name="service" value="${sso.security.check}"/>  
	</bean>     
	  
	<!--<bean id="casAuthenticationFilter" class="com.wawj.master.security.CusCasAuthenticationFilter">-->
 	<bean id="casAuthenticationFilter" class="org.springframework.security.cas.web.CasAuthenticationFilter">   
	        <property name="authenticationManager" ref="authenticationmanager"/>  
	</bean>  
	  
	<bean id="casTicketValidator" class="org.jasig.cas.client.validation.Cas20ServiceTicketValidator">  
	        <constructor-arg value="${sso.ticket.validator}"/>  
	        <property name="encoding" value ="UTF-8"></property>
	</bean>  
  
  	<!-- 自定义用户授权 -->
    <bean id="authenticationUserDetailsService" class="com.wawj.master.security.CasUserDetailsServiceManager">

    </bean>
    
    
    <!-- security默认的权限验证类（投票机制）-->
	<bean id="accessDecisionManager"  
        class="org.springframework.security.access.vote.AffirmativeBased">  
        <property name="decisionVoters">  
            <list>  
            	<!-- security默认的两个投票类 -->
                <!-- <bean class="org.springframework.security.access.vote.RoleVoter" />   -->
                <!-- <bean class="org.springframework.security.access.vote.AuthenticatedVoter" />   -->
                <bean class="com.wawj.master.security.DynamicRoleVoter" />  
            </list>  
        </property>  
	</bean> 
</beans>